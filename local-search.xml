<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Postgresql模式的概念以及连接方法</title>
    <link href="/2023/01/30/java-17/"/>
    <url>/2023/01/30/java-17/</url>
    
    <content type="html"><![CDATA[<p>模式schema，并不是全部所有数据库都支持，没有去罗列，以MYSQL为例，Mysql没有模式这个概念，postgresql则有。</p><p>Pgsql的模式就对应MySQL里不同的库。可以理解成MySQL只有一层，但是pgsql有二层。</p><p>MySQL是直接选择哪个库，进行连接。</p><p>PGSQL有两层，连接库时不指定模式则默认选择public模式，（PGSQL新建数据库时，会默认新建一个public模式）模式和模式之间是完全隔离的。</p><h2 id="连接指定模式"><a href="#连接指定模式" class="headerlink" title="连接指定模式"></a>连接指定模式</h2><div class="note note-info">            <figure><div class="code-wrapper"><pre class="line-numbers language-none"><code class="language-none">jdbc:postgresql:l&#x2F;localhost:5432&#x2F;postgresql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><p>在这种连接方式下，默认连接使用的是postgresql数据库的public模式、在业务场景中有时允许多个用户使用一个数据库并且不会互相干扰。这时需要在使用同一个数据库新建其他模式进行连接。这时在springboot的数据源jdbc配置时注意。</p><figure><div class="code-wrapper"><pre class="line-numbers language-none"><code class="language-none">#postgresql-&gt; 9.3及以前的版本指定方式spring.datasource.url&#x3D;jdbc:postgresql:&#x2F;localhost:5432&#x2F;postgresql?searchpath&#x3D;newschema<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div></figure><figure><div class="code-wrapper"><pre class="line-numbers language-none"><code class="language-none">#postgresql-&gt; 9.4及以后的版本指定方式spring.datasource.url&#x3D;jdbc:postgresql:&#x2F;&#x2F;localhost:5432&#x2F;postgresql?currentSchema&#x3D;newschema<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div></figure>          </div><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1haltemse87j32yo1o07wi.jpg" alt="原神 云堇"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>数据库</tag>
      
      <tag>POSTGRESQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>最近图片加载不出来的问题</title>
    <link href="/2023/01/03/other-10/"/>
    <url>/2023/01/03/other-10/</url>
    
    <content type="html"><![CDATA[<p>最近不知道什么原因，博客好多图片都加载不出来了，不知道什么原因好像图床有点问题，统一修改了一下。</p><p>微博开始限制外链了，后期会改图片的存储地址。</p><p>暂且这样吧，也不知道能维持多久，目前图片可以查看了。</p><p>新年快乐。</p><h2 id="封"><a href="#封" class="headerlink" title="封"></a>封</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h9q6kk3pnwj36683h0tw6.jpg" alt="事事顺心 好运常在"></p>]]></content>
    
    
    <categories>
      
      <category>Other</category>
      
    </categories>
    
    
    <tags>
      
      <tag>其他</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>关于2022年</title>
    <link href="/2022/12/26/gossip-18/"/>
    <url>/2022/12/26/gossip-18/</url>
    
    <content type="html"><![CDATA[<div class="note note-info">            <p>什么叫多余<br>夏天的棉袄，冬天的蒲扇<br>还有等我已经心冷之后<br>你的殷勤。</p>          </div><p>元旦结束，国庆节回家坐大巴带给我的惨痛回忆，让我萌生了买车的想法，除夕放假我是开车回的家。</p><p>春节结束，元宵节回家把车牌装上，至此小汽车的事情安顿完毕。</p><p>再回上班的地方，联系了大学里的异性同学，有复合的想法，我承认当时有这种想法是我飘了，嗯，只是一段没有然后的故事，我也不想在有然后了。</p><p>过了两天房子到期，遂搬到竹园，短租了四个月，见识了合租女室友的情情爱爱，爱爱为动词。99年的姑娘，体育男友，舞蹈生，加幼教，几重buff，挺厉害的一个室友，在城市里独自生活的女生，多少有点本事在身上，笑贫不笑娼的风气，都是一种生活方式，也没什么。</p><p>清明，外甥抓周，我这个做舅舅的无论如何要回去，三年时间，疫情愈演愈烈，办完事情，我甚至没有吃到第二天的午饭，便匆匆忙忙回到工作处。然后老家便封了三个月，回来的小区周围的铁栅栏也焊上了。</p><p>五一假期第一天，早晨我还没睡醒，电话响了，里面传来老爹的声音，“良子，五一回不回来”，瞬间清醒，下床穿衣洗漱，拿上车钥匙便下楼，回家半路被截胡，无奈返回住处，和老爹打了电话，说明情况。五一，居家躺了五天。唯一的乐子就是看女室友和她带回来的男朋友朝夕相处，我一个单身狗看的津津有味。</p><p>这一年，和朋友去了祥源花世界，去了巢湖边上，合肥的KTV，商圈，等等，精通各个商圈附近的停车位置，熟练使用高德地图找地下车库地址，精通各种侧方停车，以及倒车入库。酒过三巡，各自说自己的相亲对象以及发展对象，说出来都是乐子，但实际上是什么样，又有什么关系呢。封心锁爱，和无人所爱，有什么区别呢。</p><p>和大学同学失去联系，在爱意的笼罩，或者性吸引力下，我是会失去一些客观的判断能力，恢复了判断力，她没有朦朦胧胧的，我看的明白不代表就一定要说的明白。想的多的，输，主动的，输，付出多的，输，维持时间的长短也许只是赢家好奇输家什么时候自己退场。</p><p>没有意外，顺其自然，我说的顺其自然，并不是我两手一摊，而是以我的能力，这件事只能这样了，在往下会不合理。</p><div class="note note-info">            <p>东风吹人醒，万事藏于心，我没说不公平，也没说我苦，我就说，我知道了。</p>          </div><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h9m60mk05kj32yo1pwu0z.jpg" alt="原神"></p><h2 id="封面-1"><a href="#封面-1" class="headerlink" title="封面"></a>封面</h2>]]></content>
    
    
    <categories>
      
      <category>碎碎念</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>一些关于县城的记忆_二</title>
    <link href="/2022/12/20/gossip-17/"/>
    <url>/2022/12/20/gossip-17/</url>
    
    <content type="html"><![CDATA[<div class="note note-info">            <p>念念不忘，必有回响。</p>          </div><p>…</p><p>飞飞委屈的扑到我怀里大哭，那个深夜，我在这个地方第一次感受到了彻骨的寒意，不知道是不是眼泪洒在我怀里的原因。</p><p>未完待续…</p><p>敬淮走了，飞飞也没有再找对象，或许是对敬淮余情未了，飞飞说，两个人如果没有好好道别就走散的，那么这两个人终将再次重逢。</p><p>我没曾想过给飞飞介绍男朋友，但飞飞却说要给我介绍一个女朋友。飞飞说这女生温柔大方还漂亮，说我如果不把握的话，你绝对会后悔，听飞飞说的这么玄乎，便去见了见，就这样童可走进了我的生活，陪伴了我人生最灿烂的那几年。</p><p>童可最大的优点就是爱打直球，不会和我兜圈子，说怕把我给绕晕了，毕业那会儿我找不到合适的工作，天天借酒消愁，童可不禁好笑：你又不会作诗，学什么李白啊整天醉生梦死的。</p><p>我说：高粱果汁，高粱果汁，也算一种风味饮料。</p><p>我顿了顿又说：童，陪我喝一杯，</p><p>她拿着杯子闭上眼睛眯了一口，辣的直吐舌头，我笑着说：你喝酒的样子真有意思，再尝一口吧。</p><p>童可露出虎牙说：你要是欠酒喝就去找你那群哥们啊，别想着把我灌醉了做坏事。</p><p>我喝下一大口酒，想起了很多事，叹了口气说：这个地方，好像没有能陪我喝酒的哥们了。</p><p>童可看出我不高兴，拿起酒给我倒上一杯，然后陪我喝起来，那天晚上我们都醉了，我们依偎在床上，童可整个脸都红了，她把脸埋在我胸前说：别怕，你还有我呢。</p><p>外面下起了大雨，滴滴答答，我抱着怀里的柔软觉得自己真的足够幸运。</p><p>生活却总是爱开玩笑，越是想抓住的越是容易溜走，年轻的时候我们以为能够掌握一切，过后才了解最不受控制的就是自己的生活，童可也离开了我的世界。</p><p>再见已是听闻飞飞，童可结婚的消息，同一天，同一间酒店，见证了她们无与伦比的友谊，我和敬淮穿的西装笔挺的去赴宴，当她们走上礼台的那一瞬，我和敬淮干了一杯，用苦酒顶住夺眶而出的眼泪。</p><p>散场的时候我们四个人相互拥抱，飞飞对敬淮说：咱们以后要比赛，看谁过的更幸福，你可不能输。</p><p>童可叹了口气说：不在一起就不再一起吧，反正一辈子也没有多长。</p><p>我和敬淮红着眼点了点头。</p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h9cwyyjtiej32yo1o0npd.jpg" alt="黑色口罩"></p>]]></content>
    
    
    <categories>
      
      <category>碎碎念</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>一些关于县城的记忆</title>
    <link href="/2022/12/13/gossip-16/"/>
    <url>/2022/12/13/gossip-16/</url>
    
    <content type="html"><![CDATA[<div class="note note-info">            <p>悲伤是奢饰品我消受不起，快乐像噩梦总让人惊醒。</p>          </div><p>寿县是一个充满风土人情的地方，除了南门，别的城门中都是石板铺的路，未经过现代化建设的路上布满了深深的车辙，映照出它经历的数百年历史，导游一般是这样说的。</p><p>实际如果每天都需要经过非南门的话，才知道这所谓见证历史深深的车辙有多烦人。骑电动车，自行车，大多数时候只能下来推着走，因为骑车的话，车轮滑进车辙里，很容易摔倒，一方面也算降低了县城的生活节奏吧。</p><p>是啊这个县城的生活是缓慢的，因为一切都不需要着急，20分钟电动车行驶的路程可以抵达县城中任意一个巷子，或一个角落。何必那么着急。走在南大街上，有蓬壁辉煌的大酒店，也有接地气的路边摊。年迈夫妇在巷口卖烧饼，背着书包的学生在蜜雪冰城前等饮料。街上能看见光鲜亮丽的时尚姑娘，也能看见稚气未褪的高中生，买完炸鸡排的姑娘转头跑到烧饼摊向摊主买两个烧饼，买了两个烧饼的年轻夫妇，转身坐进了豪华轿车，不同时代的产物在这条街上并不冲突。</p><div class="note note-info">            <p>情人一起看过多少次月亮，它在天空看过多少次遗忘。</p>          </div><p>我看过了这个县城的春夏秋冬，它也看了我和我朋友三年间的分分合合。</p><p>在这里我交了很多朋友，然后陆续各自分道扬镳，遇到了一生挚爱的姑娘，也在兵荒马乱的时期分手。这个地方，让我开心，也让我难过。</p><p>敬淮是和我睡过一张床的好朋友，印象中当时敬淮帅的像漫画中男主走出来的一样，我现在来形容就是是童锦程那款的，高中那会总会有姑娘在窗外看他，放学会被姑娘堵着告白，但是他却不像童锦程那样。</p><p>敬淮不敢谈恋爱，原因是敬淮有点伸不开手，he is poor，他爸爸是快递员，他妈妈在菜场上卖菜，每个月也只有紧巴巴的百十来块钱的生活费。那会体育课爱踢踢球，一次踢球，敬淮的球鞋鞋底直接飞了出去，我们一群人哈哈大笑，敬淮也跟着我们笑，说：以后你们别找我踢球了，因为这是我最后一双能踢球的鞋了。</p><p>再后来的一个圣诞节，敬淮收到一份圣诞礼物，打开以后看到是一双崭新的球鞋，敬淮有点吓到了，因为这双鞋的价格对于高中生来说是笔巨款。我们都知道是飞飞送的，因为飞飞特别喜欢敬淮，而且家境很好。敬淮放学后把球鞋还给飞飞，他说，这礼物有点超过我的接受范围了，就是太贵了，我不能收。</p><p>飞飞剪着俏皮的短发笑着说：你怎么知道是我送的？</p><p>敬淮红着脸说：地球人都知道了。</p><p>飞飞把球鞋塞回敬淮的手中说，你还给我我也退不掉啊，就当送你了，再说我看你也挺爱踢球的。</p><p>自那以后敬淮每次踢球，飞飞都会在旁边给敬淮加油打气，大喊，敬淮，射啊！</p><p>敬淮一个趔趄，差点摔个狗啃泥。高中结束他们两个就在一起了，因为家庭环境不同，很多观念不同，所以他们经常争吵，飞飞觉得敬淮自尊心太重，敬淮觉得飞飞太娇气了，最后还是分手了。敬淮决定外出打工，外出的前一晚，大家聚在夜摊前，相聚无言，喝酒喝酒，我们都不是擅长表达情绪的人，但是那晚，所有人都把情绪写在了脸上，敬淮是唯一一个在微笑的人，他说：等我在那边要是混好了，我就开个大公司，把哥几个都拉进去养老。</p><p>我强颜欢笑的说到，好啊，到时候记得开法拉利来接我们。</p><p>敬淮端起酒杯说：必须的。便一饮而尽。</p><p>天下没有不散的宴席，言罢，敬淮背着包摇摇晃晃的站了起来，我们想要要送他，他却不让，摆摆手一个人便走了。敬淮走了不到十分钟，飞飞哭成一个泪人跑了过来，知道敬淮已经走了，她蹲在地上哭的像个孩子。</p><p>我过去想要拉起飞飞，没等我开口，飞飞说：别碰我，我只是有点不开心，让我哭一会。</p><p>我劝她，飞飞，大家做朋友其实也挺好的。</p><p>飞飞蹲在地上斜着脑袋红着眼睛看着我说：我，不是真的要他走，我那只是气话而已，他，，太欺负人了。</p><p>敬淮和飞飞之间是发生了一些做朋友也没办法知道的事情，这是他们两个人之间的事。我再次尝试把飞飞拉起来，这次飞飞没有拒绝。</p><p>飞飞委屈的扑到我怀里大哭，那个深夜，我在这个地方第一次感受到了彻骨的寒意，不知道是不是眼泪洒在我怀里的原因。</p><p>未完待续…</p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h98yi19nsej32yo1o07wh.jpg" alt="巴图BaTu"></p>]]></content>
    
    
    <categories>
      
      <category>碎碎念</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>君子当如兰</title>
    <link href="/2022/12/07/gossip-15/"/>
    <url>/2022/12/07/gossip-15/</url>
    
    <content type="html"><![CDATA[<div class="note note-info">            <p>早年同窗始相知，三载瞬逝情却萌。年少不知愁滋味，犹读红豆生南国。别离方知相思苦，心田红豆根以生。</p>          </div><p>再听尧十三，一些歌已经找不到了，再回看麻油叶，眼看他起高楼，眼看他宴宾客，眼看他楼塌了。</p><p>我以为我们没有当面的说再见，就说明我们还有再见的机会。</p><p>我以为我女人缘很好，是一个见一个爱一个的人，我还以为我是个会很容易去爱一个人，然后很快的把她忘掉的人。</p><p>我以为我苦苦哀求的话，还能换回她再回头看我一眼。</p><p>兰，但有些话我还是想说。</p><p>首先我要说，你挺讨人厌的，你喜欢的歌挺俗的，而且多少都带点颜色，你居然跟我说，这种叫做文艺，叫民谣，你总觉得自己身材很好，你没发现你的肚子上有赘肉嘛，而且挤乳沟是一件虚荣的事，就像男生的自欺欺人尺一样，是一种没自信的表现。</p><p>你嘴巴挺厉害，说话总爱戳人痛处，你还喜欢和我说你的前任，你说前任的样子，真丑。我当时是什么都没有，可是我能怎么办，我就一个高中生，日本动漫看多了，以为高中生都能拯救世界么。</p><p>但不得不说，你确实是个技术高超的女生。十七八岁的年纪，我们从素不相识，到滚床单只用了半个月的时间，滚完床单，看你一脸享受的躺在床上，我问，你怎么没哭啊，你说，你是不是言情小说看多了，处女也不一定会哭啊，更何况我已经不是处女了，然后便歪过头睡去。我怅然若失的躺在床上，呆呆的看着天花板，很久也没睡着。</p><p>虽然你很酷，你说这种叫酷，你在你姊妹面前雷厉风行的样子，在我面前骄傲的不可一世的样子，如果不是我见过你因姊妹不理解你，然后向你无理由且光明正大的索取的时候，你委屈哭泣的样子，也没必要一直伪装坚强的。</p><p>悲伤在你的身上永远不会停留太久，总是会有新的希望和快乐在你的生活里绽放。</p><p>你总是热情洋溢的面对生活，活力满满的去上班，身姿妖娆的去寻欢，不会让别人看到你的孤独和不安。</p><p>最开始我是不怎么喜欢你的，因为我看见的就是你身边异性很多，你似乎很享受这种感觉，还有我也不是很喜欢你的穿衣打扮，有点过于成熟，甚至有点像夜店风格，在教室里我们也是互相爱答不理的。第一次说话在网吧门口，我早上无事去上网，你早晨从网吧里出来，我说句，包夜结束了？你羞涩一笑，便擦身而过。</p><p>故事开始于你坐到了我的前桌，开始于你递给我的第一张纸条，你问我喜欢什么样的女生，你问我你喜欢我吗，你问我为什么不给你回答，你问我要想多久，你说过了这村没有这店了，本姑娘也是要面子的。</p><p>我选择了你，你选到了我，就这样，原本看起来毫无关联的我们，走到了一起，惊呆了班里一众同学。</p><p>我们的故事是个悲剧，而我是个不知道出演的是悲剧的一个演员，你在一开始就写好了剧本，但你中途入戏太深，但好在你及时清醒。而我却没能及时走出来，我把错误揽在我身上。</p><p>兰，你还好吗？</p><p>听说你遇到了一个很好的男生，相处的挺愉快吧。</p><p>听说你穿上了漂亮的婚纱，应该很幸福吧。</p><p>最后，晚安。</p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h8wqjgydsoj33341xdqv5.jpg" alt="女孩"></p>]]></content>
    
    
    <categories>
      
      <category>碎碎念</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>谁与我</title>
    <link href="/2022/11/29/gossip-14/"/>
    <url>/2022/11/29/gossip-14/</url>
    
    <content type="html"><![CDATA[<p>人人都会有原则，我偶尔会想人的原则是怎么来的，一本书？一个段子？亦或一句话？</p><p>三不娶的原则，第一次的原则，玩玩又不娶的原则，结婚需找圈子干净的原则，或者一些不喝酒，不抽烟的原则，等等。</p><p>绣春刀中加钱居士说，这个人可是我的手足兄弟，至爱亲朋啊，得加钱。一些人的原则也好似如此，我有原则，但今天为了xxx；我放弃了自己的原则，xxx，这种话说出口，原则也变成了一个筹码，而且还是最没有价值的筹码，哪怕你自己以为很值钱。</p><p>我没断奶时我爸妈就把我扔给爷爷奶奶了，在我不能自理前，我对爸妈没有什么印象，大脑是个很聪明的器官，它在你回忆过去的时候，总是会把好的回忆保存的很完好，而那些伤痛的回忆，大脑会帮你慢慢淡化，据说这是大脑的一种保护机制。</p><p>现实就是：回忆的内容是大脑帮你粉饰过后的，请你务必看清当下。</p><p>我有个叔，是我爸的弟弟，我最喜欢听他说的就是，走，带你上街吃饭。</p><p>他和我爸妈一样，生完孩子便被迫外出谋生，因为一家人窝在老家不是个办法，那个年代，没经历过很难去体会，而我也只能尝试着去想象。</p><p>我叔每年过年回家总是会和我说，走，带你上街吃饭。固定的带我们上街，吃街上那家牛肉面，那家牛肉面，我长大后一个人去吃过，但还是少了点什么。</p><p>我叔从小没读什么书，一张不饶人的嘴让我叔换工作换的很勤，和亲戚各种断来往，我爷爷常听到他不好的消息，也只能打电话过去，一通数落，然后无奈的垂下眼睛，在挂断电话。</p><p>但实际上我叔人并不坏，只是性子比较急，成年人的弯弯绕绕他也懂，但是他不会缓和着和别人交流，所以总是弄得一团糟。</p><p>我记得有一年过年，我还小，我叔给我堂弟也就是他儿子买了遥控车，我爸妈什么也没给我买，我当时委屈的就哭了，然后，第二天一大早，我叔就带我上街买了一个遥控车。</p><p>上初中后，暑假我会到爸妈那边过一阵子，我总是喜欢到我叔家生活，因为叔家当时有冰箱，做菜也好吃，我叔也是个有趣的人，他晚上下班会带我们到各种社区活动点玩；每年暑假他也会想方设法得带我们出去玩一圈，他说要带孩子们见见世面，但其实我叔一个人却从来舍不得出去玩，他的不在意，让我以为当时的他挺有钱的，回看，万种思绪，却不知从何说起。</p><p>后来开窍了点，知道自己不适合进厂，然后自己考了一个驾照，然后掏出自己的积蓄，买了个小汽车，在大城市跑黑车，一两年里到也混的风生水起，过年回家时从包里掏出一沓一沓的人民币，两眼放光的对我说，看看，叔今年赚了这么多钱。</p><p>但这行总归不是一个正经行当，后来的年头光景不好，加上大城市对非法营运车辆的查罚力度变大，叔的日子不好过，逆境之下的他好像变了一个人，开始对身边的人抱有很大的恶意。</p><p>有次过年回家，我在那里打牌，我叔在我后面，一会一句，怎么能这样打呢，这些年书都白念了，你这牌打的，念这么多书有啥用，我生气直接把牌一摔，说，叔你来，你来，我叔也许只是随意拍了一下我说，人不大脾气还不小，摔给谁看，我的火一下就被点着了，我很大力的推了他一下，他踉踉跄跄的后退直到靠在墙上，我说，叔你是不是有病，我叔气也上来了，捋起袖子就要打我，被家里人拉住，拉住时，叔还嘟囔着，这孩子敢冲我发脾气。</p><p>我一天天长大，毕业工作，还算混的一个不错的行当，再见我叔时，我叔没了那么多的傲气，是来要我给我堂弟看个电脑，我叔说，给你弟看个合适的电脑，差不多就行，不要太好也不要太次，我不懂，你懂，你给帮忙看看，我说，好，我知道了，我给看看。</p><p>最近一次联系是让我给他买手机，因为我懂，说不要太贵了，太贵的用坏了心疼，七八百块钱的就行了，遥想，当时我叔他可是用过第一代苹果手机的。</p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h8olcze9iij323w23wnpd.jpg" alt="中国风 梅花"></p>]]></content>
    
    
    <categories>
      
      <category>碎碎念</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>再见不见</title>
    <link href="/2022/11/16/gossip-13/"/>
    <url>/2022/11/16/gossip-13/</url>
    
    <content type="html"><![CDATA[<p>以我的成绩进我高中的实验班，说明这个学校好好读书的人并不多，我的判断标准是因为像我我这样不好好学习的人也能进实验班。</p><p>那届高中分了24个班。这个学校在我老家的县城里，是所公立高中。</p><p>我对学校的认知随着我的学历改变而改变，读小学，一个年级一个班，六个年级平均下来一个班不超过35人。读初中，一个年级分了三个班，每个班不超过50人，而到高中，原来一个年级是可以分为24个班的，这也是我第一次来到这么<strong>大</strong>的学校。</p><p>以我现在的经历我依然不能够理解高中军训的意义，一群初中毕业的毛孩，一个二b的教官，风风火火的操练一个星期，最后以类似汇演的节目结束，领导坐在领导席上看着台下的我们点点头，然后拿起话筒，简单的说两句。鼓鼓掌。</p><p>因为大家都这样，所以就这样。</p><p>据军训结束过了一周的时间，从军训缓过来的我，下晚自习，走出教室，抻抻袖子，缩缩脖子往宿舍走，边走边想，这个学校挺大，可这宿舍也忒寒掺了，</p><p>后来我看了一电影，理解了，学校挣钱嘛，学生不寒掺。</p><p>大水池开放式洗漱间，一条龙连贯卫生间，加上五毛钱一瓶的热水，让我感动的落了泪。</p><p>想起了当时不知道在哪家书店看的淘宝的发家史，里面的一句话，太让我印象深刻了，以至于整本书我都忘完了，就记得这一句。五毛钱的热水，一半泡脚，一半泡面，说当时淘宝初始之时，当时负责地面推销的员工，每天晚上，五毛钱的热水，一半泡脚，一半泡面。我这也差不多。</p><p>寒窗苦读，没有让我成绩变好，间接的提升了我的韧性，因为是寒窗是真的寒，偶尔打的热水不热，冬天的衣服穿了很久，五块钱还是四块钱洗一次的洗衣机里根本洗不干净，学校挣钱嘛，不寒掺，我就周末打很多热水，泡一泡自己手搓。干不干净不清楚，比洗衣机洗的干净。</p><p>高中三年遇到两回检查宿舍的，回想多少有点嘲讽，当时我凭借着初中物理学的好，在家接过电，在宿舍里拉了根电线，装了个插座，平时手机充电问题解决了，热水问题也解决了，再没检查宿舍之前。</p><p>周末回宿舍迟了，喊宿管大爷开门，宿管大爷没说话，宿管大妈开始骂骂咧咧，寒冬腊月，大爷起床给冻坏了你们负责嘛，自那以后，回来的时候我看宿管大爷大妈房间灯熄了，我就翻墙进去了，因为我觉得大妈说的有道理。</p><p>手机充一次电五毛钱，充电宝在那时候是个紧俏玩意，手机的电池还是可拆卸更换的，雷军的小米手机1999还是交个朋友的年代。</p><div class="note note-info">            <p>我多风光，你别闯入我围墙。</p>          </div><p>闯进来的是我初中同学安安，安安是我初中留级之后那个班里的同学，白皮肤，鹅蛋脸，身材娇小但匀称。</p><p>当时安安坐我前桌，经常找我问题目，其实就是转个身的事，当时说是问，但更多像是命令。</p><p>把这题给我讲讲，说完这句话的安安，不会超过三秒，安安的习题本就会出现在我的桌子上，没看题目我就说，这题简单，借拿她手里笔的缘由，带着一脸贱笑我的爪子向她的手伸过去，我还没反应过来，啪一声，手就被我隔壁桌的女生打断了。</p><p>是坐我隔壁桌H姐，H姐义正言辞的说：我一看你就不是个好人，自己没有笔么，我恨恨的说一句，有，我有。看到H姐得逞的笑容，我更气了。</p><p>安安说，快点给我讲讲，自然的把手里的笔递给我了，我接过了笔。我又回了H姐一个得意的笑容，但H姐突然就收起了笑容，安静了下来。</p><p>当时的物理题无非是算算密度，算算速度，画画电路图，我不理解为什么要把一个空心球体扔水里算密度，就好像数学中一边放水，一边进水的游泳池一样。</p><p>上高中之后我和安安的联系便多了起来，用安安的话说，我是只是偶尔来而已，然后经常偶尔。</p><p>安安每次来看我，用着来县城里买点东西的借口，为什么说是借口，因为我觉得来买东西应该不会还给我带各种各样的东西。杯子，围脖，手套，等等，我在她的注视下，裹上围脖，带上手套，腋下夹个杯子，安安站在雪地上开心的拍着手，笑着说，这样好，看起来精神，</p><p>然后校园里就开始流传，出现了一个裹着粉色围脖，带着粉色手套关键还用粉色保温杯的变态男。</p><p>安安是个漂亮的女孩，进入高中的她，越发出落，在冬衣的包裹下，身材依旧凹凸有致，我时常打趣，你现在越变越漂亮，身边的追求者会不会很多啊，安安到也毫不避讳，多啊，但是三千若水，我只取你这一瓢。我说，若水不是形容女生的么，哪有拿若水形容男生的，安安说，也对哦，你是男生，应该比女生重一点，你至少是两瓢。</p><p>安安是个好女孩，可我不是个好男孩。</p><p>我熟悉环境后开始沉迷于网络游戏，流连于当时出了名的网吧一条街，对于她我也是爱答不理，因为我当时忙着在召唤师峡谷里征战。偶尔来找我，要么我顶个熊猫眼，哈欠连天的陪她逛街，要么我就直接说，我白天要睡觉，下次再来吧。</p><div class="note note-info">            <p>分别总是在九月，</p>          </div><p>新的一年开学季，安安又来找我，安安说，你还记得，我当时向你表白是写的小作文嘛，我哪记得住，我说，我只记得‘我的名字+我爱你’这六个字，安安说，嗯，从今天开始，这六个字也可以忘了。</p><p>时处九月，身处长江与淮河之间的小县城天气并未转凉，我回去的路上却感觉到丝丝凉意。</p><p>再后来的联系安安说了句，在一起时不珍惜，分开之后装深情，做情圣，我很讨厌你这样的人。</p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h880ptpdh8j32yo1o0hdu.jpg" alt="厚涂画 "></p>]]></content>
    
    
    <categories>
      
      <category>碎碎念</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>关于pnpm</title>
    <link href="/2022/11/08/other-09/"/>
    <url>/2022/11/08/other-09/</url>
    
    <content type="html"><![CDATA[<p>pnpm是前端的包管理器，和yarn，npm是一种东西。</p><p>不知道是前端的原因，还是什么原因，万恶的node_modules，貌似是个前端或类似我这种半吊子前端都要上前喷两句，我喷这个的原因就是这东西太多了，在我不会快速删除时，刚接触Vue工程项目时，一个项目删除时可以耗时十几分钟甚至半个小时，我当时就感觉这东西多少有点布盒里，当时还是处于一个虚心求教的心理，</p><p>感觉这是特性，前端开发的特性。</p><p>看着pnpm的兴起，我感觉这个特性可能不能称之为特性了，可以说是缺陷了。</p><h2 id="pnpm介绍"><a href="#pnpm介绍" class="headerlink" title="pnpm介绍"></a>pnpm介绍</h2><p>快速的，节省磁盘空间的包管理工具。</p><h2 id="pnpm的特点"><a href="#pnpm的特点" class="headerlink" title="pnpm的特点"></a>pnpm的特点</h2><h3 id="快速"><a href="#快速" class="headerlink" title="快速"></a>快速</h3><p>pnpm比其他包管理器快2倍。</p><h3 id="高效"><a href="#高效" class="headerlink" title="高效"></a>高效</h3><p>node_modules 中的文件为复制或链接自特定的内容寻址存储库。</p><h3 id="支持monorepos"><a href="#支持monorepos" class="headerlink" title="支持monorepos"></a>支持monorepos</h3><p>pnpm内置支持单仓多包。</p><h3 id="严格"><a href="#严格" class="headerlink" title="严格"></a>严格</h3><p>pnpm 默认创建了一个非平铺的 node_modules，因此代码无法访问任意包。</p><h2 id="pnpm到底做了什么"><a href="#pnpm到底做了什么" class="headerlink" title="pnpm到底做了什么"></a>pnpm到底做了什么</h2><ul><li><p>当使用npm或yarn时，如果你有100个项目，并且所有项目都有一个相同的依赖包，那么，你在硬盘上就需要保存100份该相同依赖包的副本。</p></li><li><p>如果是使用pnpm,依赖包将被存放在一个统一的位置，因此：</p><ul><li>如果你对同一依赖包使用相同的版本，那么磁盘上只有这个依赖包的一份文件；</li><li>如果你对同一依赖包需要使用不同的版本，则仅有版本之间不同的文件会被存储起来；</li><li>所有文件都保存在硬盘的统一的位置：</li><li>当安装软件包时，其包含的所有文件都会硬链接到此位置，而不会占用而外的硬盘空间；</li></ul></li><li><p>这让你可以在项目之间方便地共享相同版本的依赖包。</p></li></ul><h2 id="pnpm创建非平铺的node-modules目录"><a href="#pnpm创建非平铺的node-modules目录" class="headerlink" title="pnpm创建非平铺的node_modules目录"></a>pnpm创建非平铺的node_modules目录</h2><h3 id="npm和yarn"><a href="#npm和yarn" class="headerlink" title="npm和yarn"></a>npm和yarn</h3><p>当使用npm或yarn安装依赖包时，所以软件包都被提升到node_modules的根目录下；<br>其结果是，源码可以访问本不属于当前项目所设定的依赖包。</p><h3 id="pnpm"><a href="#pnpm" class="headerlink" title="pnpm"></a>pnpm</h3><p>使用pnpm安装依赖包时，只有安装的那个包会在node_modules的根目录下，并且以软链接(符号链接)的方式存在；</p><p>在node_modules的根目录下同时还会有一个.pnpm文件，里面保存的是所有包的硬链接；其结果是，源码不可以访问本不属于当前项目所设定的依赖包。</p><h3 id="npm与pnpm命令对比"><a href="#npm与pnpm命令对比" class="headerlink" title="npm与pnpm命令对比"></a>npm与pnpm命令对比</h3><table><thead><tr><th>npm命令</th><th>pnpm等价命令</th></tr></thead><tbody><tr><td>npm install</td><td>pnpm install</td></tr><tr><td>npm install 包名</td><td>pnpm add 包名</td></tr><tr><td>npm uninstall 包名</td><td>pnpm remove 包名</td></tr><tr><td>npm run 脚本</td><td>pnpm 脚本</td></tr></tbody></table><h3 id="pnpm常用命令"><a href="#pnpm常用命令" class="headerlink" title="pnpm常用命令"></a>pnpm常用命令</h3><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">pnpm</span> store path  // 获取包仓库地址（pnpm的仓库不能跨磁盘）<span class="token function">pnpm</span> store prune  // 从store中删除当前未被引用的包来释放store的空间<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div></figure><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>文中对于软链接和硬链接等概念（操作系统里面的概念）并没有过多解释，但是这些概念对于理解pnpm的特点却又至关重要，建议先去了解一下。<br>想要了解更多，请移步官网：<a href="https://www.pnpm.cn/">pnpm中文官网链接</a></p><h2 id="封"><a href="#封" class="headerlink" title="封"></a>封</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h7y11f3rwvj33341w0u0y.jpg" alt="4k 长辫子女孩 耳环 侧脸 唯美 梅花 红色背影"></p>]]></content>
    
    
    <categories>
      
      <category>Other</category>
      
    </categories>
    
    
    <tags>
      
      <tag>pnpm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>一声叹息</title>
    <link href="/2022/11/07/gossip-12/"/>
    <url>/2022/11/07/gossip-12/</url>
    
    <content type="html"><![CDATA[<div class="note note-info">            <p>你做了一个美梦，所以你不愿意醒来。</p><p>但是现实总会给你一巴掌，把你硬生生打醒。</p>          </div><p>结束了小学的六年义务教育，我顺利的进入了后三年的义务教育，一直生活在村里的我来到了镇上上初中，而在农村读小学的我来到镇上和在镇上读小学的同学做同学 ，我明显的感觉我略显纯真，他们说的玩的做的，我都不会，都不懂，我为了弄懂这些花了很长时间，然后就，我好像忘了我来学校是干什么的，我还以为初中也和小学一样，就那几门课，随意发挥即可。</p><p>第一次考试很壮烈。第一门语文作文直接没写，其实也不怪我，他们都以为我知道这学校的铃声是怎么响的，但实际我不知道，我也是第一次参加月考，因为我的小学一学期只考两次试。万事开头难的头没开好的我，结果也就不用说了。</p><p>初中第一任班主任确实有点邪门，那届分了三个班，我在二班，班主任也是第一年当班主任，前几次月考还有几人能进前二十，再往后几次就一个都没有了，这个班级对于学校的唯一存在感可能就只是被当成反面教材。我一开始是以为学生的原因，再后来我听很多届学生说，那个班主任那届带班好像都不行，这班主任多少是有点问题在身上的。</p><p>当时初二时，我家里人看我好像确实不行了，然后主张给我留了一级，留了一级，便遇到了我的意义上的初恋。初恋，是一个大胸妹子，暂且称之为H姐，是她主动追的我，挺漂亮一姑娘，笑起来眼睛会变月牙，总爱穿个夹克，走路带风，当时成绩也比我好。</p><p>H姐是个很自信的人，从她追我来看，一个等待上晚自习的夏天傍晚，她喊了几个姐们，把我堵在教室，然后把教室门堵着不让别人进来。</p><p>教室里只剩我和她，她开门见山的我问一句，你觉得我这人怎么样？</p><p>我说：还行，胸很大，在她的手慢慢举过我的头顶时，我连忙正经起来接着说，怎么问这个，你人很好，脾气好，成绩也好，</p><p>她拿着当时上课用的三角板，向我走来，然后立在我面前的课桌上说，我做你女朋友，你感觉如何，</p><p>我当时有点懵，听到感觉两个字，我说感觉还行。</p><p>这就是H姐的表白。再后来就是一起上课下课，一起吃饭，一起过生日。</p><p>分手是在一个炎热的暑假，当时分手后其实还能再见的，因为暑假结束还在一个班。</p><p>再后来H姐就转学了，故事也终了了，再往后听到的点点星星的消息，就是H姐胸还是很大，但是我们再也没有见过面了。</p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h7wv3ddewfj32yo1o0hdt.jpg" alt="4K 阿狸 cosplay 漂亮的脸"></p>]]></content>
    
    
    <categories>
      
      <category>碎碎念</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>一个前端UI框架，javaexUI</title>
    <link href="/2022/11/04/other-08/"/>
    <url>/2022/11/04/other-08/</url>
    
    <content type="html"><![CDATA[<p>无聊刷国内的开源社区时，发现的一个UI框架，看仓库中的介绍是基于Jquery的，当时都不打算往下看了，看见有个文档地址，寻思既然都维护文档了，应该差不到哪里去。</p><p>进去看了之后，虽然这个文档Element里Element气的，但是组件的质量看起来不错的样子，组件的风格也十分的清新，我一开始以为是当成一个Layui来看的，看了之后，好像比Layui要好看点，组件也多了不少，至于使用体验，大致看了Crud仔用的较多的表格组件，貌似异步渲染的功能，目前还不支持。这个可能会限制一部分用户，因为现在哪还有自己绘制表格的，大多数就是写个接口，配置个字段Id，然后返回数据里就包含了主体数据及分页参数，然后一个表格就可以了用了。</p><p>就是如果重度使用表格组件的话，不建议用这个框架，如果是前后端不分离，用这个框架体验可能会很好。这个框架的表格组件还需在进行封装一下，至少支持通过纯JS渲染表格。</p><p>一些组件截图，更多详情还需去<a href="https://javaex.javaex.cn/doc-5.0.0/index.html">官网</a>查看。</p><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h7tbc9lfvwj318e0tdn9x.jpg" alt="image1"></p><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h7tbo7zi0pj31bp0vsn8n.jpg" alt="image2"></p><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h7tbp5ytasj31bv0uv42k.jpg" alt="image3"></p><h2 id="封"><a href="#封" class="headerlink" title="封"></a>封</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h7tbpruzn3j36683h0u0x.jpg" alt="早安 打工人 可爱 桌面分区"></p>]]></content>
    
    
    <categories>
      
      <category>Other</category>
      
    </categories>
    
    
    <tags>
      
      <tag>jquery</tag>
      
      <tag>javaexUI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>傲寒</title>
    <link href="/2022/11/02/gossip-11/"/>
    <url>/2022/11/02/gossip-11/</url>
    
    <content type="html"><![CDATA[<div class="note note-info">            <p>傲寒，我们结婚，在稻城冰雪融化的早晨。</p>          </div><div class="note note-secondary">            <p>在心理学里有个词叫lithromantic，我们称之为“版画式浪漫”，一个你喜欢的人，突然变得和你亲近后，你反而变得不敢喜欢她，一个你不喜欢的人，突然和你变得疏远了，你想起的却是她的各种好。这种人往往无法和别人建立亲密关系，原因是内心孤独恐惧，他害怕一不小心，就伤害到那个最在乎的人。</p>          </div><p>98年出生，出生那年安徽水灾挺严重的，我的性格可能也如水一般，说起水，我不禁想起泰戈尔的一句名言，使卵石臻于完美的不是锤的敲打，而是水的载歌载舞。</p><p>从小在农村长大，吃喝倒是不愁，但是想吃好还是一件挺难的事，回想起来，我家里在我小时候，是借钱过日子的。当时的我当然并感觉不到这些。我爷爷奶奶帮他们的儿子在老家带孩子，当时家里面四个小孩。嗯。</p><p>我从小就对吃喝不感兴趣，对一些玩具，小汽车什么的，非常感兴趣。可以很简略的说，不爱吃饭，贪玩。那时我认为在外面上班的爸爸妈妈超级厉害，可能就是暑假时，坐着长途大巴，透过车窗看着路上的路灯我都会大呼小叫着说路灯好看，如果看到霓虹灯，我恨不得想让全世界都知道，我看过这种霓虹灯。城市好啊，有好大好大的超市，有各种各样的零食，彩色电视机里有看不完的喜羊羊，说句见证历史的，仙剑奇侠传三，我看的第一遍是在黑白电视机上看的。</p><p>再回想其实当时爸妈刚出来时，日子也不会好过，我从我妈零碎的语言听过，刚来时，是真的没得吃，是的是没钱吃饭，但当时在老家起码有的吃。当时出去打工实际是无奈之举，一大家大的小的，十几口人，一句实话，当时老家那几间土房子，可能都住不下，更别提吃喝了。当我外出打工时，我才知道我爸妈他们的不容易，我条件比当时的父辈好多了，爸妈他们没有一技之长，我还算有一技之长，爸妈他们没读过什么书，我大差不差也算受到了一个完整的教育。我在我工作的城市还读了几年书，而我的爸妈，是实打实的农村男女。而我心理压力远远大于现实给我的压力，因为我知道，实在不行，我还能回家，爸妈那个年纪可能并没有回头路。</p><p>我看不起那些拿着爸妈给你提供的资源，站在他们的肩膀上看到了父辈没看过的世界，就感觉自己怎么怎么样了，到最后还去嫌弃他们的笨拙。</p><p>不知是从小天资聪慧，小学我过的顺风顺水，当时在老家小学读书，压力没有现在那么大，就两门课，语文数学，随便学一学，期末考试，一考就是第一，可能是我小时候不爱和他们那群所谓成绩好的玩吧，他们每次考试喜欢“团结合作”，而我不受他们的喜欢，平时考试，我只是当成和平时写作业一样，对于考试没有什么概念，或者说我对上学都没什么概念。</p><p>我家离学校比较近，那个年纪对外界事物比较好奇，当时我还没上学，我溜进学校趴在教室外面往里面看，然后被里面老师看见了，提溜耳朵就给我拽进了教室，然后我就被迫上了我人生的第一堂课。</p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h7qs2a87spj32yo1o0hdt.jpg" alt="紫色眼睛女孩"></p>]]></content>
    
    
    <categories>
      
      <category>碎碎念</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>十一月</title>
    <link href="/2022/11/01/gossip-10/"/>
    <url>/2022/11/01/gossip-10/</url>
    
    <content type="html"><![CDATA[<div class="note note-info">            <p>假如生活欺骗了你，那你就要变得聪明一点，生活只爱骗蠢货，大概就是这样。</p>          </div><p>我三岁的时候，我爸妈就丢下我们去上海打工了，在我记事以前，我对我爸妈没有什么过多的印象，在上小学的时候，我和我爸妈不怎么熟，过年回家的时候，我甚至有点怕我爸。</p><p>我和爷爷奶奶生活的时间占据我绝大部分的童年，我爷爷是个非常地道的农民，遇到要饭的也不会把人赶走，我奶奶也是一个非常开明的人，吃喝上面从来不吝啬。他们教不了我什么，我也不是个那么容易被教化的人，我本质里不是一个听话的小孩，但是我也算从小耳熏目染，我对人或对事上，多多少少有我爷爷奶奶的影子。</p><p>尊重每个人，无论对方是CEO还是职员，或者是保洁阿姨，职位虽有高低，但人格无高低贵贱，这个习惯陪了我很多年。</p><p>硬写文字太难受了，像是从脑袋里面刮东西一样，刮得呼呼响，还刮不出来东西，还得多多读书，多多看段子才行，不然写个日寄都写不好。</p><p>十一月了，希望疫情早点结束，一切生活都步入正轨吧，我在这里待得说不急是假的，我想回我的租房了。希望能抓住22年的尾巴，发生一点不一样的事吧。祈祷，</p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h7pws6buxmj32yo1o07wi.jpg" alt="cosplay 鬼刀 美女 红色裙子"></p>]]></content>
    
    
    <categories>
      
      <category>碎碎念</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>傍晚日寄</title>
    <link href="/2022/10/31/gossip-09/"/>
    <url>/2022/10/31/gossip-09/</url>
    
    <content type="html"><![CDATA[<div class="note note-primary">            <p>我们都是孤岛，千帆竟过，内心从未被人踏足。</p>          </div><div class="note note-info">            <p>“可是我忘不了东海水，忘不了花果山，忘不了西天路，忘不了路上的人。”</p>          </div><p>偶尔刷一刷知乎，看一些“段子手”写的文章，一些大佬写的回答，嗯，不看一天难受，看了难受一天。</p><p>回答的大部分基调无非两个核心，一个是爱，另一个是性。在这个爱而不得，得而不惜的时代，这两个话题总是能引起人们的共鸣。包括我。</p><div class="note note-info">            <p>对于爱，无法投入。<br>对于性，来者不拒。</p>          </div><p>我一直记的《后来的我们》中的一句台词“你一点都没变”，我想找到截图，发个朋友圈的，在拉进度条找不到的情况下，我又重新看了一遍。原来，我记错了。记错了这么多年。原本的台词是，“你一点都没长大，一点都没让我刮目相看”。和我脑海中的画面是一样的，也不一样。原来只是我的幻想。</p><p>文艺电影和知乎上的文艺文章有相似之处，一个一个俗套却现实的情节，一段一段类似伤痛文学但是却走心的台词，对话。凑出一个零碎且遗憾的爱情故事，但偏偏这个爱情故事，人们或多或少都有过类似经历，不完美的爱情，真的很常见。如果xxx，假如xxx，可惜没如果。。</p><div class="note note-info">            <p>幸福不是故事，不幸才是。</p>          </div><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h7orjvpdi4j32yo1o04qp.jpg" alt="晚霞 女孩"></p>]]></content>
    
    
    <categories>
      
      <category>碎碎念</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>封控日寄</title>
    <link href="/2022/10/28/gossip-08/"/>
    <url>/2022/10/28/gossip-08/</url>
    
    <content type="html"><![CDATA[<div class="note note-info">            <p>　　“这个世界有多大，取决于你认识多少人，你每认识一个人，世界对你来说就会变大一些。这个世界上有很多城市，有东京、巴黎、开罗、伦敦、伊斯坦布尔……但很多城市对你来说只是名字罢了，你没去过那里，那里也没有你想要拜访的人，所以它们其实不属于你的世界。这个世界上还有很多很多的人，但你不认识他们，他们也不属于你的世界。这个世界上还有很多好吃的好玩的好看的东西，可真正属于你的世界其实是很小的，只是你去过的地方吃过的东西和见过的落日，还有会在乎你死活的朋友。”</p>          </div><p>住在园区的第二天，挺佩服上海封了两三个月的，孤家寡人的封控真的没有人出现什么精神问题么，在屋子里面待了一天，之后的心情有点难以言喻，压抑，还住在不是自己的租房里面时，一种孤独和被遗忘的心境，我敲！！！</p><p>近日从网上捕风掠影一些郑州疫情的消息，让我感觉这个世界真的不会好了。一个富士康，上万人，然后没办法只能让人出去逃命？？？？徒步回家？？上百公里，起码得给个豪爵125吧。河南人，🤔🤔🤔🤔</p><p>新建这个文件的时间1028，现在时间是1030，反正又不急，加上等到紧急的时候，一句“这时候了，急也没用”，可应对各种情况，总之就是，我知道你很急，但是先别急。</p><p>网上看到一个新闻搞笑的</p><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h7n23fwismj310f0xj7nj.jpg" alt="刚"></p><p>微博看看同城，看他们分享的一些。因为离的不远，可能都是一些去过地方，感觉就还行，有种云出游的感觉。</p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h7n2o54s7vj32yo1o04qp.jpg" alt="4k 孤独的树"></p>]]></content>
    
    
    <categories>
      
      <category>碎碎念</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>网络框架三两言</title>
    <link href="/2022/10/25/net-05/"/>
    <url>/2022/10/25/net-05/</url>
    
    <content type="html"><![CDATA[<p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h7hkhmspx0j30hs0cogpj.jpg" alt="夏洛"></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>说起最近做梦又是前女友又是初中同学的，道心乱了，乱了。</p><p>2022年也接近尾声了，这周日10月30号，我身份证上的生日，过完我也就正式步入24周岁了。</p><p>回过头来，那句但行好事，莫问前程，好事做没做不知道，说句没做坏事，算不算做了好事。前程？上班也算前程的么。</p><p>我感觉我天天骑个电动车，晃荡晃荡的来，晃荡晃荡的回，还挺有意思的。</p><p>晚饭吃了几天的榨菜，给爷吃吐了，于是乎，决定在食堂吃饭吧，可是家里电饭锅里面还有煮好的饭，打这段话时，打了一个喷嚏，震得我屁股疼，端起保温杯赶紧喝了两口热水，体质下降是个不争的事实。</p><p>带状疱症缠了我两三周了，尽管我做到早睡早起，规律作息，由于我对吃饭不太讲究的原因，依旧是瘦了。</p><h2 id="网络框架"><a href="#网络框架" class="headerlink" title="网络框架"></a>网络框架</h2><p>说了挺多的闲话，该说说正事了，现在主流的网络框架在Java领域中能拿的出手的实际上只有Netty。</p><p>现在基于AIO的网络框架 怎么说呢，我只能说，你猜为什么Netty5.0鸽了。</p><p>Netty实际上差不多是自己实现了JDK的AIO且比JDK中的AIO要更稳定，当然说这话的时候，我没有去测试，这个东西单机百万长连接的测试，没点技术测不了的，有很多限制，比如Window的系统测不了，必须是Linux系统，而且Linux系统我记得还有个文件系统的什么限制要解除才能测，Linux中一个连接就是一个文件，单机百万，就是百万个文件。</p><p>Netty吹完了，再来看看国产的网络编程框架，如果你想写个IM系统练练手，以及想深入一下网络编程，建议TIO，这个框架迭代了很长时间，又写了很多工具方法便于人们使用。</p><p>如果想用来实践，但是并不是用来写那种负荷非常重的短连接，但是又不想去用性能非常低的BIO可以用smart-socket。个人推荐，无优劣之分，最适合自己业务的才是最好的。并不建议不使用框架，能用框架还是用框架的好。</p><h2 id="网络编程概念"><a href="#网络编程概念" class="headerlink" title="网络编程概念"></a>网络编程概念</h2><p>说一千，到一万，本质就是面向协议编程，对字节编解码的规则，被称之为协议。</p><p>Web编程，是网络编程的一支，Web编程对字节编解码的协议叫做Http协议，其主要原因还是浏览器牵头的，浏览器支持Http协议，Web编程也能说成面向浏览器编程。</p><p>在处理在服务和服务之间的网络通信，Http协议显得有点重了，因为Http协议携带了太多我们不需要的东西，然后http默认的短连接，频繁的挥手握手，严重的影响性能。</p><p>这个时候就需要单独定制协议以及使用长连接了，自己定制协议，这个就五花八门了，本质就是对字节编解码，编解码的字节一般用Buffer来操作，Buffer的基础操作也是网络编程的入门。用这个操作字节比较方便。</p><p>维持长连接的连接个数，这是网络框架的一个重要标准。我看网络框架动不动都是单机百万，维护了百万个长连接的服务器与客户算进行数据交互会是个什么情况。这个就需要专业的测试来操作了。</p><p>网络开发的难点一般就是在于长连接，短连接到也没有那么复杂的难度，因为都用短连接了，第一并发高不到哪里去，第二，不需要双方维持一个同步状态，服务器就很轻松。</p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h7hkg63d3uj33341xgx6p.jpg" alt="漂亮少数民族美女"></p>]]></content>
    
    
    <categories>
      
      <category>网络编程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>netty</tag>
      
      <tag>tio</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>上班日寄</title>
    <link href="/2022/10/19/gossip-07/"/>
    <url>/2022/10/19/gossip-07/</url>
    
    <content type="html"><![CDATA[<p>出去闲逛，深秋加上午后的阳光，照在身上还有点炎热，想起在老家收获的爹爹奶奶，我缓慢步行都有些许的燥热，如果在这个天气下进行体力劳作，应该会流汗的。回不去，说个正能量的事，核酸检测，以及新冠疫苗。</p><p>今日核酸：✔️</p><p>说起一个朋友，做梦梦见我和前女友复合了，我说不可能复合了，于是当晚我自己也梦见复合了，梦的真假，正反，我都不关注，我关注的是我好久没有梦见她了，也许是人提起的缘故。没有纠结什么，就当不存在就好。</p><p>刻意去遗忘总是事与愿违，作为天选打工人，在hf这里工作其实挺好，封了挺多区的我，并没有受到影响，疫情以来唯一被封发生在上周，上午封了，下午解了，乃至于我并没有多少感觉。我的朋友就比较尴尬了，封小区的封小区，以目前疫情的形式，只能说，做核酸的姐姐们捅喉咙时手劲也逐渐绵厚，失去了之前的蜻蜓点水般的优雅。</p><p>疫情形势，风声鹤唳，还有说zf在藏东西，怕到时有钱也买不到东西吃的境地，我也屯了点干粮。以防不时之需。榨菜，咸鸭蛋，咸蛋超人。午休无聊时打了几盘lolm，怎么打就是输不了，一路kuku快上钻石了，就是想掉分的，我以为我玩的够抽象了，没想到对面显然实力更强，玩了四盘，输了三盘，还上了一颗星，这个游戏就是把你拽上钻石段位，但是我只想打上上到铂金段位。加油下分。</p><p>无事期间买了一个电动车，天天上班找单车扫码扫烦了，哈罗单车什么的，感觉也并不需要了，但是我买的半年的卡还有两个月，学点电动车车技也是好事，给以后送外卖做点准备。未雨绸缪了属于是。</p><p>同学结婚的结婚，而我还还只能靠梦里和前女友复合，你说这叫什么事。看了眼项目代码，工作项目或者自己写的项目，还是太懒，懒到极致自然烂，神摆而形不摆，一边记，一边G。。</p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h7gg8s9onnj32yo1o0e82.jpg" alt="双马尾辫"></p>]]></content>
    
    
    <categories>
      
      <category>碎碎念</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mysql安装8.0+版本,以及主从复制的配置。</title>
    <link href="/2022/08/23/other-07/"/>
    <url>/2022/08/23/other-07/</url>
    
    <content type="html"><![CDATA[<h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p><a href="https://dev.mysql.com/downloads/mysql/">下载地址</a></p><p>这里下载软件是压缩包形式的，由于我们需要搭建主从复制，所有我们需要安装多个Mysql实例，使用压缩包形式的便于管理和安装。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>解压下载文件，包含bin目录的为根目录，在根目录下面新建<code>my.ini</code>文件，<br>文件内容</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span><span class="token comment"># 设置3306端口</span><span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">3308</span><span class="token comment"># 设置mysql的安装目录</span><span class="token assign-left variable">basedir</span><span class="token operator">=</span>D:<span class="token punctuation">\</span>Software<span class="token punctuation">\</span>mysql<span class="token punctuation">\</span>mysql-8.0.30-winx6422<span class="token comment"># 设置mysql数据库的数据的存放目录</span><span class="token assign-left variable">datadir</span><span class="token operator">=</span>D:<span class="token punctuation">\</span>Software<span class="token punctuation">\</span>mysql<span class="token punctuation">\</span>mysql-8.0.30-winx6422<span class="token punctuation">\</span>data<span class="token comment"># 此处同上</span><span class="token comment"># 允许最大连接数</span><span class="token assign-left variable">max_connections</span><span class="token operator">=</span><span class="token number">200</span><span class="token comment"># 允许连接失败的次数。这是为了防止有人从该主机试图攻击数据库系统</span><span class="token assign-left variable">max_connect_errors</span><span class="token operator">=</span><span class="token number">10</span><span class="token comment"># 服务端使用的字符集默认为UTF8</span>character-set-server<span class="token operator">=</span>utf8mb4collation-server <span class="token operator">=</span> utf8mb4_unicode_ci<span class="token comment"># 创建新表时将使用的默认存储引擎</span>default-storage-engine<span class="token operator">=</span>INNODB<span class="token comment"># 默认使用“mysql_native_password”插件认证</span><span class="token assign-left variable">default_authentication_plugin</span><span class="token operator">=</span>mysql_native_password<span class="token punctuation">[</span>mysql<span class="token punctuation">]</span><span class="token comment"># 设置mysql客户端默认字符集</span>default-character-set<span class="token operator">=</span>utf8mb4<span class="token punctuation">[</span>client<span class="token punctuation">]</span><span class="token comment"># 设置mysql客户端连接服务端时默认使用的端口</span><span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">3308</span>default-character-set<span class="token operator">=</span>utf8mb4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>解释一下，端口不是3306是因为我需要在电脑上装多个Mysql，安装位置和数据存储位置，自己修改。</p><p>下面就就是执行安装命令，使用管理员权限打开cmd,然后进入根目录中的bin目录下，执行,<code>mysqld install mysql_11</code>命令,最后为服务名称，就是我们执行<code>net start</code> 命令时启动的服务，我这里设置成了<code>mysql_11</code>,那么我执行的命令启动命令就应该是，<code>net start mysql</code>。</p><p>还是 在这个目录下执行初始化命令 <code>mysqld --initialize --console</code>，留意包含这样内容的输出内容。<code>[Server] A temporary password is generated for root@localhost: 这里是临时密码需要保存起来</code></p><p>操作无误时这个时候就可以启动服务了，命令：<code>net start mysql_11</code>, 必须使用管理员权限打开cmd执行命令，输出成功启动，则可以登陆</p><h2 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h2><p>命令：<code>mysql -uroot -p</code><br>按回车之后然后会提示你输入密码：<br>登录<code>mysql</code><br>也可以将密码直接填写在<code>-p</code>后面。例如：对于用户名为<code>root</code>，密码为<code>abcd</code>的账号，可以使用如下方式登录：<br><code>mysql -uroot -pabcd</code>。注意：<code>-u</code>和用户名，<code>-p</code>和密码之间没有空格。<br>mysql的一些参数：</p><p><code>-u</code>指定用户名。<br><code>-p</code>指定密码。<br><code>-h</code>指定主机地址。默认为localhost<br><code>-P</code>指定端口号，默认为3306（mysql服务默认的启动端口为3306）。例如：-P13306表示连接端口号为13306的MySQL服务器。（注意：密码为小写的p，端口号为大写的P）<br>可以在配置文件中指定启动的端口号。</p><h2 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h2><p>登录之后，在输入命令时，前面的提示符为：<code>mysql</code> &gt;在这后面输入的语句中，默认提交符号为分号<code>（;）</code>。按回车时只会换行，并不会提交语句。之后输入<code>;</code>之后按回车才会提交语句。</p><p>如果前面对<code>mysql</code>进行初始化使用的是<code>--initialize-insecure</code>命令，则密码为空，在输入密码时直接按回车即可。登录之后，不用修改密码即可直接使用<code>MySQL</code>。例如：创建数据库等操作。<br>如果前面对<code>mysql</code>进行初始化使用的是<code>--initialize</code>命令，则密码为系统随机生成的一个字符串。登录之后需要修改密码才能使用。<br>若不修改密码，直接操作数据库，会出现如下错误：<br><code>ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.</code><br>使用如下命令修改密码：<br><code>set password=&#39;new_password&#39;;</code>注意：新的密码前后有单引号。在<code>mysql</code>中，单引号之间表示的是字符串。<br><code>alter user &#39;root&#39;@&#39;localhost&#39; password expire never;</code>设置密码永不过期。<br><code>flush privileges;</code>刷新权限。<br>之后退出（使用<code>q</code>，或者<code>exit</code>或者<code>quit</code>都可以退出），然后重新登录即可。<br>至此，可以正常使用MySQL了。</p><h2 id="安装多个"><a href="#安装多个" class="headerlink" title="安装多个"></a>安装多个</h2><p>端口不能一致，然后<code>mysql install [服务名]</code>，服务名不能一致。就酱。</p><h2 id="主从复制配置"><a href="#主从复制配置" class="headerlink" title="主从复制配置"></a>主从复制配置</h2><h3 id="安装多个数据库"><a href="#安装多个数据库" class="headerlink" title="安装多个数据库"></a>安装多个数据库</h3><p>安装教程就是上面在重新装一个即可，改一下端口号以及服务的名称即可。当然这是在一台机器上，实际上主从复制应该是在不同机器上进行的操作。</p><h3 id="配置主库"><a href="#配置主库" class="headerlink" title="配置主库"></a>配置主库</h3><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#在mysqld下增加配置</span><span class="token comment">#服务器ID标志，必须配置，每个节点不同</span><span class="token assign-left variable">server_id</span><span class="token operator">=</span><span class="token number">1</span><span class="token comment">#开启bin log日志文件，文件名为mysql-bin的前缀</span>log-bin<span class="token operator">=</span>mysql-bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>重启主库</p><p>查看主库状态</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">show master status<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><p>主要关注<code>File</code> 和 <code>Position</code>字段</p><h3 id="设置从库"><a href="#设置从库" class="headerlink" title="设置从库"></a>设置从库</h3><p>从库设置<code>server_id</code>和主库不一样就行了，设置后重启。</p><p>如果需要设置从库只读则加上这两行</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">read_only</span><span class="token operator">=</span><span class="token number">1</span> <span class="token comment">#限定普通用户只读</span><span class="token assign-left variable">super_read_only</span><span class="token operator">=</span>on <span class="token comment">#限定root只读</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div></figure><p>然后在从库客户端配置连接主库相关信息：</p><figure><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">change master <span class="token keyword">to</span>     master_host <span class="token operator">=</span> <span class="token string">'192.168.127.147'</span><span class="token punctuation">,</span>     master_user <span class="token operator">=</span> <span class="token string">'replica'</span><span class="token punctuation">,</span>     master_port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>     master_password<span class="token operator">=</span><span class="token string">'123456'</span><span class="token punctuation">,</span>     master_log_file <span class="token operator">=</span> <span class="token string">'mysql-bin.000001'</span><span class="token punctuation">,</span>     master_log_pos<span class="token operator">=</span><span class="token number">156</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>里面的内容自己修改成对应的主库地址用户以及密码。</p><p>开启主从复制</p><figure><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">start</span> slave<span class="token punctuation">;</span><span class="token keyword">show</span> slave <span class="token keyword">status</span>\G<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div></figure><div class="note note-info">            <p>这次操作只是简单的演示了一下，主从操作，还有很多情况并未一一详述，比如主库中有数据时怎么处理，又或者只同步一个库应该怎么配置，还有如何设置从库只读，等等，这些都需要多多去学习，去操作。</p>          </div><h2 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h2><p>解压版的卸载很简单啊，首先停止服务<code>net stop mysql</code>,在执行命令<code>mysqld -remove [服务名]</code>   如 <code>mysqld -remove MySQL</code>, 最后删除文件即可。解压版的不需要清理注册表。</p><h2 id="封"><a href="#封" class="headerlink" title="封"></a>封</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h5gm5kyihnj32yo1tdaz9.jpg" alt="麻匪 女孩 脸 红色的花 唯美"></p>]]></content>
    
    
    <categories>
      
      <category>Other</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TCP粘包和拆包</title>
    <link href="/2022/08/08/net-04/"/>
    <url>/2022/08/08/net-04/</url>
    
    <content type="html"><![CDATA[<p>这个东西在网络编程中老生常谈的一个问题了，网上这个相关的知识非常之多。多到我关于这方便多打一个字，都是重复的那种，哈哈哈。还是以理解为主。</p><h2 id="TCP-x2F-IP协议分层模型"><a href="#TCP-x2F-IP协议分层模型" class="headerlink" title="TCP&#x2F;IP协议分层模型"></a>TCP&#x2F;IP协议分层模型</h2><p>网络到底分几层，有分七层的，有分四层的，也有分五层的。不钻牛角尖哈，大致看一下。</p><div class="note note-info">            <p>大学教科书中有说分成7层，也有说分成4层的，笔者觉得4层更合适一些，像七层中的第5、6层完全不是必须的，就算有也是各自制定协议，而制定协议的人基本不会去考虑第5层叫会话层第6层叫表示层，在私有应用层协议中，更多的是会私定一个握手互信协议，以表示通讯双方是互信的</p>          </div><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h4z73s0oplj32yo1o01kx.jpg" alt="网络通信协议分层图"></p><h3 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h3><ul><li>你想用java写一个网络程序，你写的这个程序就是应用层</li><li>所以QQ、微信、以及你正在使用的浏览器，都是应用层</li></ul><p>这层就是我们主要关注的，我们写的绝大部分代码写的也就是这层。</p><h3 id="传输层"><a href="#传输层" class="headerlink" title="传输层"></a>传输层</h3><ul><li>传输层要么走TCP协议，要么走UDP协议，没有第三种协议。</li><li>TCP协议的通信双方，需要知道彼此都在家呆着，且由客户端主动发起连接。</li><li>UDP协议，客户端知道服务器家住在哪，但并不知道服务器在不在家，扔条消息去服务器家，如果服务器不在家这条消息就被丢了。</li></ul><h3 id="其他的"><a href="#其他的" class="headerlink" title="其他的"></a>其他的</h3><p>太过底层的我们接触不到，编程语言已经封装好了。再或者可能操作系统也给你封装好了。用就行了。</p><h2 id="粘包和拆包是怎么产生的"><a href="#粘包和拆包是怎么产生的" class="headerlink" title="粘包和拆包是怎么产生的"></a>粘包和拆包是怎么产生的</h2><p>归根结底，就是TCP是个“流”协议，没有界限的一串数据。TCP底层并不了解上层业务数据的具体含义，它会根据TCP缓冲区的实际情况进行包的划分，所以在业务上认为，一个完整的包可能会被TCP拆分成多个包进行发送，也有可能把多个小的包封装成一个大的数据包发送，这就是所谓的TCP粘包和拆包问题。这样说可能不太理解，随便搜索一下一大堆，看几篇就就理解了。</p><h2 id="如何解决"><a href="#如何解决" class="headerlink" title="如何解决"></a>如何解决</h2><p>上面说了，是一个没有界限一串数据，那么我们传输数据的时候加个界限不就好了。加界限的方式也就是解决方案，有直接加分隔符的，有规定每次接收字节长度的（不怎么常用），还有就是每次发报文，在报文的头部几个字节，和接收方说，我要发多少字节数据的（常用！！）。</p><p>netty解决方案：关注一下这两个类即可。<code>LengthFieldBasedFrameDecoder</code>,<code>LengthFieldPrepender</code>这两个类采用了在报文头部增加表示报文长度的数据。</p><p>TIO里，官网上示例的编解码解码器已经做了粘包和拆包的处理。处理方式同上。之前写的那篇博文可以看一下，就是里面的编解码代码。</p><h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>多多理解，理解之后哪怕让你写一个简单的拆包粘包处理方案你也能写出来，但是，在框架的有的情况下，不建议自己去写，因为这个粘包和半包处理在多线程中处理起来，有点麻烦，需要拼接数据，如果第一次发了一半，第二次怎么处理，如果收多了，又怎么处理，并不简单。现成的轮子就好好用。😃😃</p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h50ai5k50pj32yo1o0dqo.jpg" alt="快乐工作 早日退休"></p>]]></content>
    
    
    <categories>
      
      <category>网络编程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>net</tag>
      
      <tag>netty</tag>
      
      <tag>tio</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>使用T-IO写的一个简易的聊天室Demo</title>
    <link href="/2022/08/06/net-03/"/>
    <url>/2022/08/06/net-03/</url>
    
    <content type="html"><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>依据官网上的样例稍加改造，改成了一个简约的聊天室Demo，如官网上所说，这个Demo实际上都可以放生产上，基本的通信已经解决了。只需要根据自己的业务适配一下即可。话不多说，直接整流程。</p><h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><p>目前只用到了核心，引入即可</p><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.t-io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>tio-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.8.2.v20220628-RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="一些常量"><a href="#一些常量" class="headerlink" title="一些常量"></a>一些常量</h2><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatConst</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 绑定的群组标识     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> groupNo <span class="token operator">=</span> <span class="token string">"2333"</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 服务的端口     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">8011</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 默认为本机的IP     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> ip <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="数据包载体，可以理解为Vo"><a href="#数据包载体，可以理解为Vo" class="headerlink" title="数据包载体，可以理解为Vo"></a>数据包载体，可以理解为Vo</h2><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatPack</span> <span class="token keyword">extends</span> <span class="token class-name">Packet</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> body<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBody</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>body <span class="token operator">=</span> body<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 消息头的长度，在读取写入时我们用了Int类型</span>    <span class="token comment">// buffer.putInt(),以及buffer.getInt()</span>    <span class="token comment">// 所以 这里为4个字节长度。</span>    <span class="token comment">// 注意这里的长度，并不是指数字的长度，而是字节长度！请务必理解，</span>    <span class="token comment">// 本人在这里迷惑了挺长时间。</span>    <span class="token comment">// 此处代码也不建议修改，修改的话需要动编解码中的代码</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> HEAD_LENGTH <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ChatPack</span> <span class="token function">getPack</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">ChatPack</span> pack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChatPack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pack<span class="token punctuation">.</span><span class="token function">setBody</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> pack<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="编码解码"><a href="#编码解码" class="headerlink" title="编码解码"></a>编码解码</h2><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * 客户端服务端编码解码通用，一般无需修改 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DecodeOrEncode</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 解码     * @param buffer buffer     * @param readableLength 实际数据长度     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Packet</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> buffer<span class="token punctuation">,</span><span class="token keyword">int</span> readableLength<span class="token punctuation">,</span> <span class="token class-name">ChannelContext</span> channelContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TioDecodeException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//提醒：buffer的开始位置并不一定是0，应用需要从buffer.position()开始读取数据</span>        <span class="token comment">//收到的数据组不了业务包，则返回null以告诉框架数据不够</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>readableLength <span class="token operator">&lt;</span> <span class="token class-name">ChatPack</span><span class="token punctuation">.</span>HEAD_LENGTH<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//读取消息体的长度</span>        <span class="token keyword">int</span> bodyLength <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//数据不正确，则抛出AioDecodeException异常</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>bodyLength <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TioDecodeException</span><span class="token punctuation">(</span><span class="token string">"bodyLength ["</span> <span class="token operator">+</span> bodyLength <span class="token operator">+</span> <span class="token string">"] is not right, remote:"</span> <span class="token operator">+</span> channelContext<span class="token punctuation">.</span><span class="token function">getClientNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//计算本次需要的数据长度</span>        <span class="token keyword">int</span> neededLength <span class="token operator">=</span> <span class="token class-name">ChatPack</span><span class="token punctuation">.</span>HEAD_LENGTH <span class="token operator">+</span> bodyLength<span class="token punctuation">;</span>        <span class="token comment">//收到的数据是否足够组包</span>        <span class="token keyword">int</span> isDataEnough <span class="token operator">=</span> readableLength <span class="token operator">-</span> neededLength<span class="token punctuation">;</span>        <span class="token comment">// 不够消息体长度(剩下的buffer组不了消息体)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>isDataEnough <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token comment">//组包成功</span>        <span class="token punctuation">&#123;</span>            <span class="token class-name">ChatPack</span> chatPack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChatPack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>bodyLength <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> dst <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>bodyLength<span class="token punctuation">]</span><span class="token punctuation">;</span>                buffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>dst<span class="token punctuation">)</span><span class="token punctuation">;</span>                chatPack<span class="token punctuation">.</span><span class="token function">setBody</span><span class="token punctuation">(</span>dst<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> chatPack<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 编码     * @param packet 数据包     * @param tioConfig 抽象     * @return buffer     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ByteBuffer</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">Packet</span> packet<span class="token punctuation">,</span> <span class="token class-name">TioConfig</span> tioConfig<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ChatPack</span> chatPack <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ChatPack</span><span class="token punctuation">)</span> packet<span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body <span class="token operator">=</span> chatPack<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> bodyLen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>body <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            bodyLen <span class="token operator">=</span> body<span class="token punctuation">.</span>length<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//bytebuffer的总长度是 = 消息头的长度 + 消息体的长度</span>        <span class="token keyword">int</span> allLen <span class="token operator">=</span> <span class="token class-name">ChatPack</span><span class="token punctuation">.</span>HEAD_LENGTH <span class="token operator">+</span> bodyLen<span class="token punctuation">;</span>        <span class="token comment">//创建一个新的bytebuffer</span>        <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span>allLen<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//设置字节序</span>        buffer<span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span>tioConfig<span class="token punctuation">.</span><span class="token function">getByteOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//写入消息头----消息头的内容就是消息体的长度</span>        buffer<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span>bodyLen<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//写入消息体</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>body <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            buffer<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> buffer<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h2><p>服务端包括三个类，一个启动类，一个Handler处理类，一个监听类</p><p>监听类<br>ChatServerListener.java</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatServerListener</span> <span class="token keyword">implements</span> <span class="token class-name">TioServerListener</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 服务器检查到心跳超时时，会调用这个函数（一般场景，该方法只需要直接返回false即可）     *     * @param interval              已经多久没有收发消息了，单位：毫秒     * @param heartbeatTimeoutCount 心跳超时次数，第一次超时此值是1，以此类推。此值被保存在：channelContext.stat.heartbeatTimeoutCount     * @return 返回true，那么服务器则不关闭此连接；返回false，服务器将按心跳超时关闭该连接     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onHeartbeatTimeout</span><span class="token punctuation">(</span><span class="token class-name">ChannelContext</span> channelContext<span class="token punctuation">,</span> <span class="token class-name">Long</span> interval<span class="token punctuation">,</span> <span class="token keyword">int</span> heartbeatTimeoutCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>heartbeatTimeoutCount <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 建链后触发本方法，注：建链不一定成功，需要关注参数isConnected     *     * @param channelContext 包罗万象     * @param isConnected    是否连接成功,true:表示连接成功，false:表示连接失败     * @param isReconnect    是否是重连, true: 表示这是重新连接，false: 表示这是第一次连接     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAfterConnected</span><span class="token punctuation">(</span><span class="token class-name">ChannelContext</span> channelContext<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isConnected<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isReconnect<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>isConnected<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>channelContext<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"--进入房间..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Tio</span><span class="token punctuation">.</span><span class="token function">sendToGroup</span><span class="token punctuation">(</span>channelContext<span class="token punctuation">.</span>tioConfig<span class="token punctuation">,</span> <span class="token class-name">ChatConst</span><span class="token punctuation">.</span>groupNo<span class="token punctuation">,</span><span class="token class-name">ChatPack</span><span class="token punctuation">.</span><span class="token function">getPack</span><span class="token punctuation">(</span>channelContext<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"--进入房间..."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 绑定群组</span>            <span class="token class-name">Tio</span><span class="token punctuation">.</span><span class="token function">bindGroup</span><span class="token punctuation">(</span>channelContext<span class="token punctuation">,</span> <span class="token class-name">ChatConst</span><span class="token punctuation">.</span>groupNo<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 原方法名：onAfterDecoded     * 解码成功后触发本方法     *     * @param channelContext 包罗万象     * @param packet 数据包     * @param packetSize 数据包大小     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAfterDecoded</span><span class="token punctuation">(</span><span class="token class-name">ChannelContext</span> channelContext<span class="token punctuation">,</span> <span class="token class-name">Packet</span> packet<span class="token punctuation">,</span> <span class="token keyword">int</span> packetSize<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 接收到TCP层传过来的数据后     *     * @param receivedBytes  本次接收了多少字节     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAfterReceivedBytes</span><span class="token punctuation">(</span><span class="token class-name">ChannelContext</span> channelContext<span class="token punctuation">,</span> <span class="token keyword">int</span> receivedBytes<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 消息包发送之后触发本方法     *     * @param isSentSuccess  true:发送成功，false:发送失败     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAfterSent</span><span class="token punctuation">(</span><span class="token class-name">ChannelContext</span> channelContext<span class="token punctuation">,</span> <span class="token class-name">Packet</span> packet<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isSentSuccess<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 处理一个消息包后     * @param cost           本次处理消息耗时，单位：毫秒     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAfterHandled</span><span class="token punctuation">(</span><span class="token class-name">ChannelContext</span> channelContext<span class="token punctuation">,</span> <span class="token class-name">Packet</span> packet<span class="token punctuation">,</span> <span class="token keyword">long</span> cost<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 连接关闭前触发本方法     *     * @param channelContext the channelcontext     * @param throwable      the throwable 有可能为空     * @param remark         the remark 有可能为空     * @author tanyaowu     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onBeforeClose</span><span class="token punctuation">(</span><span class="token class-name">ChannelContext</span> channelContext<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> throwable<span class="token punctuation">,</span> <span class="token class-name">String</span> remark<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isRemove<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>channelContext<span class="token operator">+</span><span class="token string">"--离开房间..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Tio</span><span class="token punctuation">.</span><span class="token function">sendToGroup</span><span class="token punctuation">(</span>channelContext<span class="token punctuation">.</span>tioConfig<span class="token punctuation">,</span> <span class="token class-name">ChatConst</span><span class="token punctuation">.</span>groupNo<span class="token punctuation">,</span>                <span class="token class-name">ChatPack</span><span class="token punctuation">.</span><span class="token function">getPack</span><span class="token punctuation">(</span>channelContext<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"--离开房间..."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>处理类<br>ChatServerHandler.java</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatServerHandler</span> <span class="token keyword">implements</span> <span class="token class-name">TioServerHandler</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Packet</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> buffer<span class="token punctuation">,</span> <span class="token keyword">int</span> limit<span class="token punctuation">,</span> <span class="token keyword">int</span> position<span class="token punctuation">,</span> <span class="token keyword">int</span> readableLength<span class="token punctuation">,</span> <span class="token class-name">ChannelContext</span> channelContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TioDecodeException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 这里可以做一些额外操作</span>        <span class="token keyword">return</span> <span class="token class-name">DecodeOrEncode</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> limit<span class="token punctuation">,</span> channelContext<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">ByteBuffer</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">Packet</span> packet<span class="token punctuation">,</span> <span class="token class-name">TioConfig</span> tioConfig<span class="token punctuation">,</span> <span class="token class-name">ChannelContext</span> channelContext<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 这里可以做一些额外操作</span>        <span class="token keyword">return</span> <span class="token class-name">DecodeOrEncode</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>packet<span class="token punctuation">,</span> tioConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token class-name">Packet</span> packet<span class="token punctuation">,</span> <span class="token class-name">ChannelContext</span> channelContext<span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>        <span class="token class-name">ChatPack</span> pack <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ChatPack</span><span class="token punctuation">)</span> packet<span class="token punctuation">;</span>        <span class="token class-name">String</span> msg <span class="token operator">=</span> pack<span class="token punctuation">.</span><span class="token function">toStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>channelContext <span class="token operator">+</span> <span class="token string">"-发送消息="</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 单体不需要了</span>        <span class="token comment">//Tio.send(channelContext, ChatPack.getPack("服务端收到了你的消息-" + msg));</span>        <span class="token class-name">Tio</span><span class="token punctuation">.</span><span class="token function">sendToGroup</span><span class="token punctuation">(</span>channelContext<span class="token punctuation">.</span>tioConfig<span class="token punctuation">,</span> <span class="token class-name">ChatConst</span><span class="token punctuation">.</span>groupNo<span class="token punctuation">,</span><span class="token class-name">ChatPack</span><span class="token punctuation">.</span><span class="token function">getPack</span><span class="token punctuation">(</span>channelContext<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"--发送消息："</span><span class="token operator">+</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>启动类<br>ChatServer.java</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatServer</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">new</span> <span class="token class-name">TioServer</span><span class="token punctuation">(</span>                <span class="token keyword">new</span> <span class="token class-name">TioServerConfig</span><span class="token punctuation">(</span><span class="token string">"chatServer"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">ChatServerHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">ChatServerListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token class-name">ChatConst</span><span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="客户端代码类似"><a href="#客户端代码类似" class="headerlink" title="客户端代码类似"></a>客户端代码类似</h2><p>客户端代码没有编写监听类，其实和服务端差不多。</p><p>处理类<br>ChatClientHandler.java</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatClientHandler</span> <span class="token keyword">implements</span> <span class="token class-name">TioClientHandler</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Packet</span> <span class="token function">heartbeatPacket</span><span class="token punctuation">(</span><span class="token class-name">ChannelContext</span> channelContext<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">ChatPack</span><span class="token punctuation">.</span><span class="token function">getPack</span><span class="token punctuation">(</span><span class="token string">"ping"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Packet</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">ByteBuffer</span> buffer<span class="token punctuation">,</span> <span class="token keyword">int</span> limit<span class="token punctuation">,</span> <span class="token keyword">int</span> position<span class="token punctuation">,</span> <span class="token keyword">int</span> readableLength<span class="token punctuation">,</span> <span class="token class-name">ChannelContext</span> channelContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TioDecodeException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">DecodeOrEncode</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> limit<span class="token punctuation">,</span> channelContext<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">ByteBuffer</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">Packet</span> packet<span class="token punctuation">,</span> <span class="token class-name">TioConfig</span> tioConfig<span class="token punctuation">,</span> <span class="token class-name">ChannelContext</span> channelContext<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">DecodeOrEncode</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>packet<span class="token punctuation">,</span> tioConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token class-name">Packet</span> packet<span class="token punctuation">,</span> <span class="token class-name">ChannelContext</span> channelContext<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ChatPack</span> pack <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ChatPack</span><span class="token punctuation">)</span> packet<span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"收到消息："</span><span class="token operator">+</span>pack<span class="token punctuation">.</span><span class="token function">toStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>启动类<br>ChatClient.java</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatClient</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ReconnConf</span> reconnConf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReconnConf</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 失败十次就不再重连</span>        reconnConf<span class="token punctuation">.</span><span class="token function">setRetryCount</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Node</span> node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token class-name">ChatConst</span><span class="token punctuation">.</span>ip<span class="token punctuation">,</span> <span class="token class-name">ChatConst</span><span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">TioClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TioClient</span><span class="token punctuation">(</span>                <span class="token keyword">new</span> <span class="token class-name">TioClientConfig</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ChatClientHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token keyword">null</span><span class="token punctuation">,</span>                        reconnConf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ClientChannelContext</span> connect <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Tio</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>connect<span class="token punctuation">,</span><span class="token class-name">ChatPack</span><span class="token punctuation">.</span><span class="token function">getPack</span><span class="token punctuation">(</span><span class="token string">"你好世界"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> str <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"exit"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Tio</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>connect<span class="token punctuation">,</span><span class="token string">"关闭连接"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Tio</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>connect<span class="token punctuation">,</span><span class="token class-name">ChatPack</span><span class="token punctuation">.</span><span class="token function">getPack</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><div class="note note-info">            <p>代码量算有一点小多的，但是这个代码确实可以直接放生产上，用来做一些报文的传输之类的，应该挺稳的。主要多多学习这个多客户端之间的通信操作吧，用这个Tio可以省很多时间。</p>          </div><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h4wgwuso4bj32yo1p3kjl.jpg" alt="集原美 湖光中的睡美人"></p>]]></content>
    
    
    <categories>
      
      <category>网络编程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>网络编程</tag>
      
      <tag>TIO</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BIO的代码实现，客户端以及服务端</title>
    <link href="/2022/08/03/net-02/"/>
    <url>/2022/08/03/net-02/</url>
    
    <content type="html"><![CDATA[<p>BIO-同步阻塞IO，直接上代码。</p><h2 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h2><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">OutputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">ServerSocket</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">Socket</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SocketServer</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>          <span class="token comment">// 绑定端口</span>            <span class="token class-name">ServerSocket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">8082</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"等待客户端连接..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// 同步阻塞，直到建立连接，意思就是在这里会堵塞，如果没有客户端连接的话，</span>                <span class="token comment">// 代码会停在这里。</span>                <span class="token class-name">Socket</span> client <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// 有客户端连接了，才会往下执行。</span>                <span class="token comment">// 发送一个消息给客户端 ，这里通过输入输出流来进行交互</span>                <span class="token class-name">OutputStream</span> output <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                output<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"客户端["</span> <span class="token operator">+</span> client<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]你好，你已成功连接到8082服务端"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// 刷新缓冲区</span>                output<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"客户端已连接:"</span> <span class="token operator">+</span> client<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">InputStream</span> input <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                    <span class="token comment">// 同步阻塞 读取客户端数据 直到输入数据，连接之后，又进行堵塞，读取客户端发送的数据。</span>                    <span class="token keyword">while</span> <span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        output<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"收到了你的消息:"</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        output<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"收到客户端消息:"</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">// 客户端链接断开则引发异常</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"引发异常："</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">OutputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">Socket</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Scanner</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SocketClient</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// 接收控制台用户输入的数据</span>            <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 要绑定的主机和端口号</span>            <span class="token class-name">Socket</span> socketClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">8082</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 启动线程监听服务端发送的消息</span>            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                  <span class="token comment">// 获取输入流，读取服务器发送过来的消息</span>                    <span class="token class-name">InputStream</span> input <span class="token operator">=</span> socketClient<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"收到服务端消息:"</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 获取输出流，用来向服务器发送消息</span>            <span class="token class-name">OutputStream</span> output <span class="token operator">=</span> socketClient<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">String</span> str <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// 一个小tip</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"exit"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    output<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    socketClient<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">// 向服务端发送消息</span>                    output<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    output<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>很简单的一个小栗子，看一看然后自己瞧一瞧，也会更容易理解。代码可以直接运行的。</p><div class="note note-info">            <p>看山是山，看山不是山，看山还是山。</p>          </div><div class="note note-primary">            <p>IDEA小TIPS：<br>  复制完整的代码文本，在IDEA里可以直接粘贴会根据文本直接生成一个类。</p>          </div><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h4tmr1scs4j32yo1o0hdu.jpg" alt="阳光 草地 郊游 坐在草地上的美女 旗袍 鲜花"></p>]]></content>
    
    
    <categories>
      
      <category>网络编程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>网络编程</tag>
      
      <tag>BIO</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>快速删除文件夹</title>
    <link href="/2022/08/03/other-06/"/>
    <url>/2022/08/03/other-06/</url>
    
    <content type="html"><![CDATA[<p>大伙应该都经历过删除一个webpack项目删了十几分钟的经历吧😆😆</p><p>快速删除命令</p><h2 id="win"><a href="#win" class="headerlink" title="win"></a>win</h2><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rmdir</span> /s/q <span class="token punctuation">[</span>文件夹名称<span class="token punctuation">]</span><span class="token comment"># 举个栗子</span><span class="token function">rmdir</span> /s/q app<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h2><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 强制删除文件，无需确认，如果是文件夹那就是删除文件夹。</span><span class="token function">rm</span> -rf <span class="token punctuation">[</span>文件夹名称<span class="token punctuation">]</span><span class="token comment"># 举个栗子</span><span class="token function">rm</span> -rf app<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="封"><a href="#封" class="headerlink" title="封"></a>封</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h4te74p99xj32yo1o0kjl.jpg" alt="阿狸 cosplay"></p>]]></content>
    
    
    <categories>
      
      <category>Other</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rm</tag>
      
      <tag>删除</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>网络编程三两言</title>
    <link href="/2022/08/02/net-01/"/>
    <url>/2022/08/02/net-01/</url>
    
    <content type="html"><![CDATA[<p>浅学了一段时间的网络编程知识，从基础的bio,到nio,再到aio(nio2.0)，国产框架里看了tio，国外看了netty,<br>大致总结网络框架，实际就是实现网络的IO操作，要想跑的快，异步，多线程，零拷贝，三者缺一不可。还好有现在的框架。</p><p>说下学习思路，学的时候不要觉得框架复杂，信我，如果需要手撸一个网络通信功能时，使用稍微复杂点的NIO，想写出一个先不提速度，就单说可靠，实用的网络通信代码时，一时半会是撸不出来，异步，多线程，这技术，对于编码能力有一定的要求。</p><p>网络通信这块，在现在学习编程的氛围中，好像没有被那么重视，一部分是现在各种框架封装的太好了，一部分是现在的工作氛围吧，都追求低代码了，你说你去学网络编程，闹呢。</p><h2 id="几种IO模型"><a href="#几种IO模型" class="headerlink" title="几种IO模型"></a>几种IO模型</h2><ul><li>BIO-同步阻塞IO<ul><li>传统IO，是JDK1.4之前的传统IO模型，既然说起这个模型，网上大把的图，光看图会有点难懂，找点基础代码写写，再回看这个模型，就能懂了，核心可以理解，一个线程只能处理一个客户端，肯定支持不了如今的网络盛况。不过，该说不说，我所处的工作单位依旧有使用这种IO来进行网络传输的。</li></ul></li><li>NIO-同步非阻塞IO<ul><li>新一代的网络传输IO模型，加了三个东西Select，Buffer，还有channel（通道），这三个组合了一下，鸟枪换炮了。网络上模型图很多，看了之后找点代码敲一下，主要是为了理解这个模型去敲代码，至于实战，还得用框架。大致说一下，就是一个select管理了多个channel，一个channel对应一个buffer，一个客户端也对应一个channel，客户端的channel和服务的channel之间使用buffer进行数据交互，buffer这里是数据载体，交换任务是channel做的。一个select需要一个线程，但是一个select可以管理多个channel，且是非阻塞模式，是由事件驱动的，这样就大大的节省的系统资源，让高并发有了可能，</li></ul></li><li>AIO-异步非阻塞IO<ul><li>就是NIO2.0，还在nio包下。加了异步，多多关注nio即可。</li></ul></li></ul><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h4tdo39n18j32yo1o0qv5.jpg" alt="巴图BaTu"></p>]]></content>
    
    
    <categories>
      
      <category>网络编程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>网络编程</tag>
      
      <tag>IO</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java18的一个特性引发的IDEA控制台中文乱码的问题</title>
    <link href="/2022/06/26/java-16/"/>
    <url>/2022/06/26/java-16/</url>
    
    <content type="html"><![CDATA[<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><blockquote><p>今天用到JDK 18，遇到中文在IDEA控制台输出是乱码，但是文件输出是正常的问题，经过排查，确定是在IDEA 2021.3.3下使用JDK 18打印到IDEA控制台才会出现的bug。将项目编译打包，在cmd等命令行窗口中控制台使出的中文是正常的。</p></blockquote><h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><ol><li>切换项目默认文件字符集为GBK</li><li>启动行添加VM参数：</li></ol><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">-</span><span class="token class-name">Dfile</span><span class="token punctuation">.</span>encoding<span class="token operator">=</span>COMPAT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><h3 id="复现情况"><a href="#复现情况" class="headerlink" title="复现情况"></a>复现情况</h3><p>今天写学demo时用到了JDK 18，结果发现控制台输出的中文有乱码，如</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>你好 <span class="token class-name">JeremyTsai</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><p>打印出来的效果如下：</p><p><code>��� JeremyTsai</code></p><blockquote><p>里面的你好乱码了。一开始还以为是JDK的bug，但是尝试打包出来，在cmd运行，又是正常的。于是乎怀疑是IDEA控制台的bug。故写了以下代码测试：</p></blockquote><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileNotFoundException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileOutputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span></span><span class="token punctuation">;</span><span class="token comment">/** * @author JeremyTsai * @version 0 * @since 2022/6/2 00:10 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">FileOutputStream</span> out<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"log.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Java版本为: "</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"java.version"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"文件编码为: "</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"file.encoding"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"本地编码为: "</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"native.encoding"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"你好 JeremyTsai"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"\\r\\n"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><blockquote><p>上述代码分别测试IDEA控制台打印和文件输出打印。<br>测试结果如下：<br>JDK17 IDEA控制台输出正常，文件输出正常。</p></blockquote><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Java</span>版本为<span class="token operator">:</span> <span class="token number">17</span>文件编码为<span class="token operator">:</span> UTF<span class="token operator">-</span><span class="token number">8</span>本地编码为<span class="token operator">:</span> GBK你好 <span class="token class-name">JeremyTsai</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div></figure><blockquote><p>JDK18 IDEA控制台乱码，文件输出正常。</p></blockquote><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Java</span>�汾Ϊ<span class="token operator">:</span> <span class="token number">1</span>�ļ�����Ϊ<span class="token operator">:</span> UTF<span class="token operator">-</span><span class="token number">8</span>���ر���Ϊ<span class="token operator">:</span> GBK��� <span class="token class-name">JeremyTsai</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="问题研究"><a href="#问题研究" class="headerlink" title="问题研究"></a>问题研究</h3><blockquote><p>值得关注的一点就是，native encoding都是GBK，这是因为我本地是中文的windows系统。这里会乱码，也是因为JDK18的新特性：JEP400: 默认字符集UTF-8导致的，猜想可能是因为IDEA的控制台的编解码有问题。所以解决的方案就有很多，因为本地是中文系统，最简单的就是将项目字符集转成GBK，这样file.encoding和native encoding都是GBK，不可能存在编解码问题。还有一个解决方案就是在UTF-8字符集的项目启动时加VM参数</p></blockquote><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">-</span><span class="token class-name">Dfile</span><span class="token punctuation">.</span>encoding<span class="token operator">=</span>COMPAT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><p>也可以解决。在JDK 17引入了native.encoding系统属性，作为程序获得JDK算法所选字符集的标准方式，而不管默认字符集是否实际配置为该字符集。在 JDK 18中，如果在命令行上将file.encoding设置为COMPAT，那么file.encoding的运行时值将与native.encoding的运行时值相同; 如果在命令行上将file.encoding设置为 UTF-8，那么 file.encoding 的运行时值可能与native.encoding的运行时值不同。</p><h3 id="JEP400-默认字符集UTF-8"><a href="#JEP400-默认字符集UTF-8" class="headerlink" title="JEP400 默认字符集UTF-8"></a>JEP400 默认字符集UTF-8</h3><h3 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h3><blockquote><p>指定 utf-8作为标准 Java APIs 的默认字符集。通过这一更改，依赖于默认字符集的 api 将在所有实现、操作系统、区域设置和配置中表现一致。</p></blockquote><h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><ol><li>当Java程序的代码依赖于默认字符集时，使它们更可预测和可移植</li><li>明确标准Java API在任何地方使用默认字符集</li><li>除控制台 I&#x2F;O 之外，标准化所有标准Java API中的 UTF-8</li></ol><h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><ul><li><a href="https://openjdk.org/jeps/400">JEP 400: UTF-8 by Default</a></li></ul><hr><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h3lujiyy3pj32yo1o0x5i.jpg" alt="梦华录插画风"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java18</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cron表达式</title>
    <link href="/2022/06/11/linux-02/"/>
    <url>/2022/06/11/linux-02/</url>
    
    <content type="html"><![CDATA[<p><a href="https://help.aliyun.com/document_detail/64769.html">原文链接</a></p><h3 id="Cron表达式介绍"><a href="#Cron表达式介绍" class="headerlink" title="Cron表达式介绍"></a>Cron表达式介绍</h3><blockquote><p>Cron表达式是一个具有时间含义的字符串，字符串以<code>5~6</code>个空格隔开，分为<code>6~7</code>个域，格式为<code>X X X X X X X</code>。其中<code>X</code>是一个域的占位符。最后一个代表年份的域非必须，可省略。单个域有多个取值时，使用半角逗号<code>,</code>隔开取值。每个域可以是确定的取值，也可以是具有逻辑意义的特殊字符。每个域最多支持一个前导零。</p></blockquote><div class="note note-info">            <p><code>说明</code> 如指定2022年每天上午8:15执行任务，Cron表达式可指定为<code>0 15 8 ? * * 2022</code>或<code>0 15 08 ? * * 2022</code>，而不能指定为<code>0 15 008 ? * * 2022</code>。</p>          </div><h3 id="域取值"><a href="#域取值" class="headerlink" title="域取值"></a>域取值</h3><blockquote><p>下表为Cron表达式中六个域能够取的值以及支持的特殊字符。</p></blockquote><table><thead><tr><th>域</th><th>是否必需</th><th>取值范围</th><th>特殊字符</th></tr></thead><tbody><tr><td>秒</td><td>是</td><td>[0, 59]</td><td>* , - &#x2F;</td></tr><tr><td>分钟</td><td>是</td><td>[0, 59]</td><td>* , - &#x2F;</td></tr><tr><td>小时</td><td>是</td><td>[0, 23]</td><td>* , - &#x2F;</td></tr><tr><td>日期</td><td>是</td><td>[1, 31]</td><td>* , - &#x2F; ? L W</td></tr><tr><td>月份</td><td>是</td><td>[1, 12]或[JAN, DEC]</td><td>* , - &#x2F;</td></tr><tr><td>星期</td><td>是</td><td>[1, 7]或[MON, SUN]。若您使用[1, 7]表达方式，<code>1</code>代表星期一，<code>7</code>代表星期日。</td><td>* , - &#x2F; ? L #</td></tr><tr><td>年</td><td>否</td><td>[当前年份，2099]</td><td>* , - &#x2F;</td></tr></tbody></table><h3 id="特殊字符"><a href="#特殊字符" class="headerlink" title="特殊字符"></a>特殊字符</h3><blockquote><p>Cron表达式中的每个域都支持一定数量的特殊字符，每个特殊字符有其特殊含义。</p></blockquote><table><thead><tr><th>特殊字符</th><th>含义</th><th>示例</th></tr></thead><tbody><tr><td><code>*</code></td><td>所有可能的值。</td><td>在月域中，<code>*</code>表示每个月；在星期域中，<code>*</code>表示星期的每一天。</td></tr><tr><td><code>,</code></td><td>列出枚举值。</td><td>在分钟域中，<code>5,20</code>表示分别在5分钟和20分钟触发一次。</td></tr><tr><td><code>-</code></td><td>范围。</td><td>在分钟域中，<code>5-20</code>表示从5分钟到20分钟之间每隔一分钟触发一次。</td></tr><tr><td><code>/</code></td><td>指定数值的增量。</td><td>在分钟域中，<code>0/15</code>表示从第0分钟开始，每15分钟。在分钟域中<code>3/20</code>表示从第3分钟开始，每20分钟。</td></tr><tr><td><code>?</code></td><td>不指定值，仅日期和星期域支持该字符。</td><td>当日期或星期域其中之一被指定了值以后，为了避免冲突，需要将另一个域的值设为<code>?</code>。</td></tr><tr><td><code>L</code></td><td>单词Last的首字母，表示最后一天，仅日期和星期域支持该字符。<span class="label label-info">`说明` 指定`L`字符时，避免指定列表或者范围，否则，会导致逻辑问题。</span></td><td><span class="label label-info">在日期域中，`L`表示某个月的最后一天。在星期域中，`L`表示一个星期的最后一天，也就是星期日（`SUN`）。</span> <span class="label label-info">如果在`L`前有具体的内容，例如，在星期域中的`6L`表示这个月的最后一个星期六。</span></td></tr><tr><td><code>W</code></td><td>除周末以外的有效工作日，在离指定日期的最近的有效工作日触发事件。<code>W</code>字符寻找最近有效工作日时不会跨过当前月份，连用字符<code>LW</code>时表示为指定月份的最后一个工作日。</td><td>在日期域中<code>5W</code>，如果5日是星期六，则将在最近的工作日星期五，即4日触发。如果5日是星期天，则将在最近的工作日星期一，即6日触发；如果5日在星期一到星期五中的一天，则就在5日触发。</td></tr><tr><td><code>#</code></td><td>确定每个月第几个星期几，仅星期域支持该字符。</td><td>在星期域中，<code>4#2</code>表示某月的第二个星期四。</td></tr></tbody></table><h3 id="取值示例"><a href="#取值示例" class="headerlink" title="取值示例"></a>取值示例</h3><blockquote><p>以下为Cron表达式的取值示例。</p></blockquote><table><thead><tr><th>示例</th><th>说明</th></tr></thead><tbody><tr><td><code>0 15 10 ? * *</code></td><td>每天上午10:15执行任务</td></tr><tr><td><code>0 15 10 * * ?</code></td><td>每天上午10:15执行任务</td></tr><tr><td><code>0 0 12 * * ?</code></td><td>每天中午12:00执行任务</td></tr><tr><td><code>0 0 10,14,16 * * ?</code></td><td>每天上午10:00点、下午14:00以及下午16:00执行任务</td></tr><tr><td><code>0 0/30 9-17 * * ?</code></td><td>每天上午09:00到下午17:00时间段内每隔半小时执行任务</td></tr><tr><td><code>0 * 14 * * ?</code></td><td>每天下午14:00到下午14:59时间段内每隔1分钟执行任务</td></tr><tr><td><code>0 0-5 14 * * ?</code></td><td>每天下午14:00到下午14:05时间段内每隔1分钟执行任务</td></tr><tr><td><code>0 0/5 14 * * ?</code></td><td>每天下午14:00到下午14:55时间段内每隔5分钟执行任务</td></tr><tr><td><code>0 0/5 14,18 * * ?</code></td><td>每天下午14:00到下午14:55、下午18:00到下午18:55时间段内每隔5分钟执行任务</td></tr><tr><td><code>0 0 12 ? * WED</code></td><td>每个星期三中午12:00执行任务</td></tr><tr><td><code>0 15 10 15 * ?</code></td><td>每月15日上午10:15执行任务</td></tr><tr><td><code>0 15 10 L * ?</code></td><td>每月最后一日上午10:15执行任务</td></tr><tr><td><code>0 15 10 ? * 6L</code></td><td>每月最后一个星期六上午10:15执行任务</td></tr><tr><td><code>0 15 10 ? * 6#3</code></td><td>每月第三个星期六上午10:15执行任务</td></tr><tr><td><code>0 10,44 14 ? 3 WED</code></td><td>每年3月的每个星期三下午14:10和14:44执行任务</td></tr><tr><td><code>0 15 10 ? * * 2022</code></td><td>2022年每天上午10:15执行任务</td></tr><tr><td><code>0 15 10 ? * * *</code></td><td>每年每天上午10:15执行任务</td></tr><tr><td><code>0 0/5 14,18 * * ? 2022</code></td><td>2022年每天下午14:00到下午14:55、下午18:00到下午18:55时间段内每隔5分钟执行任务</td></tr><tr><td><code>0 15 10 ? * 6#3 2022,2023</code></td><td>2022年至2023年每月第三个星期六上午10:15执行任务</td></tr><tr><td><code>0 0/30 9-17 * * ? 2022-2025</code></td><td>2022年至2025年每天上午09:00到下午17:30时间段内每隔半小时执行任务</td></tr><tr><td><code>0 10,44 14 ? 3 WED 2022/2</code></td><td>从2022年开始，每隔两年3月的每个星期三下午14:10和14:44执行任务</td></tr></tbody></table><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h3474oy5t3j323w1kwb29.jpg" alt="砂狼  女孩子 "></p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cron</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>前端AES加密解密，以及配套的后端加密解密</title>
    <link href="/2022/05/23/java-15/"/>
    <url>/2022/05/23/java-15/</url>
    
    <content type="html"><![CDATA[<p>AES全称高级加密标准（英语：Advanced Encryption Standard，缩写：AES），在密码学中又称Rijndael加密法。</p><h2 id="前端加密解密"><a href="#前端加密解密" class="headerlink" title="前端加密解密"></a>前端加密解密</h2><figure><div class="code-wrapper"><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 引入JS</span><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"</span> integrity<span class="token operator">=</span><span class="token string">"sha512-E8QSvWZ0eCLGk4km3hxSsNmGWbLtSCSUcewDQPQWZF6pEU8GlT8a5fF32wOl1i8ftdMhssTrF/OhyGWwonTcXA=="</span> crossorigin<span class="token operator">=</span><span class="token string">"anonymous"</span> referrerpolicy<span class="token operator">=</span><span class="token string">"no-referrer"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token comment">/*加密*/</span><span class="token keyword">function</span> <span class="token function">aesEncode</span><span class="token punctuation">(</span><span class="token parameter">str<span class="token punctuation">,</span>key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    key <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> encryptedData <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">mode</span><span class="token operator">:</span> CryptoJS<span class="token punctuation">.</span>mode<span class="token punctuation">.</span><span class="token constant">ECB</span><span class="token punctuation">,</span>        <span class="token literal-property property">padding</span><span class="token operator">:</span> CryptoJS<span class="token punctuation">.</span>pad<span class="token punctuation">.</span>Pkcs7    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> encryptedData<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里返回是Base64字符串</span><span class="token punctuation">&#125;</span><span class="token comment">/*解密*/</span><span class="token keyword">function</span> <span class="token function">aesDecode</span><span class="token punctuation">(</span><span class="token parameter">encryptedStr<span class="token punctuation">,</span>key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    key <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> encryptedHexStr  <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>encryptedStr<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> encryptedBase64Str  <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Base64<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>encryptedHexStr<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> decryptedData  <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token constant">AES</span><span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>encryptedBase64Str<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">mode</span><span class="token operator">:</span> CryptoJS<span class="token punctuation">.</span>mode<span class="token punctuation">.</span><span class="token constant">ECB</span><span class="token punctuation">,</span>        <span class="token literal-property property">padding</span><span class="token operator">:</span> CryptoJS<span class="token punctuation">.</span>pad<span class="token punctuation">.</span>Pkcs7    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> decryptedData<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>CryptoJS<span class="token punctuation">.</span>enc<span class="token punctuation">.</span>Utf8<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="后端加密解密"><a href="#后端加密解密" class="headerlink" title="后端加密解密"></a>后端加密解密</h2><p>添加封装的依赖hu-tool</p><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.7.22<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 构建AES加密工具</span><span class="token class-name">SymmetricCrypto</span> aes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SymmetricCrypto</span><span class="token punctuation">(</span><span class="token class-name">SymmetricAlgorithm</span><span class="token punctuation">.</span>AES<span class="token punctuation">,</span> <span class="token string">"qeNm3eXK/BCAwTVoEjfaGQ=="</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//加密</span><span class="token comment">// 如果需要转为和前端显示一样的数据，这里需要把这个返回内容转为Base64字符串</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encrypt <span class="token operator">=</span> aes<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//解密</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> decrypt <span class="token operator">=</span> aes<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>encrypt<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//解密为字符串</span><span class="token class-name">String</span> decryptStr <span class="token operator">=</span> aes<span class="token punctuation">.</span><span class="token function">decryptStr</span><span class="token punctuation">(</span>encrypt<span class="token punctuation">,</span> <span class="token class-name">CharsetUtil</span><span class="token punctuation">.</span>CHARSET_UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h2i2h93hwrj32yo1o07wi.jpg" alt="蓝色短发女生"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AES</tag>
      
      <tag>加密解密</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spring Boot与缓存：使用JCache（JSR-107）注解简化开发</title>
    <link href="/2022/05/10/java-14/"/>
    <url>/2022/05/10/java-14/</url>
    
    <content type="html"><![CDATA[<p>缓存是个好东西，如果你想让前台用户操作流畅的话。经典的倒装句。现在都在追求服务的无状态化，所以这里使用redis作为缓存工具。我也感觉没有必要写，可是简单的你不写，复杂的你又写不好，最后，就是啥也没有。</p><p>springboot版本：2.6.7</p><h2 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h2><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-cache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>默认生效的是配置类：SimpleCacheConfiguration，其他的配置类比如RedisCacheConfiguration如果要生效必须添加相关的Redis配置信息，否则默认不生效。</p><figure><div class="code-wrapper"><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">cache</span><span class="token punctuation">:</span>  <span class="token comment"># 可以为理解指定存储缓存的东西</span>    <span class="token key atrule">type</span><span class="token punctuation">:</span> redis  <span class="token key atrule">redis</span><span class="token punctuation">:</span>    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>    <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost    <span class="token comment"># 如果你有密码的话</span>    <span class="token key atrule">password</span><span class="token punctuation">:</span> redis213<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="启动类加个启用缓存的注解，开启缓存"><a href="#启动类加个启用缓存的注解，开启缓存" class="headerlink" title="启动类加个启用缓存的注解，开启缓存"></a>启动类加个启用缓存的注解，开启缓存</h2><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token annotation punctuation">@EnableCaching</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServerApplication</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ServerApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="开始使用"><a href="#开始使用" class="headerlink" title="开始使用"></a>开始使用</h2><p>推荐注解使用啊，手写的话应该不需要介绍，自己手搓着就行，手搓没啥可说的，注解，也只是说一说注解里的各种属性。英文好点，可以随便使用啊。英文不好，那咱也不是一点也不能看，根据变量名猜，加上机器翻译，日子到也过的下去。</p><div class="note note-info">            <p>我只是一个喜欢写随笔的人啊，每次写这种介绍博客时，总时控制不住去写书，可能和我的初中老师有关系，一股脑的全部到给你，也不管你听不听得懂。还是简略点，写的太详细写的也累，看的也累。最主要感觉还是要起到的一个类似领头的效果吧。很多细节，自己去看源码也是可以解决的。</p>          </div><h2 id="几个重要的概念和注解"><a href="#几个重要的概念和注解" class="headerlink" title="几个重要的概念和注解"></a>几个重要的概念和注解</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h24891grucj30w60ea786.jpg" alt="概念"></p><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h2489u3nmyj30wq0gf4bh.jpg" alt="注解参数"></p><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h248a7wofej30yu0f5n44.jpg" alt="注解中SPEL表达式"></p><h3 id="Cacheable"><a href="#Cacheable" class="headerlink" title="@Cacheable"></a>@Cacheable</h3><p><code>@Cacheable</code>标注的方法在执行之前会先检查缓存中有没有这个数据，默认按照参数的值作为缓存的key去查询缓存，如果没有就运行该方法并将结果放入缓存；以后再来调用就可以直接使用缓存中的数据；</p><ol><li>方法运行之前，先去查询Cache（缓存组件），按照cacheNames指定的名字获取；（CacheManager先获取相应的缓存），第一次获取缓存如果没有Cache组件会自动创建。</li><li>去Cache中查找缓存的内容，使用一个key，默认就是方法的参数；key是按照某种策略生成的；默认是使用<code>keyGenerator</code>生成的，默认使用<code>SimpleKeyGenerator</code>生成key；</li><li>看源码得知<code>SimpleKeyGenerator</code>生成key的默认策略；<ul><li>如果没有参数；<code>key=new SimpleKey()</code>；</li><li>如果有一个参数：<code>key=参数的值</code></li><li>如果有多个参数：<code>key=new SimpleKey(params)</code>；</li></ul></li><li>没有查到缓存就调用目标方法；</li><li>将目标方法返回的结果，放进缓存中</li></ol><div class="note note-info">            <p>将方法的运行结果进行缓存；以后再要相同的数据，直接从缓存中获取，不用调用方法；<br>CacheManager管理多个Cache组件的，对缓存的真正CRUD操作在Cache组件中，每一个缓存组件有自己唯一一个名字；</p>          </div><h4 id="Cacheable注解的可配置项"><a href="#Cacheable注解的可配置项" class="headerlink" title="Cacheable注解的可配置项"></a>Cacheable注解的可配置项</h4><ol><li><code>cacheNames/value</code>：指定缓存组件的名字;将方法的返回结果放在哪个缓存中，是数组的方式，可以指定多个缓存；</li><li><code>key</code>：缓存数据使用的key；可以用它来指定。默认是使用方法参数的值 1-方法的返回值编写SpEL； #id;参数id的值 #a0 #p0 #root.args[0]getEmp[2]</li><li><code>keyGenerator</code>：key的生成器；可以自己指定key的生成器的组件id,<code>key/keyGenerator</code>：二选一使用</li><li><code>cacheManager</code>：指定缓存管理器；或者cacheResolver指定获取解析器</li><li><code>condition</code>：指定符合条件的情况下才缓存；condition &#x3D; “#id&gt;0”；condition &#x3D; “#a0&gt;1”：第一个参数的值大于1的时候才进行缓存</li><li><code>unless</code>: 否定缓存；当unless指定的条件为true，方法的返回值就不会被缓存；可以获取到结果进行判unless &#x3D; “#result &#x3D;&#x3D; null”unless &#x3D; “#a0&#x3D;&#x3D;2”:如果第一个参数的值是2，结果不缓存；</li><li><code>sync</code>：是否使用异步模式</li></ol><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"emp"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>keyGenerator <span class="token operator">=</span> <span class="token string">"myKeyGenerator"</span><span class="token punctuation">,</span>condition <span class="token operator">=</span> <span class="token string">"#a0>1"</span><span class="token punctuation">,</span>unless <span class="token operator">=</span> <span class="token string">"#a0==2"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">Employee</span> <span class="token function">getEmp</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"查询"</span><span class="token operator">+</span>id<span class="token operator">+</span><span class="token string">"号员工"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Employee</span> emp <span class="token operator">=</span> employeeMapper<span class="token punctuation">.</span><span class="token function">getEmpById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> emp<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="CachePut"><a href="#CachePut" class="headerlink" title="@CachePut"></a>@CachePut</h3><ul><li><p>既调用方法，又更新缓存数据；同步更新缓存</p></li><li><p>应用场景：修改了数据库的某个数据，同时更新缓存；</p></li><li><p>流程：</p><ol><li>先调用目标方法</li><li>将目标方法的结果缓存起来</li></ol></li></ul><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@CachePut</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"emp"</span><span class="token punctuation">,</span>key <span class="token operator">=</span> <span class="token string">"#result.id"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">Employee</span> <span class="token function">updateEmp</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> employee<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"updateEmp:"</span><span class="token operator">+</span>employee<span class="token punctuation">)</span><span class="token punctuation">;</span>    employeeMapper<span class="token punctuation">.</span><span class="token function">updateEmp</span><span class="token punctuation">(</span>employee<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> employee<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="CacheEvict"><a href="#CacheEvict" class="headerlink" title="@CacheEvict"></a>@CacheEvict</h3><ul><li><code>@CacheEvict</code>：缓存清除</li><li><code>key</code>：指定要清除的数据</li><li><code>allEntries = true</code>：指定清除这个缓存中所有的数据</li><li><code>beforeInvocation = false</code>：缓存的清除是否在方法之前执行。默认代表缓存清除操作是在方法执行之后执行;如果出现异常缓存就不会清除。</li><li><code>beforeInvocation = true</code>：代表清除缓存操作是在方法运行之前执行，无论方法是否出现异常，缓存都清除</li></ul><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@CacheEvict</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"emp"</span><span class="token punctuation">,</span>beforeInvocation <span class="token operator">=</span> <span class="token boolean">true</span>，key <span class="token operator">=</span> <span class="token string">"#id"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteEmp</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"deleteEmp:"</span><span class="token operator">+</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    employeeMapper<span class="token punctuation">.</span><span class="token function">deleteEmpById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="Caching"><a href="#Caching" class="headerlink" title="@Caching"></a>@Caching</h3><ul><li><code>@Caching</code> 综合上面介绍的几个注解，用来定义较为复杂的缓存规则</li></ul><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Caching</span><span class="token punctuation">(</span>     cacheable <span class="token operator">=</span> <span class="token punctuation">&#123;</span>         <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span><span class="token comment">/*value="emp",*/</span>key <span class="token operator">=</span> <span class="token string">"#lastName"</span><span class="token punctuation">)</span>     <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>     put <span class="token operator">=</span> <span class="token punctuation">&#123;</span>         <span class="token annotation punctuation">@CachePut</span><span class="token punctuation">(</span><span class="token comment">/*value="emp",*/</span>key <span class="token operator">=</span> <span class="token string">"#result.id"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token annotation punctuation">@CachePut</span><span class="token punctuation">(</span><span class="token comment">/*value="emp",*/</span>key <span class="token operator">=</span> <span class="token string">"#result.email"</span><span class="token punctuation">)</span>     <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">Employee</span> <span class="token function">getEmpByLastName</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastName<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> employeeMapper<span class="token punctuation">.</span><span class="token function">getEmpByLastName</span><span class="token punctuation">(</span>lastName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="CacheConfig"><a href="#CacheConfig" class="headerlink" title="@CacheConfig"></a>@CacheConfig</h3><ul><li>在类上使用，提供公共属性。</li><li><code>cacheNames</code>: 缓存名称，同一个类中，不指定缓存名称则使用这个名称，类似于一个以类为单位的全局配置。</li><li>下面和上面类似，而且属性前面也有介绍，就不多说了。</li></ul><p>源码：</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">)</span> <span class="token comment">// 这个表示只能在类上使用</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span><span class="token annotation punctuation">@Documented</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">CacheConfig</span> <span class="token punctuation">&#123;</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">cacheNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token class-name">String</span> <span class="token function">keyGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token class-name">String</span> <span class="token function">cacheManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token class-name">String</span> <span class="token function">cacheResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h249s4uychj32yo1o0kjp.jpg" alt="海绵宝宝"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>springboot</tag>
      
      <tag>cache</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java DecimalFormat的主要功能及使用方法</title>
    <link href="/2022/04/02/java-13/"/>
    <url>/2022/04/02/java-13/</url>
    
    <content type="html"><![CDATA[<p>DecimalFormat 是 NumberFormat 的一个具体子类，用于格式化十进制数字。该类设计有各种功能，使其能够分析和格式化任意语言环境中的数，包括对西方语言、阿拉伯语和印度语数字的支持。它还支持不同类型的数，包括整数 (123)、定点数 (123.4)、科学记数法表示的数 (1.23E4)、百分数 (12%) 和金额 ($123)。所有这些内容都可以本地化。<br>DecimalFormat 包含一个模式 和一组符号</p><h2 id="符号含义"><a href="#符号含义" class="headerlink" title="符号含义"></a>符号含义</h2><table><thead><tr><th>符号</th><th>位置</th><th>本地化？</th><th>含义</th></tr></thead><tbody><tr><td>0</td><td>数字</td><td>是</td><td>阿拉伯数字</td></tr><tr><td>#</td><td>数字字</td><td>是</td><td>阿拉伯数字，如果不存在则显示为空</td></tr><tr><td>.</td><td>数字</td><td>是</td><td>小数分隔符或货币小数分隔符</td></tr><tr><td>-</td><td>数字</td><td>是</td><td>减号</td></tr><tr><td>,</td><td>数字</td><td>是</td><td>分组分隔符</td></tr><tr><td>E</td><td>数字</td><td>是</td><td>分隔科学计数法中的尾数和指数。在前缀或后缀中无需加引号。</td></tr><tr><td>;</td><td>子模式边界</td><td>是</td><td>分隔正数和负数子模式</td></tr><tr><td>%</td><td>前缀或后缀</td><td>是</td><td>乘以 100 并显示为百分数</td></tr></tbody></table><h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DecimalFormat</span> df1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DecimalFormat</span><span class="token punctuation">(</span><span class="token string">"0.0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">DecimalFormat</span> df2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DecimalFormat</span><span class="token punctuation">(</span><span class="token string">"#.#"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">DecimalFormat</span> df3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DecimalFormat</span><span class="token punctuation">(</span><span class="token string">"000.000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">DecimalFormat</span> df4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DecimalFormat</span><span class="token punctuation">(</span><span class="token string">"###.###"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>df1<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">12.34</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>df2<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">12.34</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>df3<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">12.34</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>df4<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">12.34</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 运行结果： </span><span class="token number">12.3</span> <span class="token number">12.3</span> <span class="token number">012.340</span> <span class="token number">12.34</span><span class="token class-name">DecimalFormat</span> format <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DecimalFormat</span><span class="token punctuation">(</span><span class="token string">"###,####.000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>format<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">111111123456.1227222</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">setDefault</span><span class="token punctuation">(</span><span class="token class-name">Locale</span><span class="token punctuation">.</span>US<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">DecimalFormat</span> usFormat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DecimalFormat</span><span class="token punctuation">(</span><span class="token string">"###,###.000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>usFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">111111123456.1227222</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name">DecimalFormat</span> addPattenFormat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DecimalFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> addPattenFormat<span class="token punctuation">.</span><span class="token function">applyPattern</span><span class="token punctuation">(</span><span class="token string">"##,###.000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>addPattenFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">111111123456.1227</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name">DecimalFormat</span> zhiFormat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DecimalFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> zhiFormat<span class="token punctuation">.</span><span class="token function">applyPattern</span><span class="token punctuation">(</span><span class="token string">"0.000E0000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>zhiFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>zhiFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">12345678.345</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name">DecimalFormat</span> percentFormat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DecimalFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> percentFormat<span class="token punctuation">.</span><span class="token function">applyPattern</span><span class="token punctuation">(</span><span class="token string">"#0.000%"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>percentFormat<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">0.3052222</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 运行结果 ：<span class="token number">1111</span><span class="token punctuation">,</span><span class="token number">1112</span><span class="token punctuation">,</span><span class="token number">3456.123</span> <span class="token number">111</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">,</span><span class="token number">456.123</span> <span class="token number">111</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">,</span><span class="token number">456.123</span> <span class="token number">1.000E0004</span> <span class="token number">1.235E0007</span> <span class="token number">30.522</span><span class="token operator">%</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>如果使用具有多个分组字符的模式，则最后一个分隔符和整数结尾之间的间隔才是使用的分组大小。</p><p>所以 “#,##,###,####” &#x3D;&#x3D; “######,####” &#x3D;&#x3D; “##,####,####”。</p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h0zyye8c98j32yo1o0e82.jpg" alt="集原美"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>DecimalFormat</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Oracle版本对应匹配的ojdbc版本及JDK版本</title>
    <link href="/2022/04/02/java-12/"/>
    <url>/2022/04/02/java-12/</url>
    
    <content type="html"><![CDATA[<p>Oracle JDBC 版本与 JDK 版本的关系如何？<br>Oracle JDBC 驱动程序始终与每一个新版本中的最新 JDK 版本相兼容。在某些版本中，JDBC 驱动程序支持多个 JDK 版本。请使用下表根据您的首选 JDK 版本选择正确的 JDBC 驱动程序。</p><table><thead><tr><th>Oracle 数据库版本</th><th>特定于发行版的 JDBC Jar 文件</th></tr></thead><tbody><tr><td>21.1</td><td>ojdbc11.jar，随带 JDK11、JDK12、JDK13、JDK14 和 JDK15；ojdbc8.jar ，随带 JDK8、JDK11、JDK12、JDK13、JDK14 和 JDK15</td></tr><tr><td>19.x</td><td>ojdbc10.jar，随带 JDK10 和 JDK11；ojdbc8.jar，随带 JDK8、JDK9 和 JDK11</td></tr><tr><td>18.3</td><td>ojdbc8.jar，随带 JDK8、JDK9、JDK10 和 JDK11</td></tr><tr><td>12.2 或 12cR2</td><td>ojdbc8.jar，随带 JDK8</td></tr><tr><td>12.1 或 12cR1</td><td>ojdbc7.jar with JDK 7 and JDK 8；ojdbc6.jar，随带 JDK 6</td></tr><tr><td>11.2 或 11gR2</td><td>ojdbc6.jar，随带 JDK 6、JDK 7 和 JDK 8；（注意：仅 11.2.0.3 和 11.2.0.4 支持 JDK7 和 JDK8）；ojdbc5.jar，随带 JDK 5</td></tr></tbody></table><p><a href="https://www.oracle.com/cn/database/technologies/faq-jdbc.html">oracle常见问题</a></p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h0ve62trn6j32yo1o0b2a.jpg" alt="女孩"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>oracle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ubuntu20.x.x使用root登录</title>
    <link href="/2022/04/02/linux-01/"/>
    <url>/2022/04/02/linux-01/</url>
    
    <content type="html"><![CDATA[<h2 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h2><p>以普通用户登录系统，创建root用户的密码<br>在终端输入命令：</p><p><code>sudo passwd root</code></p><p>然后输入设置的密码，输入两次，这样就完成了设置root用户密码了，如果只需要临时获取root权限，在此步操作后就可以在普通用户登录的终端中输入<code>su root</code> 然后输入两遍密码即可在终端中获取root权限。可以稍微防止一点激情删库这一步骤。</p><h2 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h2><p>修改文件<code>sudo gedit /usr/share/lightdm/lightdm.conf.d/50-ubuntu.conf</code><br>在文件末尾增加如下两行：<br><code>greeter-show-manual-login=true</code><br><code>all-guest=false</code>  </p><h2 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h2><p>修改 <code>/etc/pam.d/gdm-autologin</code><br>  <code>/etc/pam.d/gdm-password</code><br>两个文件</p><p><code>sudo gedit /etc/pam.d/gdm-autologin</code><br>注释掉<code>auth required pam_succeed_if.so user != root quiet_success</code>这一行(第三行左右)</p><p><code>sudo gedit /etc/pam.d/gdm-password</code><br>注释掉 <code>auth required pam_succeed_if.so user != root quiet_success</code>这一行(第三行左右)</p><h2 id="第四步"><a href="#第四步" class="headerlink" title="第四步"></a>第四步</h2><p>修改<code>/root/.profile</code>文件<br><code>sudo gedit /root/.profile</code><br>将文件末尾的<code>mesg n 2&gt; /dev/null || true</code>这一行修改成<br><code>tty -s &amp;&amp; mesg n || true</code></p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h0v56otfr4j32yo1o04qr.jpg" alt="原神-风华节"></p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>ubuntu</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nginx详细配置</title>
    <link href="/2022/03/17/vue-05/"/>
    <url>/2022/03/17/vue-05/</url>
    
    <content type="html"><![CDATA[<p>Nginx的配置记了忘，忘了记，这东西，一般就是一套配置，到处复制，然后改改，绝大多数时候对于我们的要求就是需要知道改什么地方，nginx相关的博客，我好像不止写了一次，然而属实不怎么常用，学得快，忘得更快，然后借这次吧，重新再写一下。nginx的配置难以理解的地方。就是配置https，其实也没有什么复杂的。</p><h2 id="教程准备"><a href="#教程准备" class="headerlink" title="教程准备"></a>教程准备</h2><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><p>如日中天的CenterOs倒了（停止维护）。于是我就换上了Ubuntu。</p><p>Linux系统：Ubuntu20.x.x</p><h3 id="安装方式"><a href="#安装方式" class="headerlink" title="安装方式"></a>安装方式</h3><p>两种安装方式，使用命令式的安装是最为简单的，但受限于网络。下载源码编译安装最为通用，但是有一点繁琐。</p><h4 id="APT（软件源）安装"><a href="#APT（软件源）安装" class="headerlink" title="APT（软件源）安装"></a>APT（软件源）安装</h4><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装之前的准备</span><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">curl</span> gnupg2 ca-certificates lsb-release ubuntu-keyring<span class="token comment"># 导入官方的nginx签名密钥，以便apt能够验证软件包的真实性</span><span class="token function">curl</span> https://nginx.org/keys/nginx_signing.key <span class="token operator">|</span> gpg --dearmor <span class="token punctuation">\</span>    <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /usr/share/keyrings/nginx-archive-keyring.gpg <span class="token operator">></span>/dev/null<span class="token comment"># 验证下载的文件是否包含正确的密钥</span>gpg --dry-run --quiet --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg<span class="token comment"># 输出即可</span>pub   rsa2048 <span class="token number">2011</span>-08-19 <span class="token punctuation">[</span>SC<span class="token punctuation">]</span> <span class="token punctuation">[</span>expires: <span class="token number">2024</span>-06-14<span class="token punctuation">]</span>      573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62uid                      nginx signing key <span class="token operator">&lt;</span>signing-key@nginx.com<span class="token operator">></span><span class="token comment"># 更新</span><span class="token function">sudo</span> <span class="token function">apt</span> update<span class="token comment"># 安装 有提示，y 回车即可</span><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> nginx<span class="token comment"># 测试是否成功安装, 输出版本号，即安装完成</span>nginx -v<span class="token comment"># 测试访问</span><span class="token function">curl</span> https://localhost<span class="token comment"># 输出</span><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span><span class="token operator">&lt;</span>html<span class="token operator">></span><span class="token operator">&lt;</span>head<span class="token operator">></span><span class="token operator">&lt;</span>title<span class="token operator">></span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">></span><span class="token operator">&lt;</span>style<span class="token operator">></span>    body <span class="token punctuation">&#123;</span>        width: 35em<span class="token punctuation">;</span>        margin: <span class="token number">0</span> auto<span class="token punctuation">;</span>        font-family: Tahoma, Verdana, Arial, sans-serif<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token operator">&lt;</span>/style<span class="token operator">></span><span class="token operator">&lt;</span>/head<span class="token operator">></span><span class="token operator">&lt;</span>body<span class="token operator">></span><span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>></span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>></span><span class="token operator">&lt;</span>p<span class="token operator">></span>If you see this page, the nginx web server is successfully installed andworking. Further configuration is required.<span class="token operator">&lt;</span>/p<span class="token operator">></span><span class="token operator">&lt;</span>p<span class="token operator">></span>For online documentation and support please refer to<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"http://nginx.org/"</span><span class="token operator">></span>nginx.org<span class="token operator">&lt;</span>/a<span class="token operator">></span>.<span class="token operator">&lt;</span>br/<span class="token operator">></span>Commercial support is available at<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">"http://nginx.com/"</span><span class="token operator">></span>nginx.com<span class="token operator">&lt;</span>/a<span class="token operator">></span>.<span class="token operator">&lt;</span>/p<span class="token operator">></span><span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token operator">&lt;</span>em<span class="token operator">></span>Thank you <span class="token keyword">for</span> using nginx.<span class="token operator">&lt;</span>/em<span class="token operator">></span><span class="token operator">&lt;</span>/p<span class="token operator">></span><span class="token operator">&lt;</span>/body<span class="token operator">></span><span class="token operator">&lt;</span>/html<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>按照上面的操作如果出现最后的Html文档说明已经正确安装了。</p><h4 id="源码安装"><a href="#源码安装" class="headerlink" title="源码安装"></a>源码安装</h4><p>比较通用的一种安装方法。首先下载安装包。<a href="http://nginx.org/en/download.html">nginx下载</a>，下载稳定版的即可。我这里下载的是<a href="http://nginx.org/download/nginx-1.20.2.tar.gz">nginx-1.20.2</a>，点击下载到本地，上传到你的Linux服务器上。上传方法不限，弄到服务器的文件夹里即可。</p><p>进入存放tar.gz文件的目录下</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 解压源码文件</span><span class="token function">tar</span> -zxcf nginx-1.20.2.tar.gz<span class="token comment"># 进入解压后的文件中</span><span class="token builtin class-name">cd</span> nginx-1.20.2<span class="token comment"># 创建一个缓存文件夹</span><span class="token function">mkdir</span> /var/temp/nginx -p<span class="token comment"># 安装生成安装文件前的必要依赖。</span><span class="token comment"># 不建议手动编译安装属实是太麻烦了</span><span class="token function">apt</span> <span class="token function">install</span> build-essential libssl-dev libghc-zlib-dev libpcre3-dev<span class="token comment"># 在nginx目录，输入如下命令进行配置，目的是为了创建makefile文件</span><span class="token comment"># 注意一下配置中的目录即可</span>./configure <span class="token punctuation">\</span>--prefix<span class="token operator">=</span>/usr/local/nginx <span class="token punctuation">\</span>--pid-path<span class="token operator">=</span>/var/run/nginx/nginx.pid <span class="token punctuation">\</span>--lock-path<span class="token operator">=</span>/var/lock/nginx.lock <span class="token punctuation">\</span>--error-log-path<span class="token operator">=</span>/var/log/nginx/error.log <span class="token punctuation">\</span>--http-log-path<span class="token operator">=</span>/var/log/nginx/access.log <span class="token punctuation">\</span>--with-http_gzip_static_module <span class="token punctuation">\</span>--http-client-body-temp-path<span class="token operator">=</span>/var/temp/nginx/client <span class="token punctuation">\</span>--http-proxy-temp-path<span class="token operator">=</span>/var/temp/nginx/proxy <span class="token punctuation">\</span>--http-fastcgi-temp-path<span class="token operator">=</span>/var/temp/nginx/fastcgi <span class="token punctuation">\</span>--http-uwsgi-temp-path<span class="token operator">=</span>/var/temp/nginx/uwsgi <span class="token punctuation">\</span>--http-scgi-temp-path<span class="token operator">=</span>/var/temp/nginx/scgi  <span class="token punctuation">\</span>--with-http_ssl_module<span class="token comment"># 如果报错如下，</span>checking <span class="token keyword">for</span> OS + Linux <span class="token number">5.13</span>.0-37-generic x86_64checking <span class="token keyword">for</span> C compiler <span class="token punctuation">..</span>. not found./configure: error: C compiler cc is not found<span class="token comment"># 说明缺少编译依赖。再次执行此命令。</span><span class="token function">apt</span> <span class="token function">install</span> build-essential libssl-dev libghc-zlib-dev libpcre3-dev<span class="token comment"># 生成安装文件成功后应该会输出类似下面的内容</span>  nginx path prefix: <span class="token string">"/usr/local/nginx"</span>  nginx binary file: <span class="token string">"/usr/local/nginx/sbin/nginx"</span>  nginx modules path: <span class="token string">"/usr/local/nginx/modules"</span>  nginx configuration prefix: <span class="token string">"/usr/local/nginx/conf"</span>  nginx configuration file: <span class="token string">"/usr/local/nginx/conf/nginx.conf"</span>  nginx pid file: <span class="token string">"/var/run/nginx/nginx.pid"</span>  nginx error log file: <span class="token string">"/var/log/nginx/error.log"</span>  nginx http access log file: <span class="token string">"/var/log/nginx/access.log"</span>  nginx http client request body temporary files: <span class="token string">"/var/temp/nginx/client"</span>  nginx http proxy temporary files: <span class="token string">"/var/temp/nginx/proxy"</span>  nginx http fastcgi temporary files: <span class="token string">"/var/temp/nginx/fastcgi"</span>  nginx http uwsgi temporary files: <span class="token string">"/var/temp/nginx/uwsgi"</span>  nginx http scgi temporary files: <span class="token string">"/var/temp/nginx/scgi"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><div class="note note-info">            <p>配置相关信息汇总，看表格</p>          </div><table><thead><tr><th>命令</th><th>解释</th></tr></thead><tbody><tr><td>–prefix</td><td>指定nginx安装目录</td></tr><tr><td>–pid-path</td><td>指定nginx的pid</td></tr><tr><td>–lock-path</td><td>锁定安装文件，防止篡改</td></tr><tr><td>–error-log-path</td><td>错误日志</td></tr><tr><td>–http-log-path</td><td>日志</td></tr><tr><td>–http-log-path</td><td>日志</td></tr><tr><td>–with-http_gzip_static_module</td><td>启用gzip模块，在线实时压缩输出数据流</td></tr><tr><td>–http-client-body-temp-path</td><td>设定客户端请求临时目录</td></tr><tr><td>–http-proxy-temp-path</td><td>设定http代理临时目录</td></tr><tr><td>–http-fastcgi-temp-path</td><td>设定fastcgi临时目录</td></tr><tr><td>–http-uwsgi-temp-path</td><td>设定uwsgi临时目录</td></tr><tr><td>–http-scgi-temp-path</td><td>设定scgi临时目录</td></tr><tr><td>–with-http_ssl_module</td><td>启用Https模块</td></tr></tbody></table><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># make编译</span><span class="token function">make</span><span class="token comment"># 安装</span><span class="token function">make</span> <span class="token function">install</span><span class="token comment"># 进入sbin目录启动nginx</span><span class="token comment"># 启动：</span>./nginx<span class="token comment"># 停止：</span>./nginx -s stop<span class="token comment"># 重新加载：</span>./nginx -s reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>在Ubuntu上nginx安装的两种方式都已介绍完毕，如果你用的是CentOs,那很可惜，教程并不适用。我这边呢是建议使用apt,yum这种工具去安装nginx的，优点有很多。</p><p>第一：节省服务器空间因为不需要编译环境，第二，节省开发者生命。</p><h2 id="浅说一下APT和Yum…等等类似工具究竟是什么东西"><a href="#浅说一下APT和Yum…等等类似工具究竟是什么东西" class="headerlink" title="浅说一下APT和Yum…等等类似工具究竟是什么东西"></a>浅说一下APT和Yum…等等类似工具究竟是什么东西</h2><p>我们在搜索的时候，有时会搜到一些apt-get命令的操作。</p><div class="note note-info">            <p>使用apt－get的主流Linux系统包括Debian和Ubuntu变异版本。大多数情况下，从命令行运行该工具。桌面上有几个图形前端可以使用，包括Synaptic Package Manager、Ubuntu Software Center、Aptitude和Kpackage。<br>Raspberry Pi和Beaglebone Black nanoLinux版用户可以很容易地使用apt－get加载程序，因为这些系统通常来自Ubuntu或Debian代码。是debian，ubuntu发行版的包管理工具，与红帽中的「yum」工具非常类似。<br>apt－get命令一般需要「root权限」执行，所以一般跟着sudo命令。<br>apt 命令行实用程序于2014年推出第一个稳定版本，用于 Debian 发行版 ．deb 软件包安装。它最初在不稳定的Debian版本中使用，然后在Debian 8中成为标准。<br>在 Ubuntu 16．04 发行后，apt 开始流行，并以某种方式取代了 apt－get 。<br>随着 apt install package 命令的使用频率和普遍性逐步超过 apt－get install package，越来越多的其它 Linux 发行版也开始遵循 Ubuntu 的脚步，开始鼓励用户使用 apt 而不是 apt－get。<br>大多数人不了解 apt 和 apt－get 之间的区别，并且经常在使用一个或另一个时感到困惑。<br>两者都是开源命令行工具，用于管理软件包，例如安装，更新，升级和删除。<br>但是，它们之间仍然存在一些差异。</p>          </div><h3 id="apt"><a href="#apt" class="headerlink" title="apt"></a>apt</h3><div class="note note-info">            <p>apt（Advanced Packaging Tool）是一个在 Debian 和 Ubuntu 中的 Shell 前端软件包管理器。<br>apt 命令提供了查找、安装、升级、删除某一个、一组甚至全部软件包的命令，而且命令简洁而又好记。<br>apt 命令执行需要超级管理员权限(root)。</p>          </div><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@ubuntu:/usr/local/nginx/sbin<span class="token comment"># apt -h</span><span class="token function">apt</span> <span class="token number">2.0</span>.6 <span class="token punctuation">(</span>amd64<span class="token punctuation">)</span>用法： <span class="token function">apt</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> 命令命令行软件包管理器 <span class="token function">apt</span> 提供软件包搜索，管理和信息查询等功能。它提供的功能与其他 APT 工具相同（像 <span class="token function">apt-get</span> 和 apt-cache），但是默认情况下被设置得更适合交互。常用命令：  list - 根据名称列出软件包  search - 搜索软件包描述  show - 显示软件包细节  <span class="token function">install</span> - 安装软件包  reinstall - 重新安装软件包  remove - 移除软件包  autoremove - 卸载所有自动安装且不再使用的软件包  update - 更新可用软件包列表  upgrade - 通过 安装/升级 软件来更新系统  full-upgrade - 通过 卸载/安装/升级 来更新系统  edit-sources - 编辑软件源信息文件  satisfy - 使系统满足依赖关系字符串参见 apt<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> 以获取更多关于可用命令的信息。程序配置选项及语法都已经在 apt.conf<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> 中阐明。欲知如何配置软件源，请参阅 sources.list<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>。软件包及其版本偏好可以通过 apt_preferences<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> 来设置。关于安全方面的细节可以参考 apt-secure<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>.                                         本 APT 具有超级牛力。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="Yum"><a href="#Yum" class="headerlink" title="Yum"></a>Yum</h3><div class="note note-info">            <p>yum（ Yellow dog Updater, Modified）是一个在 Fedora 和 RedHat 以及 SUSE 中的 Shell 前端软件包管理器。（一般CentOS就用这个）<br>基于 RPM 包管理，能够从指定的服务器自动下载 RPM 包并且安装，可以自动处理依赖性关系，并且一次安装所有依赖的软件包，无须繁琐地一次次下载、安装。<br>yum 提供了查找、安装、删除某一个、一组甚至全部软件包的命令，而且命令简洁而又好记。</p>          </div><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>. 列出所有可更新的软件清单命令：yum check-update<span class="token number">2</span>. 更新所有软件命令：yum update<span class="token number">3</span>. 仅安装指定的软件命令：yum <span class="token function">install</span> <span class="token operator">&lt;</span>package_name<span class="token operator">></span><span class="token number">4</span>. 仅更新指定的软件命令：yum update <span class="token operator">&lt;</span>package_name<span class="token operator">></span><span class="token number">5</span>. 列出所有可安裝的软件清单命令：yum list<span class="token number">6</span>. 删除软件包命令：yum remove <span class="token operator">&lt;</span>package_name<span class="token operator">></span><span class="token number">7</span>. 查找软件包命令：yum search <span class="token operator">&lt;</span>keyword<span class="token operator">></span><span class="token number">8</span>. 清除缓存命令:yum clean packages: 清除缓存目录下的软件包yum clean headers: 清除缓存目录下的 headersyum clean oldheaders: 清除缓存目录下旧的 headersyum clean, yum clean all <span class="token punctuation">(</span><span class="token operator">=</span> yum clean packages<span class="token punctuation">;</span> yum clean oldheaders<span class="token punctuation">)</span> :清除缓存目录下的软件包及旧的 headers<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="默认配置解读"><a href="#默认配置解读" class="headerlink" title="默认配置解读"></a>默认配置解读</h2><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 运行用户，一般设置成root用户即可，百度了一下是用来控制权限的。根据Liunx系统的用户来配置即可，话说通过shell窗口来操作Linux的用户的相关命令，应该不常用。</span>user www-data<span class="token punctuation">;</span><span class="token comment"># 启动进程,通常设置成和cpu的数量相等，auto 表示自动</span>worker_processes auto<span class="token punctuation">;</span><span class="token comment"># 全局运行PID文件</span>pid /run/nginx.pid<span class="token punctuation">;</span><span class="token comment"># 导入指定文件夹下所有以.conf结尾的配置文件，一般是一些模块的设置</span>include /etc/nginx/modules-enabled/*.conf<span class="token punctuation">;</span>events <span class="token punctuation">&#123;</span> <span class="token comment"># 单个后台worker process进程的最大并发链接数</span> worker_connections <span class="token number">768</span><span class="token punctuation">;</span> <span class="token comment"># multi_accept on;</span><span class="token punctuation">&#125;</span><span class="token comment"># #设定http服务器，利用它的反向代理功能提供负载均衡支持</span>http <span class="token punctuation">&#123;</span> <span class="token comment">##</span> <span class="token comment"># 基本设置</span> <span class="token comment">##</span> <span class="token comment"># sendfile 指令指定 nginx 是否调用 sendfile 函数（zero copy 方式）来输出文件，对于普通应用，</span> <span class="token comment"># 必须设为 on,如果用来进行下载等应用磁盘IO重负载应用，可设置为 off，以平衡磁盘与网络I/O处理速度，降低系统的uptime.</span> sendfile on<span class="token punctuation">;</span> <span class="token comment"># sendfile为on时这里也应该设为on，数据包会累积一下再一起传输，可以提高一些传输效率。</span> tcp_nopush on<span class="token punctuation">;</span> <span class="token comment"># 小的数据包不等待直接传输。默认为on。</span> <span class="token comment"># 看上去是和tcp_nopush相反的功能，但是两边都为on时nginx也可以平衡这两个功能的使用。</span> tcp_nodelay on<span class="token punctuation">;</span> <span class="token comment"># 连接超时时间</span> keepalive_timeout <span class="token number">65</span><span class="token punctuation">;</span> <span class="token comment"># types_hash_max_size影响散列表的冲突率。types_hash_max_size越大，就会消耗更多的内存，但散列key的冲突率会降低，检索速度就更快。types_hash_max_size越小，消耗的内存就越小，但散列key的冲突率可能上升。默认为1024</span> types_hash_max_size <span class="token number">2048</span><span class="token punctuation">;</span> <span class="token comment"># server_tokens off;</span> <span class="token comment"># server_names_hash_bucket_size 64;</span> <span class="token comment"># server_name_in_redirect off;</span> <span class="token comment"># 定义MIME类型和后缀名关联的文件的位置。</span> include /etc/nginx/mime.types<span class="token punctuation">;</span> <span class="token comment"># 指定mime.types文件中没有记述到的后缀名的处理方法。默认值是text/plain。</span> default_type application/octet-stream<span class="token punctuation">;</span> <span class="token comment">##</span> <span class="token comment"># SSL设置</span> <span class="token comment">##</span> ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3<span class="token punctuation">;</span> <span class="token comment"># Dropping SSLv3, ref: POODLE</span> ssl_prefer_server_ciphers on<span class="token punctuation">;</span> <span class="token comment">##</span> <span class="token comment"># 日志记录设置</span> <span class="token comment">##</span> access_log /var/log/nginx/access.log<span class="token punctuation">;</span> error_log /var/log/nginx/error.log<span class="token punctuation">;</span> <span class="token comment">##</span> <span class="token comment"># Gzip设置</span> <span class="token comment">##</span> <span class="token comment">#开启gzip压缩</span> <span class="token function">gzip</span> on<span class="token punctuation">;</span> <span class="token comment"># gzip_vary on;</span> <span class="token comment"># gzip_proxied any;</span> <span class="token comment"># gzip_comp_level 6;</span> <span class="token comment"># gzip_buffers 16 8k;</span> <span class="token comment"># gzip_http_version 1.1;</span> <span class="token comment"># gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;</span> <span class="token comment">##</span> <span class="token comment"># 虚拟主机配置</span> <span class="token comment">## </span> <span class="token comment"># 重点就在这里，因为我们正常看这个配置文件，里面感觉是没有东西的。但是我们访问http://localhost是可以访问的到的。</span>  <span class="token comment"># 主要就是下面这两行  sites-enabled 这个文件夹下有个 default 文件。就是这个文件里面配置的东西，conf.d 这个文件夹是空文件夹，不看。</span> include /etc/nginx/conf.d/*.conf<span class="token punctuation">;</span> <span class="token comment"># 导入默认设置</span> include /etc/nginx/sites-enabled/*<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment"># mail模块，用的不多</span><span class="token comment">#mail &#123;</span><span class="token comment"># # See sample authentication script at:</span><span class="token comment"># # http://wiki.nginx.org/ImapAuthenticateWithApachePhpScript</span><span class="token comment"># </span><span class="token comment"># # auth_http localhost/auth.php;</span><span class="token comment"># # pop3_capabilities "TOP" "USER";</span><span class="token comment"># # imap_capabilities "IMAP4rev1" "UIDPLUS";</span><span class="token comment"># </span><span class="token comment"># server &#123;</span><span class="token comment">#  listen     localhost:110;</span><span class="token comment">#  protocol   pop3;</span><span class="token comment">#  proxy      on;</span><span class="token comment"># &#125;</span><span class="token comment"># </span><span class="token comment"># server &#123;</span><span class="token comment">#  listen     localhost:143;</span><span class="token comment">#  protocol   imap;</span><span class="token comment">#  proxy      on;</span><span class="token comment"># &#125;</span><span class="token comment">#&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="Default文件"><a href="#Default文件" class="headerlink" title="Default文件"></a>Default文件</h3><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">##</span><span class="token comment"># 你应该看看下面的网址，以便掌握一个坚实的理解</span><span class="token comment"># 为了充分发挥Nginx的威力，需要使用Nginx配置文件。</span><span class="token comment"># https://www.nginx.com/resources/wiki/start/</span><span class="token comment"># https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/</span><span class="token comment"># https://wiki.debian.org/Nginx/DirectoryStructure</span><span class="token comment">#</span><span class="token comment"># 在大多数情况下，管理员会从启用/和</span><span class="token comment"># 将其保留为网站内的参考，以便继续使用</span><span class="token comment"># 由nginx包装团队更新。</span><span class="token comment">#</span><span class="token comment"># 此文件将自动加载其他用户提供的配置文件</span><span class="token comment"># 应用程序，如Drupal或Wordpress。这些申请将被提出</span><span class="token comment"># 在具有该包名称的路径下可用，例如/drupal8。</span><span class="token comment">#</span><span class="token comment"># 请参阅/usr/share/doc/nginx doc/examples/了解更多详细示例。</span><span class="token comment">##</span><span class="token comment"># 默认服务配置</span><span class="token comment">#</span>server <span class="token punctuation">&#123;</span> <span class="token comment"># listen指定端口号。</span> listen <span class="token number">80</span> default_server<span class="token punctuation">;</span> listen <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:80 default_server<span class="token punctuation">;</span> <span class="token comment"># SSL配置</span> <span class="token comment">#</span> <span class="token comment"># listen 443 ssl default_server;</span> <span class="token comment"># listen [::]:443 ssl default_server;</span> <span class="token comment">#</span> <span class="token comment"># 注意：您应该为SSL通信禁用gzip。</span> <span class="token comment"># See: https://bugs.debian.org/773332</span> <span class="token comment">#</span> <span class="token comment"># 阅读ssl_密码以确保安全配置。</span> <span class="token comment"># See: https://bugs.debian.org/765782</span> <span class="token comment">#</span> <span class="token comment"># ssl证书包生成的自签名证书</span> <span class="token comment"># 不要在生产服务器中使用它们！</span> <span class="token comment">#</span> <span class="token comment"># include snippets/snakeoil.conf;</span> <span class="token comment"># 定义服务器的默认网站根目录位置。</span> root /var/www/html<span class="token punctuation">;</span> <span class="token comment"># 添加首页。如果使用php，请将php添加到列表中</span> index index.html index.htm index.nginx-debian.html<span class="token punctuation">;</span> <span class="token comment"># 指定服务器的域名。这个_和localhost的区别我也不是很清楚</span> server_name _<span class="token punctuation">;</span> location / <span class="token punctuation">&#123;</span>  <span class="token comment"># 首先尝试将请求作为文件，然后</span>  <span class="token comment"># 作为目录，然后返回显示404。</span>  try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ <span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token comment"># 将PHP脚本传递给FastCGI服务器</span> <span class="token comment">#</span> <span class="token comment">#location ~ \.php$ &#123;</span> <span class="token comment"># include snippets/fastcgi-php.conf;</span> <span class="token comment">#</span> <span class="token comment"># # 使用php fpm（或其他unix套接字）:</span> <span class="token comment"># fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;</span> <span class="token comment"># # 使用php cgi（或其他tcp套接字）:</span> <span class="token comment"># fastcgi_pass 127.0.0.1:9000;</span> <span class="token comment">#&#125;</span> <span class="token comment"># deny access to .htaccess files, if Apache's document root</span> <span class="token comment"># concurs with nginx's one</span> <span class="token comment"># 拒绝访问。htaccess文件，如果Apache的文档根</span> <span class="token comment"># 同意nginx的观点</span> <span class="token comment">#</span> <span class="token comment">#location ~ /\.ht &#123;</span> <span class="token comment"># deny all;</span> <span class="token comment">#&#125;</span><span class="token punctuation">&#125;</span><span class="token comment"># Virtual Host configuration for example.com</span><span class="token comment"># 例如，虚拟主机配置。example.com</span><span class="token comment">#</span><span class="token comment"># 您可以将其移动到“可用站点”下的另一个文件中，并将其符号链接</span><span class="token comment"># 到已启用的站点/以启用它。</span><span class="token comment">#</span><span class="token comment">#server &#123;</span><span class="token comment"># listen 80;</span><span class="token comment"># listen [::]:80;</span><span class="token comment">#</span><span class="token comment"># server_name example.com;</span><span class="token comment">#</span><span class="token comment"># root /var/www/example.com;</span><span class="token comment"># index index.html;</span><span class="token comment">#</span><span class="token comment"># location / &#123;</span><span class="token comment">#  try_files $uri $uri/ =404;</span><span class="token comment"># &#125;</span><span class="token comment">#&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>学习一途，欲速则不达，真的当你完全弄懂这些配置中的符号的意思之后，你再看这些配置你的感觉是不一样的。当然我也是在一点一点的学习，我甚至装了个有图形化的Ubuntu虚拟机，为了研究nginx,这个默认生成的配置文件，我一开始是看不懂的，我也看了很长时间。😂😂😂</p><h2 id="安装nginx没有生成各类目录文件问题解决"><a href="#安装nginx没有生成各类目录文件问题解决" class="headerlink" title="安装nginx没有生成各类目录文件问题解决"></a>安装nginx没有生成各类目录文件问题解决</h2><p>由于途中我需要手动安装一次，我就把使用apt安装的nginx给卸载了，并且把配置文件给删了，我再次使用apt安装时，发现不重新生成默认配置了。解决办法。依次执行。</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> --purge remove nginx-common<span class="token function">sudo</span> <span class="token function">apt-get</span> --purge remove nginx*<span class="token function">sudo</span> <span class="token function">apt-get</span> autoremove<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="常用配置的介绍以及样例"><a href="#常用配置的介绍以及样例" class="headerlink" title="常用配置的介绍以及样例"></a>常用配置的介绍以及样例</h2><h3 id="侦听端口"><a href="#侦听端口" class="headerlink" title="侦听端口"></a>侦听端口</h3><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">server <span class="token punctuation">&#123;</span>  <span class="token comment"># Standard HTTP Protocol  </span>listen <span class="token number">80</span><span class="token punctuation">;</span>  <span class="token comment"># Standard HTTPS Protocol  </span>listen <span class="token number">443</span> ssl<span class="token punctuation">;</span>  <span class="token comment"># For http2  </span>listen <span class="token number">443</span> ssl http2<span class="token punctuation">;</span>  <span class="token comment"># Listen on 80 using IPv6  </span>listen <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:80<span class="token punctuation">;</span>  <span class="token comment"># Listen only on using IPv6  </span>listen <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:80 <span class="token assign-left variable">ipv6only</span><span class="token operator">=</span>on<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="访问日志"><a href="#访问日志" class="headerlink" title="访问日志"></a>访问日志</h3><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">server <span class="token punctuation">&#123;</span>  <span class="token comment"># Relative or full path to log file  </span>access_log /path/to/file.log<span class="token punctuation">;</span>  <span class="token comment"># Turn 'on' or 'off'    </span>access_log on<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="域名"><a href="#域名" class="headerlink" title="域名"></a>域名</h3><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">server <span class="token punctuation">&#123;</span>  <span class="token comment"># Listen to yourdomain.com  </span>server_name yourdomain.com<span class="token punctuation">;</span>  <span class="token comment"># Listen to multiple domains server_name yourdomain.com www.yourdomain.com;  </span><span class="token comment"># Listen to all domains  </span>server_name *.yourdomain.com<span class="token punctuation">;</span>  <span class="token comment"># Listen to all top-level domains  </span>server_name yourdomain.*<span class="token punctuation">;</span>  <span class="token comment"># Listen to unspecified Hostnames (Listens to IP address itself)  </span>server_name <span class="token string">""</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="静态资产"><a href="#静态资产" class="headerlink" title="静态资产"></a>静态资产</h3><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">server <span class="token punctuation">&#123;</span>  listen <span class="token number">80</span><span class="token punctuation">;</span>  server_name yourdomain.com<span class="token punctuation">;</span>  location / <span class="token punctuation">&#123;</span>  root /path/to/website<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">server <span class="token punctuation">&#123;</span>  listen <span class="token number">80</span><span class="token punctuation">;</span>  server_name www.yourdomain.com<span class="token punctuation">;</span>  <span class="token builtin class-name">return</span> <span class="token number">301</span> http://yourdomain.com<span class="token variable">$request_uri</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  server <span class="token punctuation">&#123;</span>  listen <span class="token number">80</span><span class="token punctuation">;</span>  server_name www.yourdomain.com<span class="token punctuation">;</span>  location /redirect-url <span class="token punctuation">&#123;</span>  <span class="token builtin class-name">return</span> <span class="token number">301</span> http://otherdomain.com<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># []表示需要填写，</span><span class="token comment"># nginx默认采用轮训的方式进行负载均衡</span>upstream <span class="token punctuation">[</span>proxyName<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>    server <span class="token number">192.168</span>.1.173:8080<span class="token punctuation">;</span>    server <span class="token number">192.168</span>.1.174:8080<span class="token punctuation">;</span>    server <span class="token number">192.168</span>.1.175:8080<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment"># 加权轮询值越高访问频率越高</span>upstream <span class="token punctuation">[</span>proxyName<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>    server <span class="token number">192.168</span>.1.173:8080 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>    server <span class="token number">192.168</span>.1.174:8080 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>    server <span class="token number">192.168</span>.1.175:8080 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">#  hash负载均衡</span>upstream <span class="token punctuation">[</span>proxyName<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>    ip_hash    server <span class="token number">192.168</span>.1.173:8080<span class="token punctuation">;</span>    server <span class="token number">192.168</span>.1.174:8080<span class="token punctuation">;</span>    server <span class="token number">192.168</span>.1.175:8080<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment"># hash算法实际上只会计算 192.168.1这段做哈希</span><span class="token comment"># 使用ip_hash的注意点：不能把后台服务器直接移除，只能标记down.</span><span class="token comment"># url hash负载均衡</span>upstream <span class="token punctuation">[</span>proxyName<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>    <span class="token builtin class-name">hash</span> <span class="token variable">$request_url</span><span class="token punctuation">;</span>    server <span class="token number">192.168</span>.1.173:8080<span class="token punctuation">;</span>    server <span class="token number">192.168</span>.1.174:8080<span class="token punctuation">;</span>    server <span class="token number">192.168</span>.1.175:8080<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment"># 最小连接负载均衡</span>upstream <span class="token punctuation">[</span>proxyName<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>    least_conn<span class="token punctuation">;</span>    server <span class="token number">192.168</span>.1.173:8080<span class="token punctuation">;</span>    server <span class="token number">192.168</span>.1.174:8080<span class="token punctuation">;</span>    server <span class="token number">192.168</span>.1.175:8080<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h4 id="keepalived"><a href="#keepalived" class="headerlink" title="keepalived"></a>keepalived</h4><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">upstream <span class="token punctuation">[</span>proxyName<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>    server <span class="token number">192.168</span>.1.173:8080 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>    server <span class="token number">192.168</span>.1.174:8080 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>    server <span class="token number">192.168</span>.1.175:8080 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>    keepalive <span class="token number">32</span><span class="token punctuation">;</span> <span class="token comment">#保持的连接数</span><span class="token punctuation">&#125;</span>server <span class="token punctuation">&#123;</span>    listem  <span class="token number">80</span><span class="token punctuation">;</span>    server_name www.tomcats.com<span class="token punctuation">;</span>    location / <span class="token punctuation">&#123;</span>        proxy_pass http://tomcats<span class="token punctuation">;</span>        proxy_http_version <span class="token number">1.1</span><span class="token punctuation">;</span> <span class="token comment">#连接的协议版本</span>        proxy_set_header Connection <span class="token string">""</span><span class="token punctuation">;</span> 清空连接请求头    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h4 id="控制浏览器缓存"><a href="#控制浏览器缓存" class="headerlink" title="控制浏览器缓存"></a>控制浏览器缓存</h4><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">server <span class="token punctuation">&#123;</span>    listem  <span class="token number">80</span><span class="token punctuation">;</span>    server_name www.tomcats.com<span class="token punctuation">;</span>    location / <span class="token punctuation">&#123;</span>        proxy_pass http://tomcats<span class="token punctuation">;</span>               expires 10s<span class="token punctuation">;</span>  <span class="token comment">#浏览器缓存10秒钟</span>               <span class="token comment">#expires @22h30m  #在晚上10点30的时候过期</span>               <span class="token comment">#expires -1h  #缓存在一小时前时效</span>               <span class="token comment">#expires epoch  #不设置缓存</span>               <span class="token comment">#expires off  #缓存关闭，浏览器自己控制缓存</span>               <span class="token comment">#expires max  #最大过期时间</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h4 id="反向代理缓存"><a href="#反向代理缓存" class="headerlink" title="反向代理缓存"></a>反向代理缓存</h4><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">upstream <span class="token punctuation">[</span>proxyName<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>    server <span class="token number">192.168</span>.1.173:8080 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>    server <span class="token number">192.168</span>.1.174:8080 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>    server <span class="token number">192.168</span>.1.175:8080 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">#proxy_cache_path 设置缓存保存的目录的位置</span><span class="token comment">#keys_zone设置共享内以及占用的空间大小</span><span class="token comment">#mas_size 设置缓存最大空间</span><span class="token comment">#inactive 缓存过期时间，错过此时间自动清理</span><span class="token comment">#use_temp_path 关闭零时目录</span>proxy_cache_path /usr/local/nginx/upsteam_cache <span class="token assign-left variable">keys_zone</span><span class="token operator">=</span>mycache:5m <span class="token assign-left variable">max_size</span><span class="token operator">=</span>1g <span class="token assign-left variable">inactive</span><span class="token operator">=</span>8h <span class="token assign-left variable">use_temp_path</span><span class="token operator">=</span>off<span class="token punctuation">;</span>server <span class="token punctuation">&#123;</span>    listem  <span class="token number">80</span><span class="token punctuation">;</span>    server_name www.tomcats.com<span class="token punctuation">;</span>    <span class="token comment">#开启并使用缓存</span>    proxy_cache mycache<span class="token punctuation">;</span>    <span class="token comment">#针对200和304响应码的缓存过期时间</span>    proxy_cache_valid <span class="token number">200</span> <span class="token number">304</span> 8h<span class="token punctuation">;</span>       location / <span class="token punctuation">&#123;</span>        proxy_pass http://tomcats<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">server <span class="token punctuation">&#123;</span>  listen <span class="token number">80</span><span class="token punctuation">;</span>  server_name yourdomain.com<span class="token punctuation">;</span>  location / <span class="token punctuation">&#123;</span>  proxy_pass http://0.0.0.0:3000<span class="token punctuation">;</span>  <span class="token comment"># where 0.0.0.0:3000 is your application server (Ex: node.js) bound on 0.0.0.0 listening on port 3000  </span><span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="SSL-协议"><a href="#SSL-协议" class="headerlink" title="SSL 协议"></a>SSL 协议</h3><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">server <span class="token punctuation">&#123;</span>  listen <span class="token number">443</span> ssl<span class="token punctuation">;</span>  server_name yourdomain.com<span class="token punctuation">;</span>  ssl on<span class="token punctuation">;</span>  ssl_certificate /path/to/cert.pem<span class="token punctuation">;</span>  ssl_certificate_key /path/to/privatekey.pem<span class="token punctuation">;</span>  ssl_stapling on<span class="token punctuation">;</span>  ssl_stapling_verify on<span class="token punctuation">;</span>  ssl_trusted_certificate /path/to/fullchain.pem<span class="token punctuation">;</span>  ssl_protocols TLSv1 TLSv1.1 TLSv1.2<span class="token punctuation">;</span>  ssl_session_timeout 1h<span class="token punctuation">;</span>  ssl_session_cache shared:SSL:50m<span class="token punctuation">;</span>  add_header Strict-Transport-Security max-age<span class="token operator">=</span><span class="token number">15768000</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment"># Permanent Redirect for HTTP to HTTPS  </span>server   <span class="token punctuation">&#123;</span>  listen <span class="token number">80</span><span class="token punctuation">;</span>  server_name yourdomain.com<span class="token punctuation">;</span>  <span class="token builtin class-name">return</span> <span class="token number">301</span> https://<span class="token variable">$host</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><div class="note note-info">            <p>其实可以采用可视化的方式对 Nginx 进行配置，我在 GitHub 上发现了一款可以一键生成 Nginx 配置的神器，相当给力。</p><p>先来看看它都支持什么功能的配置：反向代理、HTTPS、HTTP&#x2F;2、IPv6, 缓存、WordPress、CDN、Node.js 支持、 Python (Django) 服务器等等。</p><p>如果你想在线进行配置，只需要打开网站：<a href="https://nginxconfig.io/">https://nginxconfig.io/</a>，按照自己的需求进行操作就行了。</p><p>操作这个的前提，也是需要你懂！！别人的理所当然是了如指掌做到的。</p>          </div><h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><h3 id="简单的部署前后台分离的项目配置"><a href="#简单的部署前后台分离的项目配置" class="headerlink" title="简单的部署前后台分离的项目配置"></a>简单的部署前后台分离的项目配置</h3><p>部署前后台分离的项目，随便新建个html项目，里面写一个按钮用来发送Ajax请求。多说两句，webpack项目只是”方便“了开发，最终的产物依然是Html，Css，JavaScript。我们先手撸一个简单的项目前台项目。项目要求就是有个页面，有个按钮。点击能发送Ajax请求，且能把请求的返回内容回馈给用户。需求有了，idea打开，开码！！！</p><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>  <span class="token comment">&lt;!-- 这里引入的JS放在nginx中也需要对应根目录存放一个 --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>js/jq/jquery-3.6.0.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">  <span class="token selector">.app</span> <span class="token punctuation">&#123;</span>   <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>   <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token selector">.red</span><span class="token punctuation">&#123;</span>   <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token selector">.green</span><span class="token punctuation">&#123;</span>   <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>msg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>请点击按钮<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>点击发送请求<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">   <span class="token keyword">let</span> <span class="token function-variable function">send</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>     <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'api/get'</span><span class="token punctuation">,</span>     <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>     <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">'json'</span><span class="token punctuation">,</span>     <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#msg'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;div id="msg" class="green">返回内容：'</span><span class="token operator">+</span>res<span class="token punctuation">.</span>msg<span class="token operator">+</span><span class="token string">'&lt;div>'</span><span class="token punctuation">)</span>     <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>     <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">xhr<span class="token punctuation">,</span>status<span class="token punctuation">,</span>e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#msg'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;div id="msg" class="red">请求错误&lt;div>'</span><span class="token punctuation">)</span>     <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>   <span class="token punctuation">&#125;</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>代码写好了，部署。这个很简单啊，你要是图省事，直接覆盖默认配置文件夹中的index.html即可，</p><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h0s2ijjcdbj31z418gtm3.jpg" alt="前台部署成功"></p><p>很快啊，前台项目部署好了。</p><p>这时候我们需要部署后端项目了。idea打开新建springboot项目。开码！！！</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/* 用来获取端口号项目运行的端口号，后面测试负载均衡时用到 */</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigWeb</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WebServerInitializedEvent</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> serverPort<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">InetAddress</span> address <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            address <span class="token operator">=</span> <span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getLocalHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnknownHostException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token string">"http://"</span><span class="token operator">+</span> address<span class="token punctuation">.</span><span class="token function">getHostAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">":"</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>serverPort<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onApplicationEvent</span><span class="token punctuation">(</span><span class="token class-name">WebServerInitializedEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>serverPort <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getWebServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>核心代码，get请求返回项目运行端口号。</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/api"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">ConfigWeb</span> configWeb<span class="token punctuation">;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/get"</span><span class="token punctuation">)</span>    <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span><span class="token string">"服务端口"</span><span class="token operator">+</span>configWeb<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>核心代码如上图。</p><p>很快啊后端也不，后端快不起来，需要装Java环境。稍等，很快啊后端也部署好了。后台服务的端口是8081。这时候我们很自然的想到了，把之前的Ajax中的请求url<code>api/get</code>换成<code>http://localhost:8081/api/get</code>,这样前后台应该就能连通了。于是改了一下刷新页面，再次点击，还是不行。</p><p>报错信息：</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">已拦截跨源请求：同源策略禁止读取位于 http://localhost:8081/api/get 的远程资源。（原因：CORS 头缺少 <span class="token string">'Access-Control-Allow-Origin'</span>）。状态码：200。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><p>火狐浏览器是这样提示的，别的浏览器可能会有些许的差别，但不重要，重要的是，我们的前后台并没有连通！！<br>这个时候我们需要配置反向代理了，来规避跨域的错误。</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 在配置文件的根目录中块，upstream 后面的字符并不是标识符，</span><span class="token comment"># 你可以写别的如tomcat,我这里是写成了nginx。</span><span class="token comment"># 这个块里的server是可以有多个的。这就是传说中的负载均衡。</span><span class="token comment"># 你配一个就用来做简单的反向代理即可。配多个就是负载均衡。 默认使用轮询，</span>upstream nginx <span class="token punctuation">&#123;</span>    server localhost:8081<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment"># 在server块中加一个location块。`/api/`,表示url中有`/api/`，</span><span class="token comment"># 执行这个逻辑，且别的location不在处理这个url请求</span>location /api/ <span class="token punctuation">&#123;</span>  <span class="token comment"># 这里就是反向代理，http://后面的字符对应上面upstream块后的字符。</span> roxy_pass http://nginx<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>到这里配置结束，项目就是就可以正常启动了。需要弄负载均衡，你就多跑几个服务，能进行负载均衡的项目，对项目有一点点要求，要求项目本身必须是无状态的，不然的话可能会影响到正常使用，比如如果你这个项目中是在项目里也就是内存里保存的用户的登录状态，那么你负载均衡时，就会出问题，因为负载均衡默认是轮询，你可以理解成这个节点，你登陆过，你刷新一个页面，然后就访问了新的节点，但是你的登录信息是保存在上一个节点中的，这个新节点，并没有保存你的登录信息，你就需要重新登录。这就影响功能了。所以这种情况一般使用Redis来保存一些状态信息。就可以想跑几个项目就跑几个项目了。状态，这个概念可能难以理解，但是，官方文档英文就是这个意思，理解了自然也就理解了。加油。</p><p>全部配置文件<code>nginx.conf</code></p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">user www-data<span class="token punctuation">;</span>worker_processes auto<span class="token punctuation">;</span>pid /run/nginx.pid<span class="token punctuation">;</span>include /etc/nginx/modules-enabled/*.conf<span class="token punctuation">;</span>events <span class="token punctuation">&#123;</span> worker_connections <span class="token number">768</span><span class="token punctuation">;</span> <span class="token comment"># multi_accept on;</span><span class="token punctuation">&#125;</span>http <span class="token punctuation">&#123;</span> sendfile on<span class="token punctuation">;</span> tcp_nopush on<span class="token punctuation">;</span> tcp_nodelay on<span class="token punctuation">;</span> keepalive_timeout <span class="token number">65</span><span class="token punctuation">;</span> types_hash_max_size <span class="token number">2048</span><span class="token punctuation">;</span> include /etc/nginx/mime.types<span class="token punctuation">;</span> default_type application/octet-stream<span class="token punctuation">;</span> ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3<span class="token punctuation">;</span> <span class="token comment"># Dropping SSLv3, ref: POODLE</span> ssl_prefer_server_ciphers on<span class="token punctuation">;</span> access_log /var/log/nginx/access.log<span class="token punctuation">;</span> error_log /var/log/nginx/error.log<span class="token punctuation">;</span> <span class="token function">gzip</span> on<span class="token punctuation">;</span> include /etc/nginx/conf.d/*.conf<span class="token punctuation">;</span>   upstream nginx <span class="token punctuation">&#123;</span>    server localhost:8081<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  server <span class="token punctuation">&#123;</span>  listen <span class="token number">80</span> default_server<span class="token punctuation">;</span>  listen <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:80 default_server<span class="token punctuation">;</span>  root /var/www/html<span class="token punctuation">;</span>  index index.html index.htm index.nginx-debian.html<span class="token punctuation">;</span>  server_name _<span class="token punctuation">;</span>  location /api/ <span class="token punctuation">&#123;</span>    proxy_pass http://nginx<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  location / <span class="token punctuation">&#123;</span>    try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ <span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="配置SSL"><a href="#配置SSL" class="headerlink" title="配置SSL"></a>配置SSL</h3><h4 id="使用openssl生成证书"><a href="#使用openssl生成证书" class="headerlink" title="使用openssl生成证书"></a>使用openssl生成证书</h4><p>openssl是目前最流行的SSL密码库工具，其提供了一个通用、健壮、功能完备的工具套件，用以支持SSL&#x2F;TLS协议的实现。</p><p>比如生成到：<code>/usr/local/ssl</code></p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">openssl req -x509 -nodes -days <span class="token number">36500</span> -newkey rsa:2048 -keyout /usr/local/ssl/nginx.key -out /usr/local/ssl/nginx.crt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><p>生成好了，一般我们直接强制https，只需要配置一个重定向即可。</p><p>完整的配置nginx.conf</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">user www-data<span class="token punctuation">;</span>worker_processes auto<span class="token punctuation">;</span>pid /run/nginx.pid<span class="token punctuation">;</span>include /etc/nginx/modules-enabled/*.conf<span class="token punctuation">;</span>events <span class="token punctuation">&#123;</span> worker_connections <span class="token number">768</span><span class="token punctuation">;</span> <span class="token comment"># multi_accept on;</span><span class="token punctuation">&#125;</span>http <span class="token punctuation">&#123;</span> sendfile on<span class="token punctuation">;</span> tcp_nopush on<span class="token punctuation">;</span> tcp_nodelay on<span class="token punctuation">;</span> keepalive_timeout <span class="token number">65</span><span class="token punctuation">;</span> types_hash_max_size <span class="token number">2048</span><span class="token punctuation">;</span> include /etc/nginx/mime.types<span class="token punctuation">;</span> default_type application/octet-stream<span class="token punctuation">;</span> ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3<span class="token punctuation">;</span> <span class="token comment"># Dropping SSLv3, ref: POODLE</span> ssl_prefer_server_ciphers on<span class="token punctuation">;</span> access_log /var/log/nginx/access.log<span class="token punctuation">;</span> error_log /var/log/nginx/error.log<span class="token punctuation">;</span> <span class="token function">gzip</span> on<span class="token punctuation">;</span> include /etc/nginx/conf.d/*.conf<span class="token punctuation">;</span> <span class="token comment"># 这里是负载均衡。请求后端时建议使用这种方式。默认负载均衡是轮询，就是一个一个按顺序来</span>upstream nginx <span class="token punctuation">&#123;</span>    <span class="token comment"># 生产上这里一般配置域名或者ip地址</span>    server localhost:8081<span class="token punctuation">;</span>    server localhost:8082<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment"># HTTP redirect</span>server <span class="token punctuation">&#123;</span>    listen      <span class="token number">80</span><span class="token punctuation">;</span>    listen      <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:80<span class="token punctuation">;</span>    <span class="token comment"># 生产上这里一般配置域名</span>    server_name localhost<span class="token punctuation">;</span>    <span class="token comment"># http强制跳转https，可以理解为强制https</span>    <span class="token builtin class-name">return</span>  <span class="token number">301</span> https://localhost<span class="token variable">$request_uri</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>server <span class="token punctuation">&#123;</span> listen              <span class="token number">443</span> ssl http2<span class="token punctuation">;</span> listen              <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:443 ssl http2<span class="token punctuation">;</span> server_name         localhost<span class="token punctuation">;</span> <span class="token comment"># SSL 这里生产上需要换成生产上的证书位置即可。自己生成的证书浏览器并不认可。</span> ssl_certificate     /usr/local/ssl/nginx.crt<span class="token punctuation">;</span> ssl_certificate_key /usr/local/ssl/nginx.key<span class="token punctuation">;</span> root /var/www/html<span class="token punctuation">;</span> <span class="token comment"># 首页设置</span> index index.html index.htm index.nginx-debian.html<span class="token punctuation">;</span> location /api/ <span class="token punctuation">&#123;</span>  <span class="token comment">#  请求后端服务，这里访问的是配置的负载均衡服务器。</span>  proxy_pass http://nginx<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> location / <span class="token punctuation">&#123;</span>  <span class="token comment"># 如果部署的是Vue等项目，这里可能需要改动，</span>  <span class="token comment"># 如果项目url中有#这个的，那就不要动，如果没有#的，那就需要改动。</span>  try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ <span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>常用的一般是反向代理和负载均衡。关于负载均衡的地方可以多看看，如果负载均衡中一个服务挂了的情况，会是怎么个处理情况，不同的负载均衡模式下，又有什么不同。等等，都是需要思考的。</p><p>最后应该是关于Ngixn的高可用，作为静态服务器时，Nginx的性能应该够用，反向代理时，我们主要考虑的应该是反向代理目标服务器的稳定。所以就暂且不研究Ngixn的高可用，一般主备双机之类的，真到Nginx扛不住的那时候，首先应该考虑的是架构的问题了。得上微服务了。</p><h2 id="封"><a href="#封" class="headerlink" title="封"></a>封</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h0v3nbhzz0j32yo1o0u0y.jpg" alt="原神和煦希望之风"></p>]]></content>
    
    
    <categories>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>动态数据源，多数据源，读写分离</title>
    <link href="/2022/03/11/java-11/"/>
    <url>/2022/03/11/java-11/</url>
    
    <content type="html"><![CDATA[<p>使用springboot给你带来多大便利，你就要接受方便使用带来的相应的复杂度。直线正常跑谁不会给油啊，弯道快，才是真的快。说一说，数据源，就是个DataSource，多数据源就是多个DataSource，读写分离，就是读用一个数据源，写入一个数据源。一般增删改使用主库，查使用从库。配置数据库主从复制。</p><p>在springboot中对数据源怎么操作嘞。说思路，springboot中的自动配置用的很舒服，我们要做的就是把springboot这个我们用的很舒服的自动配置给去掉。这个自动配置会往运行环境里添加一个默认的数据源。这个自动配置这块东西不少，各种花里胡哨的注解，我见都是第一次见，你让我知道它的作用，是有一点扯的。害，没有开发springbooot-stater的经验，不宜多说。</p><h2 id="手动注入数据源"><a href="#手动注入数据源" class="headerlink" title="手动注入数据源"></a>手动注入数据源</h2><h3 id="以前的XML写法"><a href="#以前的XML写法" class="headerlink" title="以前的XML写法"></a>以前的XML写法</h3><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--2. 配置数据源--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dataSource<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.alibaba.druid.pool.DruidDataSource<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driverClassName<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.driver&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.url&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.username&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;jdbc.password&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="JavaConfig写法"><a href="#JavaConfig写法" class="headerlink" title="JavaConfig写法"></a>JavaConfig写法</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataContext</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">HikariDataSource</span> dataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HikariDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dataSource<span class="token punctuation">.</span><span class="token function">setJdbcUrl</span><span class="token punctuation">(</span><span class="token string">"xxxx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dataSource<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"xxxx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dataSource<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"xxxx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> dataSource<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>springboot相当于是集JavaConfig于大成者，springboot的stater，大多数就是配置上面的内容，使用springboot的规范就能在启动的时候加载配置类。一般手动注入数据源，需要先把springboot自动加载的配置类给排除掉，改一下启动类的注解<code>@SpringBootApplication(exclude = &#123;DataSourceAutoConfiguration.class&#125;)</code> 改成这样就可以，为什么我要拿出来说呢，因为在下面实现动态数据源的时候也是需要排除这个的。</p><h2 id="动态数据源"><a href="#动态数据源" class="headerlink" title="动态数据源"></a>动态数据源</h2><p>浅聊一下，动态数据源是对数据源的高级操作，所以就不要有这样的疑问，动态数据源能不能做到读写分离，能不能多数据源这样的问题。这种问题就和知乎上的提问：请问我拿了诺奖后可不可以保研？</p><h3 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h3><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>dynamic-datasource-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>$&#123;dynamic.verion&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- maven官网上用最新的版本即可 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="yml配置"><a href="#yml配置" class="headerlink" title="yml配置"></a>yml配置</h3><figure><div class="code-wrapper"><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token comment"># 数据源配置</span>  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>    <span class="token comment"># 动态数据源配置</span>    <span class="token key atrule">dynamic</span><span class="token punctuation">:</span>      <span class="token comment"># 设置默认的库,默认master</span>      <span class="token key atrule">primary</span><span class="token punctuation">:</span> master      <span class="token comment"># 是否启用严格模式,默认不启动. 严格模式下未匹配到数据源直接报错, 非严格模式下则使用默认数据源primary所设置的数据源</span>      <span class="token key atrule">strict</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>      <span class="token comment"># 是否使用p6spy输出，默认不输出</span>      <span class="token key atrule">p6spy</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>      <span class="token comment"># 数据源列表</span>      <span class="token key atrule">datasource</span><span class="token punctuation">:</span>        <span class="token comment"># 主库</span>        <span class="token key atrule">master</span><span class="token punctuation">:</span>          <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/xxxx          <span class="token key atrule">username</span><span class="token punctuation">:</span> root          <span class="token key atrule">password</span><span class="token punctuation">:</span> root        <span class="token comment"># 从库1</span>        <span class="token key atrule">second1</span><span class="token punctuation">:</span>          <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/xxxx          <span class="token key atrule">username</span><span class="token punctuation">:</span> root          <span class="token key atrule">password</span><span class="token punctuation">:</span> root        <span class="token comment"># 从库2</span>        <span class="token key atrule">second2</span><span class="token punctuation">:</span>          <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/xxxx          <span class="token key atrule">username</span><span class="token punctuation">:</span> root          <span class="token key atrule">password</span><span class="token punctuation">:</span> root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="使用-DS切换数据源"><a href="#使用-DS切换数据源" class="headerlink" title="使用@DS切换数据源"></a>使用<code>@DS</code>切换数据源</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NameServer</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>    <span class="token annotation punctuation">@DS</span><span class="token punctuation">(</span><span class="token class-name">ConstSource</span><span class="token punctuation">.</span>SECOND2<span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span><span class="token punctuation">></span></span> maps <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">queryForList</span><span class="token punctuation">(</span><span class="token string">"select name from wlf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> maps<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">""</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 这里一般对应配置文件中的数据源新建常量。</span><span class="token comment">/** * 数据源常量 */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConstSource</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> MASTER <span class="token operator">=</span> <span class="token string">"master"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> SECOND1 <span class="token operator">=</span> <span class="token string">"second1"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> SECOND2 <span class="token operator">=</span> <span class="token string">"second2"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p><code>@DS</code> 可以注解在方法上或类上，同时存在就近原则 方法上注解 优先于 类上注解。</p><table><thead><tr><th>注解</th><th>结果</th></tr></thead><tbody><tr><td>没有@DS</td><td>默认数据源</td></tr><tr><td>@DS(“dsName”)</td><td>dsName可以为组名也可以为具体某个库的名称</td></tr></tbody></table><h3 id="编程式切换数据源"><a href="#编程式切换数据源" class="headerlink" title="编程式切换数据源"></a>编程式切换数据源</h3><p>框架提供了编程式切换数据源。稍加封装改造一下。不建议手动修改数据源。</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataContext</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">protected</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">protected</span> <span class="token class-name">DefaultDataSourceCreator</span> dataSourceCreator<span class="token punctuation">;</span>    <span class="token comment">/**     * 新增数据源     *     * @param name 名称     * @param username 账户     * @param password 密码     * @param url 连接     * @param driver 驱动     * */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createDataSource</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">String</span> driver<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">DynamicRoutingDataSource</span> dynamicRoutingDataSource <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">DynamicRoutingDataSource</span><span class="token punctuation">)</span> dataSource<span class="token punctuation">;</span>        <span class="token class-name">DataSourceProperty</span> dsp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dsp<span class="token punctuation">.</span><span class="token function">setPoolName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        dsp<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>        dsp<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>        dsp<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>        dsp<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> dataSourceCreator<span class="token punctuation">.</span><span class="token function">createDataSource</span><span class="token punctuation">(</span>dsp<span class="token punctuation">)</span><span class="token punctuation">;</span>        dynamicRoutingDataSource<span class="token punctuation">.</span><span class="token function">addDataSource</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 不建议手动调用     * 切换数据源，调用过后使用完毕后请务必调用一次cleanDataSource()方法。     *     * @param name 名称     * */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">changeDataSource</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">DynamicDataSourceContextHolder</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 清空数据源     *     * @param name 名称     * */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cleanDataSource</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">DynamicDataSourceContextHolder</span><span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token comment">/**     * 清空所有数据源     *     * */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cleanDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">DynamicDataSourceContextHolder</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 修改数据源     *     * @param name 名称     * @param username 账户     * @param password 密码     * @param url 连接     * @param driver 驱动     * */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateDataSource</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">String</span> driver<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">removeDataSource</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">createDataSource</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> url<span class="token punctuation">,</span> driver<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 删除数据源     *     * @param name 名称     * */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeDataSource</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">DynamicRoutingDataSource</span> dynamicRoutingDataSource <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">DynamicRoutingDataSource</span><span class="token punctuation">)</span> dataSource<span class="token punctuation">;</span>        dynamicRoutingDataSource<span class="token punctuation">.</span><span class="token function">removeDataSource</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 数据源列表     * */</span>    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">DataSource</span><span class="token punctuation">></span></span> <span class="token function">getDataSources</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">DynamicRoutingDataSource</span> dynamicRoutingDataSource <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">DynamicRoutingDataSource</span><span class="token punctuation">)</span> dataSource<span class="token punctuation">;</span>        <span class="token keyword">return</span> dynamicRoutingDataSource<span class="token punctuation">.</span><span class="token function">getDataSources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 获取数据源     *     * @param name 名称     * */</span>    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">DynamicRoutingDataSource</span> dynamicRoutingDataSource <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">DynamicRoutingDataSource</span><span class="token punctuation">)</span> dataSource<span class="token punctuation">;</span>        <span class="token keyword">return</span> dynamicRoutingDataSource<span class="token punctuation">.</span><span class="token function">getDataSource</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// init dataSource</span>    <span class="token annotation punctuation">@PostConstruct</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">loadDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 这里是伪码，正常情况是从数据库中获取数据库连接信息</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysDataSource</span><span class="token punctuation">></span></span> sysDataSources <span class="token operator">=</span> sysDataSourceService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 循环调用添加方法即可</span>        sysDataSources<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>sysDataSource <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token function">createDataSource</span><span class="token punctuation">(</span>                    sysDataSource<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    sysDataSource<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    sysDataSource<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    sysDataSource<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    sysDataSource<span class="token punctuation">.</span><span class="token function">getDriver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>PS: 这种编程运行时操作数据源已经有点十分方便了，核心就是这个类<code>DefaultDataSourceCreator</code>，如果想深入了解可以看一看源码，可以以此种模式操作多租户的模式，根据不同用户连接不同的数据源。</p><h3 id="使用MyBatis插件读写分离"><a href="#使用MyBatis插件读写分离" class="headerlink" title="使用MyBatis插件读写分离"></a>使用MyBatis插件读写分离</h3><p>添加配置</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CoreConfig</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">ConfigurationCustomizer</span> <span class="token function">mybatisConfigurationCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> configuration <span class="token operator">-></span> configuration<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MasterSlaveAutoRoutingPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>支持MybatisPlus。及MyBatis.<br>PS：主从数据源配置应为</p><figure><div class="code-wrapper"><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>    <span class="token key atrule">dynamic</span><span class="token punctuation">:</span>      <span class="token key atrule">primary</span><span class="token punctuation">:</span> master      <span class="token key atrule">datasource</span><span class="token punctuation">:</span>        <span class="token comment"># 主库</span>        <span class="token key atrule">master</span><span class="token punctuation">:</span>        <span class="token comment"># 从库1</span>        <span class="token key atrule">slave_1</span><span class="token punctuation">:</span>        <span class="token comment"># 从库2</span>        slave_2<span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p><code>slave_1</code>,<code>slave_2</code>这样表示这两个数据源为一组，注解切换或者手动切换是数据源名应为<code>slave</code>,而不是<code>slave_1</code>,</p><h2 id="切换数据源失败"><a href="#切换数据源失败" class="headerlink" title="切换数据源失败"></a>切换数据源失败</h2><h3 id="使用了spring的事务，则切换数据源会有几率会失效，或者百分百失效"><a href="#使用了spring的事务，则切换数据源会有几率会失效，或者百分百失效" class="headerlink" title="使用了spring的事务，则切换数据源会有几率会失效，或者百分百失效"></a>使用了spring的事务，则切换数据源会有几率会失效，或者百分百失效</h3><p>开发者原文：</p><div class="note note-info">            <p>原因： spring开启事务后会维护一个ConnectionHolder，保证在整个事务下，都是用同一个数据库连接。请检查整个调用链路涉及的类的方法和类本身还有继承的抽象类上是否有@Transactional注解。</p>          </div><h3 id="方法内部调用"><a href="#方法内部调用" class="headerlink" title="方法内部调用"></a>方法内部调用</h3><p>查看以下示例 回答 外部调用 userservice.test1() 能在执行到 test2() 切换到second数据源吗？</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">UserService</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@DS</span><span class="token punctuation">(</span><span class="token string">"first"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// do something</span>         <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@DS</span><span class="token punctuation">(</span><span class="token string">"second"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// do something</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>答案：！！！不能不能不能！！！！ 数据源核心原理是基于aop代理实现切换，内部方法调用不会使用aop。</p><p>解决方法:</p><p>把test2()方法提到另外一个service,单独调用。</p><h3 id="使用了Shiro"><a href="#使用了Shiro" class="headerlink" title="使用了Shiro"></a>使用了Shiro</h3><p>建议不用，可以使用<code>sa-token</code>来代替。</p><h2 id="事务控制"><a href="#事务控制" class="headerlink" title="事务控制"></a>事务控制</h2><p>上面说到了使用spring的事务，会导致切换数据源失败。框架开发者也了解这个情况，写了一个本地的事务工具类<code>LocalTxUtil</code>来解决此问题</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">LocalTxUtil</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 手动开启事务     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">startTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token class-name">TransactionContext</span><span class="token punctuation">.</span><span class="token function">getXID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"dynamic-datasource exist local tx [&#123;&#125;]"</span><span class="token punctuation">,</span> <span class="token class-name">TransactionContext</span><span class="token punctuation">.</span><span class="token function">getXID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> xid <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">TransactionContext</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>xid<span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"dynamic-datasource start local tx [&#123;&#125;]"</span><span class="token punctuation">,</span> xid<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 手动提交事务     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"dynamic-datasource commit local tx [&#123;&#125;]"</span><span class="token punctuation">,</span> <span class="token class-name">TransactionContext</span><span class="token punctuation">.</span><span class="token function">getXID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">TransactionContext</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 手动回滚事务     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"dynamic-datasource rollback local tx [&#123;&#125;]"</span><span class="token punctuation">,</span> <span class="token class-name">TransactionContext</span><span class="token punctuation">.</span><span class="token function">getXID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">TransactionContext</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="后话"><a href="#后话" class="headerlink" title="后话"></a>后话</h2><p>在如今各种持久层框架中，我们越来越感知不到数据源的存在，好处是，配置简单了，坏处就是对数据源的处理时就有些麻烦。在古老的JDBC中，其实没有这个问题，万物<code>queryForList()</code>，换个数据源继续<code>queryForList()</code>。这个框架理论上支持任何持久层，因为人根本没把目光放在持久层上，专注于数据源，它只操作数据源的。</p><p>在springboot2.6.x的版本的不允许依赖循环，我属实不能理解。我不理解，</p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1h0d0j8r2dkj32yo1o07wi.jpg" alt="cosplay原神 珊瑚宫心海"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>springboot</tag>
      
      <tag>数据源</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PostgreSQL数据库安装</title>
    <link href="/2022/03/01/java-10/"/>
    <url>/2022/03/01/java-10/</url>
    
    <content type="html"><![CDATA[<p>postgresql和mysql差不多，都是免费开源的的数据库软件，在免费数据库，postgresql算是一个后起之秀。好像是比Mysql要优异一点，在各方面上。对于开发者来说，学习一个东西的第一步，肯定是先安装，然后再使用，使用我还没有在项目中使用过，不过我感觉都是sql标准，大差不差吧。</p><h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p><a href="https://www.baidu.com/s?ie=UTF-8&wd=PostgreSQL">百度一下</a></p><p>官网上下载。我这边下载的是14.2的版本，压缩包的安装方式，下载解压进入<code>pgsql</code>文件夹下，新建一个data文件夹，用来存放数据文件，cmd进入<code>pgsql</code>目录。执行命令。</p><h3 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h3><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">bin<span class="token punctuation">\</span>initdb -D data -U postgres -A password -E utf8 --locale<span class="token operator">=</span>C -W<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><div class="note note-info">            <p>-D  data                       指定初始化的数据库目录(此处为当前目录的data文件夹)<br>-U  postgres                数据库超级用户名（此处为postgres，如果不设置，会用当前windows用户名为账号）<br>-A  password              数据库使用密码授权<br>-E  utf8                       数据库编码格式<br>–locale&#x3D;C                  数据库簇使用的本地化语言<br>-W                              命令行执行后 输入密码</p>          </div><p>执行命令过后输入密码，应该要输入两遍，输入一个自己记得住的密码，其他的从参数输入 <code>initdb --help</code>查看</p><h3 id="启动数据库"><a href="#启动数据库" class="headerlink" title="启动数据库"></a>启动数据库</h3><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">bin<span class="token punctuation">\</span>pg_ctl -D data start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><p>然后使用数据库连接软件连接查看即可。</p><h3 id="注册到服务"><a href="#注册到服务" class="headerlink" title="注册到服务"></a>注册到服务</h3><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">bin<span class="token punctuation">\</span>pg_ctl register -N <span class="token string">"pgsql"</span> -D xxxx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><p>注意：</p><div class="note note-info">            <p>-D后面填写你新建的那个data文件夹的绝对路径</p>          </div><p>运行过后即可使用 <code>net start pgsql</code> 命令来启动数据库服务，也可以设置成开机自启。停止运行的命令<code>net stop pgsql</code>，执行net命令失败的话请使用管理员身份操作CMD</p><h2 id="后话"><a href="#后话" class="headerlink" title="后话"></a>后话</h2><p>为什么要使用压缩包的安装方式？主要数据库这东西大多数都是在服务器上运行的，而现在小公司linux服务用的居多，多是没有操作界面的，使用压缩包的安装方式主要不挑系统。就是这个原因。话说有几个同学知道Linux解压文件的命令是什么。哈哈哈😆😆😆😆</p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gzwgk3spe5j32yo1o04qq.jpg" alt="冬天雪风景"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>数据库</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>springboot项目记录http请求记录</title>
    <link href="/2022/02/18/java-09/"/>
    <url>/2022/02/18/java-09/</url>
    
    <content type="html"><![CDATA[<p>代码来咯，看代码多是一件美事呦，你他奶奶的为什么不看代码，给我看。</p><p>工作的时候，尤其是接口联调的时候，打印http请求记录是甩锅和解决问题的最好的方式。尤其是请求体里的内容。就是这个获取请求体的内容其实还有点门道，我就被坑过，你直接在拦截器里直接获取request里面的body，拦截器里能获取到，Controller里面就获取不到了。具体原因不深究，就是Body是用流传的，你读取了之后这个流就被消耗了，然后后面的代码再从request里面就读取不到了。</p><h2 id="引入spring-boot-starter-actuator"><a href="#引入spring-boot-starter-actuator" class="headerlink" title="引入spring-boot-starter-actuator"></a>引入<code>spring-boot-starter-actuator</code></h2><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- 依赖 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>引入之后，配置存储方式<code>httpTraceRepository</code>，这个实例就是添加在内存中存储最近100次请求记录</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigTrace</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">HttpTraceRepository</span> <span class="token function">httpTraceRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryHttpTraceRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>最后在application.properties中加入</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">management.endpoints.web.exposure.include<span class="token operator">=</span>*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><p>运行项目访问<code>http://localhost:8080/actuator/httptrace</code></p><p>得到这样的JSON数据（已经格式化），</p><figure><div class="code-wrapper"><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"traces"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">&#123;</span>      <span class="token property">"timestamp"</span><span class="token operator">:</span> <span class="token string">"2022-02-19T05:08:05.370267100Z"</span><span class="token punctuation">,</span>      <span class="token property">"principal"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>      <span class="token property">"session"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>      <span class="token property">"request"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token property">"method"</span><span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span>        <span class="token property">"uri"</span><span class="token operator">:</span> <span class="token string">"http://localhost:8080/index?a=%E4%BB%8E%E5%89%8D%E4%BB%8E%E5%89%8D&amp;b=%E6%9C%89%E4%B8%AA%E4%BA%BA%E7%88%B1%E4%BD%A0%E5%BE%88%E4%B9%85"</span><span class="token punctuation">,</span>        <span class="token property">"headers"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token property">"host"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token string">"localhost:8080"</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token property">"content-type"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token string">"application/x-www-form-urlencoded"</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token property">"connection"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token string">"Keep-Alive"</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token property">"accept-encoding"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token string">"gzip,deflate"</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token property">"user-agent"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token string">"Apache-HttpClient/4.5.13 (Java/11.0.12)"</span>          <span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"remoteAddress"</span><span class="token operator">:</span> <span class="token null keyword">null</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token property">"response"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token property">"status"</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>        <span class="token property">"headers"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token property">"Keep-Alive"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token string">"timeout=60"</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token property">"Connection"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token string">"keep-alive"</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token property">"Content-Length"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token string">"35"</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token property">"Date"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token string">"Sat, 19 Feb 2022 05:08:05 GMT"</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token property">"Content-Type"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token string">"text/plain;charset=UTF-8"</span>          <span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token property">"timeTaken"</span><span class="token operator">:</span> <span class="token number">120</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>引入这个依赖的好处，就是几乎不需要写任何代码，引入，然后配置一下即可查看，缺点也有就是不能记录post请求的请求体，也无法记录返回值，持久化，目前我没有研究，但是我感觉可以。可以自行查阅资料研究。</p><h2 id="使用springmvc自带的一个类"><a href="#使用springmvc自带的一个类" class="headerlink" title="使用springmvc自带的一个类"></a>使用springmvc自带的一个类</h2><p>增加一个配置类</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Bean</span>    <span class="token class-name">CommonsRequestLoggingFilter</span> <span class="token function">loggingFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">CommonsRequestLoggingFilter</span> loggingFilter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CommonsRequestLoggingFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 记录 客户端 IP信息</span>        loggingFilter<span class="token punctuation">.</span><span class="token function">setIncludeClientInfo</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 记录请求头</span>        loggingFilter<span class="token punctuation">.</span><span class="token function">setIncludeHeaders</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 如果记录请求头的话，可以指定哪些记录，哪些不记录</span>        <span class="token comment">// loggingFilter.setHeaderPredicate();</span>        <span class="token comment">// 记录 请求体  特别是POST请求的body参数</span>        loggingFilter<span class="token punctuation">.</span><span class="token function">setIncludePayload</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 请求体的大小限制 默认50</span>        loggingFilter<span class="token punctuation">.</span><span class="token function">setMaxPayloadLength</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//记录请求路径中的query参数</span>        loggingFilter<span class="token punctuation">.</span><span class="token function">setIncludeQueryString</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> loggingFilter<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p><code>CommonsRequestLoggingFilter</code>可以点进去看一下，就是一个springboot提供得一个类。可以自己进行改造。接下来再配置一下logback就行。配置如下。看不懂或者不理解看这个<a href="https://wangijun.com/2022/01/05/java-07/">logback配置详情</a></p><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--        输出日志到控制台    --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>soutAppender<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.PatternLayout<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%date %level [%thread] %logger&#123;10&#125;.%class&#123;0&#125;#%method[%file:%line] %n%msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--        输出日志到文件     --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fileAppender<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>append</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>append</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prudent</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prudent</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>File</span><span class="token punctuation">></span></span>logs/log.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>File</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>logs/%d&#123;yyyy-MM-dd&#125;/log%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token comment">&lt;!-- 单个日志文件最大体积 --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>10MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.encoder.PatternLayoutEncoder<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!-- 对日志进行格式化 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%date %level [%thread] %logger&#123;10&#125;.%class&#123;0&#125;#%method[%file:%line] %n%msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">></span></span>utf-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- 这个是重点 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.web.filter.CommonsRequestLoggingFilter<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>debug<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logger</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>soutAppender<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fileAppender<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>配置好打印的日志应该是这样</p><figure><div class="code-wrapper"><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token number">2022</span><span class="token number">-02</span><span class="token number">-19</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">02</span><span class="token operator">:</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">608</span> DEBUG <span class="token punctuation">[</span>http-nio<span class="token number">-8080</span>-exec<span class="token number">-1</span><span class="token punctuation">]</span> o.s.w.f.CommonsRequestLoggingFilter.CommonsRequestLoggingFilter#beforeRequest<span class="token punctuation">[</span>CommonsRequestLoggingFilter.java<span class="token operator">:</span><span class="token number">47</span><span class="token punctuation">]</span> Before request <span class="token punctuation">[</span>GET /index?a=%E4%BB%8E%E5%<span class="token number">89</span>%8D%E4%BB%8E%E5%<span class="token number">89</span>%8D&amp;b=%E6%9C%<span class="token number">89</span>%E4%B8%AA%E4%BA%BA%E7%<span class="token number">88</span>%B1%E4%BD%A0%E5%BE%<span class="token number">88</span>%E4%B9%<span class="token number">85</span><span class="token punctuation">,</span> client=<span class="token number">127.0</span>.<span class="token number">0.1</span><span class="token punctuation">,</span> headers=<span class="token punctuation">[</span>host<span class="token operator">:</span><span class="token string">"localhost:8080"</span><span class="token punctuation">,</span> connection<span class="token operator">:</span><span class="token string">"Keep-Alive"</span><span class="token punctuation">,</span> user-agent<span class="token operator">:</span><span class="token string">"Apache-HttpClient/4.5.13 (Java/11.0.12)"</span><span class="token punctuation">,</span> accept-encoding<span class="token operator">:</span><span class="token string">"gzip,deflate"</span><span class="token punctuation">,</span> Content-Type<span class="token operator">:</span><span class="token string">"application/x-www-form-urlencoded;charset=UTF-8"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token number">2022</span><span class="token number">-02</span><span class="token number">-19</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">02</span><span class="token operator">:</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">668</span> DEBUG <span class="token punctuation">[</span>http-nio<span class="token number">-8080</span>-exec<span class="token number">-1</span><span class="token punctuation">]</span> o.s.w.f.CommonsRequestLoggingFilter.CommonsRequestLoggingFilter#afterRequest<span class="token punctuation">[</span>CommonsRequestLoggingFilter.java<span class="token operator">:</span><span class="token number">55</span><span class="token punctuation">]</span> After request <span class="token punctuation">[</span>GET /index?a=%E4%BB%8E%E5%<span class="token number">89</span>%8D%E4%BB%8E%E5%<span class="token number">89</span>%8D&amp;b=%E6%9C%<span class="token number">89</span>%E4%B8%AA%E4%BA%BA%E7%<span class="token number">88</span>%B1%E4%BD%A0%E5%BE%<span class="token number">88</span>%E4%B9%<span class="token number">85</span><span class="token punctuation">,</span> client=<span class="token number">127.0</span>.<span class="token number">0.1</span><span class="token punctuation">,</span> headers=<span class="token punctuation">[</span>host<span class="token operator">:</span><span class="token string">"localhost:8080"</span><span class="token punctuation">,</span> connection<span class="token operator">:</span><span class="token string">"Keep-Alive"</span><span class="token punctuation">,</span> user-agent<span class="token operator">:</span><span class="token string">"Apache-HttpClient/4.5.13 (Java/11.0.12)"</span><span class="token punctuation">,</span> accept-encoding<span class="token operator">:</span><span class="token string">"gzip,deflate"</span><span class="token punctuation">,</span> Content-Type<span class="token operator">:</span><span class="token string">"application/x-www-form-urlencoded;charset=UTF-8"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token number">2022</span><span class="token number">-02</span><span class="token number">-19</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">02</span><span class="token operator">:</span><span class="token number">39</span><span class="token punctuation">,</span><span class="token number">737</span> DEBUG <span class="token punctuation">[</span>http-nio<span class="token number">-8080</span>-exec<span class="token number">-3</span><span class="token punctuation">]</span> o.s.w.f.CommonsRequestLoggingFilter.CommonsRequestLoggingFilter#beforeRequest<span class="token punctuation">[</span>CommonsRequestLoggingFilter.java<span class="token operator">:</span><span class="token number">47</span><span class="token punctuation">]</span> Before request <span class="token punctuation">[</span>POST /save<span class="token punctuation">,</span> client=<span class="token number">127.0</span>.<span class="token number">0.1</span><span class="token punctuation">,</span> headers=<span class="token punctuation">[</span>content-length<span class="token operator">:</span><span class="token string">"14"</span><span class="token punctuation">,</span> host<span class="token operator">:</span><span class="token string">"localhost:8080"</span><span class="token punctuation">,</span> connection<span class="token operator">:</span><span class="token string">"Keep-Alive"</span><span class="token punctuation">,</span> user-agent<span class="token operator">:</span><span class="token string">"Apache-HttpClient/4.5.13 (Java/11.0.12)"</span><span class="token punctuation">,</span> accept-encoding<span class="token operator">:</span><span class="token string">"gzip,deflate"</span><span class="token punctuation">,</span> Content-Type<span class="token operator">:</span><span class="token string">"application/x-www-form-urlencoded;charset=UTF-8"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token number">2022</span><span class="token number">-02</span><span class="token number">-19</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">02</span><span class="token operator">:</span><span class="token number">39</span><span class="token punctuation">,</span><span class="token number">743</span> DEBUG <span class="token punctuation">[</span>http-nio<span class="token number">-8080</span>-exec<span class="token number">-3</span><span class="token punctuation">]</span> o.s.w.f.CommonsRequestLoggingFilter.CommonsRequestLoggingFilter#afterRequest<span class="token punctuation">[</span>CommonsRequestLoggingFilter.java<span class="token operator">:</span><span class="token number">55</span><span class="token punctuation">]</span> After request <span class="token punctuation">[</span>POST /save<span class="token punctuation">,</span> client=<span class="token number">127.0</span>.<span class="token number">0.1</span><span class="token punctuation">,</span> headers=<span class="token punctuation">[</span>content-length<span class="token operator">:</span><span class="token string">"14"</span><span class="token punctuation">,</span> host<span class="token operator">:</span><span class="token string">"localhost:8080"</span><span class="token punctuation">,</span> connection<span class="token operator">:</span><span class="token string">"Keep-Alive"</span><span class="token punctuation">,</span> user-agent<span class="token operator">:</span><span class="token string">"Apache-HttpClient/4.5.13 (Java/11.0.12)"</span><span class="token punctuation">,</span> accept-encoding<span class="token operator">:</span><span class="token string">"gzip,deflate"</span><span class="token punctuation">,</span> Content-Type<span class="token operator">:</span><span class="token string">"application/x-www-form-urlencoded;charset=UTF-8"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> payload=a=%E4%BD%A0%E5%A5%BD%E4%B8%<span class="token number">96</span>%E7%<span class="token number">95</span>%8C<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>payload中得东西为请求体。一次请求会打印两条日志，Before request为过滤器前，After request为过滤器后的记录，这种方式其实已经挺好用了。但是还有个问题就是不能记录返回值，也有方法。</p><h2 id="记录返回值"><a href="#记录返回值" class="headerlink" title="记录返回值"></a>记录返回值</h2><p>继承<code>ResponseBodyAdvice</code>和使用<code>RestControllerAdvice</code>注解来实现。</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@RestControllerAdvice</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RestBodyAdvice</span> <span class="token keyword">implements</span> <span class="token class-name">ResponseBodyAdvice</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> DEFAULT_MAX_PAYLOAD_LENGTH <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> REQUEST_MESSAGE_PREFIX <span class="token operator">=</span> <span class="token string">"Request ["</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> REQUEST_MESSAGE_SUFFIX <span class="token operator">=</span> <span class="token string">"]"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ObjectMapper</span> objectMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 顶级异常     * 异常的信息也能捕获到     */</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">handlerException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">,</span>                                              <span class="token class-name">HttpServletRequest</span> rq<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> rp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"顶级异常: &#123;&#125;"</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">"系统错误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">supports</span><span class="token punctuation">(</span><span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span><span class="token punctuation">></span></span> converterType<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@SneakyThrows</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">beforeBodyWrite</span><span class="token punctuation">(</span><span class="token class-name">Object</span> body<span class="token punctuation">,</span>                                  <span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span>                                  <span class="token class-name">MediaType</span> selectedContentType<span class="token punctuation">,</span>                                  <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span><span class="token punctuation">></span></span> selectedConverterType<span class="token punctuation">,</span>                                  <span class="token class-name">ServerHttpRequest</span> request<span class="token punctuation">,</span>                                  <span class="token class-name">ServerHttpResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ServletServerHttpRequest</span> servletServerHttpRequest <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ServletServerHttpRequest</span><span class="token punctuation">)</span> request<span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token function">createRequestMessage</span><span class="token punctuation">(</span>servletServerHttpRequest<span class="token punctuation">.</span><span class="token function">getServletRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> REQUEST_MESSAGE_PREFIX<span class="token punctuation">,</span> REQUEST_MESSAGE_SUFFIX<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 这里注意一下，如果body已经是JOSN数据了在进行转JSON处理会报错。</span>        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"Response Body ["</span><span class="token operator">+</span> objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> body<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">checkPrimitive</span><span class="token punctuation">(</span><span class="token class-name">Object</span> body<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> clazz <span class="token operator">=</span> body<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> clazz<span class="token punctuation">.</span><span class="token function">isPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token operator">||</span> clazz<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token operator">||</span> <span class="token class-name">Collection</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span>                <span class="token operator">||</span> body <span class="token keyword">instanceof</span> <span class="token class-name">Number</span>                <span class="token operator">||</span> body <span class="token keyword">instanceof</span> <span class="token class-name">Boolean</span>                <span class="token operator">||</span> body <span class="token keyword">instanceof</span> <span class="token class-name">Character</span>                <span class="token operator">||</span> body <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">protected</span> <span class="token class-name">String</span> <span class="token function">createRequestMessage</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">String</span> prefix<span class="token punctuation">,</span> <span class="token class-name">String</span> suffix<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">StringBuilder</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        msg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token punctuation">;</span>        msg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        msg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> queryString <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getQueryString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>queryString <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            msg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token char">'?'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>queryString<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">String</span> client <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getRemoteAddr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            msg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">", client="</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>session <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            msg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">", session="</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">String</span> user <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getRemoteUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            msg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">", user="</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">HttpHeaders</span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletServerHttpRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        msg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">", headers="</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>headers<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> payload <span class="token operator">=</span> <span class="token function">getMessagePayload</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>payload <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            msg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">", payload="</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        msg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>suffix<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> msg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">protected</span> <span class="token class-name">String</span> <span class="token function">getMessagePayload</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ContentCachingRequestWrapper</span> wrapper <span class="token operator">=</span>                <span class="token class-name">WebUtils</span><span class="token punctuation">.</span><span class="token function">getNativeRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">ContentCachingRequestWrapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>wrapper <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">getContentAsByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>buf<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">int</span> length <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span>length<span class="token punctuation">,</span> DEFAULT_MAX_PAYLOAD_LENGTH<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> length<span class="token punctuation">,</span> wrapper<span class="token punctuation">.</span><span class="token function">getCharacterEncoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnsupportedEncodingException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">return</span> <span class="token string">"[unknown]"</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>然后再配置logback</p><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.springboothttptrace.RestBodyAdvice<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>debug<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logger</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div></figure><p>配置一下，输出的日志为</p><figure><div class="code-wrapper"><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token number">2022</span><span class="token number">-02</span><span class="token number">-21</span> <span class="token number">10</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">29</span><span class="token punctuation">,</span><span class="token number">880</span> DEBUG <span class="token punctuation">[</span>http-nio<span class="token number">-8080</span>-exec<span class="token number">-3</span><span class="token punctuation">]</span> c.e.s.RestBodyAdvice.RestBodyAdvice#beforeBodyWrite<span class="token punctuation">[</span>RestBodyAdvice.java<span class="token operator">:</span><span class="token number">64</span><span class="token punctuation">]</span> Request <span class="token punctuation">[</span>POST /save<span class="token punctuation">,</span> client=<span class="token number">127.0</span>.<span class="token number">0.1</span><span class="token punctuation">,</span> headers=<span class="token punctuation">[</span>content-length<span class="token operator">:</span><span class="token string">"14"</span><span class="token punctuation">,</span> host<span class="token operator">:</span><span class="token string">"localhost:8080"</span><span class="token punctuation">,</span> connection<span class="token operator">:</span><span class="token string">"Keep-Alive"</span><span class="token punctuation">,</span> user-agent<span class="token operator">:</span><span class="token string">"Apache-HttpClient/4.5.13 (Java/11.0.12)"</span><span class="token punctuation">,</span> accept-encoding<span class="token operator">:</span><span class="token string">"gzip,deflate"</span><span class="token punctuation">,</span> Content-Type<span class="token operator">:</span><span class="token string">"application/x-www-form-urlencoded;charset=UTF-8"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> payload=a=%E4%BD%A0%E5%A5%BD%E4%B8%<span class="token number">96</span>%E7%<span class="token number">95</span>%8C<span class="token punctuation">]</span><span class="token number">2022</span><span class="token number">-02</span><span class="token number">-21</span> <span class="token number">10</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">29</span><span class="token punctuation">,</span><span class="token number">880</span> DEBUG <span class="token punctuation">[</span>http-nio<span class="token number">-8080</span>-exec<span class="token number">-3</span><span class="token punctuation">]</span> c.e.s.RestBodyAdvice.RestBodyAdvice#beforeBodyWrite<span class="token punctuation">[</span>RestBodyAdvice.java<span class="token operator">:</span><span class="token number">66</span><span class="token punctuation">]</span> Response Body <span class="token punctuation">[</span><span class="token string">"你好世界"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>至此，http的请求记录就全部记录到了，payload中为请求体，请求体和返回内容。自己可以按需使用，开发过程中建议打印全部日志，方便调试，上线后，可以不打印。去掉也很方便，直接在logback配置中配置一下就可以了。</p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gzkx54or65j32yo1o01ky.jpg" alt="坐在树上的美女宋仁何 绿色裙子 美腿 护眼森系"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>springboot</tag>
      
      <tag>httptrace</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>代码如诗</title>
    <link href="/2022/01/26/gossip-06/"/>
    <url>/2022/01/26/gossip-06/</url>
    
    <content type="html"><![CDATA[<p>代码如诗，只有懂，才能了解，进而才能欣赏。没事的时候读了读Java编程思想这本书，想起自己以前对编程思想这东西不怎么在乎，狂妄且傲慢的认为只需要实现功能就可以了，但不得不说，确实能实现功能，但如果你一直是这种心态，你写不出什么多大的项目，或者说，没有办法养成架构的思想。只能解决解决边角料问题，当然，解决边角料问题，也是有工资的，也是能吃饭的，但就感觉差了那么一点点。</p><p>阅读代码是一个好习惯，怎么写出好文章，多读书嘛，代码也是这个道理嘛，多看，多想嘛，看看优秀框架如何保证代码自由的情况下尽可能的方便使用，同时又兼顾着代码规范。</p><p>阅读文档同阅读代码，是一个非常好的编码习惯。很多人就是不看文档，尤大的经典言论，就是不看文档，很多功能，或者完成需求的方式文档里面是有介绍的，阅读文档和代码实际上是一种代码储备。</p><p>越接触底层，能解决的问题就越多。大道至简。在享受springboot带来的便利时，一个多数据源的需求实现起来却变的十分麻烦了起来，而原始的JDBC，压根就不需要多数据源这个概念，JDBC中一个DataSource就是一个数据源，我也并不是提倡使用原始的东西，因为效率确实比较低，我需要了解这个概念，多数据源，本质上就是创建多个DataSource。再说回spring，概念在提一嘴，实现了AOP的一个轻量化Bean容器。AOP就是各种框架的灵魂，AOP依靠的是什么？反射。好了，通过注解来使用多数据源的代码雏形以及在脑海里了，利用AOP的前置在方法执行前，替换DataSource，本质就是这样，具体实现仍然需要考虑很多细节，只是举一个例子，不做深究。</p><p>在聊数据源，运行时对数据源进行变动这个需求，我们应该如何完成。在不重启项目的情况下，增删或者修改数据源。我也是出于新奇，以前没了解过，数据源还能这么玩，感觉就贼好用了且强大了，虽然实际中可能用到的机会不多，但这东西怎么说呢，虽说买菜用不上微积分，但是吧，我会微积分买菜是不是可以比别人硬气一点，😂😂😂</p><p>只是简单聊一聊，在为后续的博客写下一个伏笔，多数据源以及动态增删改数据源。工作中用的技术都过于底层（落后）反而帮助了我了解了很多以前没有想过的东西，说Java的网络编程，了解的人不多，可如果说Web编程，啊，那这我会，殊不知基于Servlet的Http协议只是Java网络编程的一个子分支，说白了就是一种特殊的且被大家遵守的一个Socket通信协议。</p><p>Unix系统中有一个理念，万物皆文件，你对此概念理解有几分。我是学Java入门的，面向对象的Java帮我们做了很多的事，经典的就是把万物皆文件，变成了万物皆对象。请想一想这是何等壮举。</p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gyrfsbigf3j32yo1o0kjl.jpg" alt="西域美女"></p>]]></content>
    
    
    <categories>
      
      <category>碎碎念</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>请求第三方接口的各种姿势</title>
    <link href="/2022/01/16/java-08/"/>
    <url>/2022/01/16/java-08/</url>
    
    <content type="html"><![CDATA[<p>最近写了一些请求第三方接口的需求，基于http协议的接口，实际上写起来并不麻烦，因为就三个核心要素，地址，请求方式，请求内容。地址他们给的是什么地址就是什么地址，没有变数，请求方式是写死的，复杂且容易出错的地方就是请求内容，不同的请求方式又有不同的传参方式。请求内容是JSON数据还是表单数据，等等，有时因为提供接口的开发者描述不准确，这个时候我们怎么办呢，很简单的一个一个试，基本上只需要试两到三下就能解决问题。你问人是表单数据还是JSON数据可能他们自己也说不清楚，因为这个表单数据的数据格式我也不知道官方的叫法是什么，表单数据，是我自己的理解，意义可能就是为了区分不是JSON数据，有这个问的时间，你已经试出来了。因为就这三种数据，还有一种数据是上传的文件数据，除去文件数据就两种数据。get请求只能发送表单数据，post能发送表单数据，也能发送json数据，一般post用的多。所以记住这两种传参方式就可以了。</p><p>实际操作中使用了hutool这个工具类，当然你也可以用大家更为熟知一点的okhttp这个http工具，萝卜青菜都能写，只不过我感觉hutool提供的工具代码比较简洁也便于理解。</p><p>依赖</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">implementation<span class="token punctuation">(</span><span class="token string">'cn.hutool:hutool-all:5.7.19'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><p>实际操作代码</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 发起get请求，并获取返回内容</span><span class="token class-name">String</span> body <span class="token operator">=</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span> <span class="token comment">// 请求方式，以及url</span>        <span class="token punctuation">.</span><span class="token function">form</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"小红"</span><span class="token punctuation">)</span><span class="token comment">// 参数，重复调用即可</span>        <span class="token punctuation">.</span><span class="token function">form</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token string">"24"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取body内容</span><span class="token comment">// 发起post请求发送表单数据，并获取返回数据</span><span class="token class-name">String</span> body1 <span class="token operator">=</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"utl"</span><span class="token punctuation">)</span> <span class="token comment">// post请求</span>        <span class="token punctuation">.</span><span class="token function">form</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"小红"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">form</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token string">"24"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 发送post请求并发送JSON数据，并获取返回信息</span><span class="token class-name">String</span> body2 <span class="token operator">=</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token class-name">JSONUtil</span>                <span class="token punctuation">.</span><span class="token function">createObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"小红"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span><span class="token string">"24"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>如果确认传递的参数没有问题，一个一个试基本就能解决问题。如果还有特殊的需求，阅读源码，建议直接看源码，注释都是中文的，使用起来基本没有任何障碍。<a href="https://www.hutool.cn/docs/#/http/Http%E8%AF%B7%E6%B1%82-HttpRequest">官网文档地址</a></p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gyfnlrsvuyj32yo1o0kjl.jpg" alt="海琴烟 同人"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>http</tag>
      
      <tag>hu-tool</tag>
      
      <tag>api</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>关于Java程序的日志处理</title>
    <link href="/2022/01/05/java-07/"/>
    <url>/2022/01/05/java-07/</url>
    
    <content type="html"><![CDATA[<p>日志记录这块，简单的控制台打印也是日志，输出log文件也是日志，跨服务器输出日志，也是日志。这还没说复杂的日志监控，日志监控，需要对代码打印日志的标准有要求。这个就比较复杂了，</p><p>首先我们要知道，日志是有级别的，log4j,我记得好像有7个级别，slf4j，有五个级别。首先我们得知道log4j和slf4j是什么东西，为啥把这两个放在一起说。题外话说一下命名，这个4j应该不少人有疑问，因为这东西不符合Java的驼峰命名规则啊，为啥要起这个名呢，好吧，其实就是For Java的音译加缩写。据说是传统，比如什么dom4j等等。这个级别是用来控制日志输出内容的，你设置的级别越高，打印的日志就越少，你配置级别最低，则打印全部级别的日志。准确来说是包含关系，就像一个金字塔结构一样。</p><p>还有Log4j和Slf4j这两个并不负责输出日志，准确的说这两个是Java日志的门面，又或者是标准，门面是什么意思，就是服务员，你去吃饭，只需要和服务员说，我要一碗蛋炒饭。至于服务员去找哪个厨师帮你做，你不用管，这两个东西也是一样，你和slf4j说，我要打印日志，slf4j得去找实现给你打印日志，但是只有slf4j是没有办法给你打印日志的。这个时候你就需要去找一个厨师，就是实现。logback是直接实现了slf4j的一个日志实现。好了。应该说明白了。</p><p>实际上<a href="https://logback.qos.ch/">logback官网</a>上是有十分详细的介绍，尬就尬在，是英文文档。</p><h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><p>普通的Java项目</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">implementation <span class="token string">'ch.qos.logback:logback-classic:1.2.10'</span>implementation <span class="token string">'ch.qos.logback:logback-core:1.2.10'</span>implementation <span class="token string">'org.slf4j:slf4j-api:1.7.32'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div></figure><p>springboot中无需此依赖，默认的日志就是lagback。</p><h2 id="配置文件介绍"><a href="#配置文件介绍" class="headerlink" title="配置文件介绍"></a>配置文件介绍</h2><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token comment">&lt;!--    configuration节点有三个属性    scan:当此属性设置为true时，配置文件如果发生改变，将会被重新加载，默认值为true    scanPeriod:设置监测配置文件是否有修改的时间间隔，如果没有给出时间单位默认单位是毫秒，当scan为true时此属性生效，默认时间间隔为1分钟    debug:当此属性设置为true时，将打印出logback内部日志信息，实时查看logback运行状态，默认值为false --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span> <span class="token attr-name">scan</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">scanPeriod</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2 seconds<span class="token punctuation">"</span></span> <span class="token attr-name">debug</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--         设置上下文名称，每个&lt;logger>都关联到&lt;logger>上下文，默认上下文名称为default,但可以使用设置成其他名字，用于区分不同应用程序的记录,一旦设置，不能修改,可以通过 %contextName 来打印日志上下文名称，一般来说我们不用这个属性，可有可无。     --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>contextName</span><span class="token punctuation">></span></span>demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>contextName</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!--         用来定义变量的节点，定义变量后，可以使$&#123;&#125;来使用变量,两个属性        这个属性只有在springboot环境中使用才可以，且配置文件名要为logback-spring.xml才可正常使用。        name: 和下文中的name一样        scope：一般就填context就行了，具体配置可查看官网        source: 读取application.yml或application.properties文件中的配置，     --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProperty</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>context<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app_name<span class="token punctuation">"</span></span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logging.file.name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment">&lt;!--         用来定义变量的节点，定义变量后，可以使$&#123;&#125;来使用变量,两个属性,当定义了多个&lt;appender>的时候还是很有用的：        name：变量名        value：变量值     --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>log.dir<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>logs<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment">&lt;!--    定义滚动记录文件appender 作用:滚动记录文件,先将日志记录到指定文件,当符合某个条件时,将日志记录到其他文件    RollingFileAppender class="ch.qos.logback.core.rolling.RollingFileAppender"        参数：        &lt;append>:如果是true日志被追加到文件结尾，如果是false清空现存文件,默认是true        &lt;fileNamePattern>:被写入的文件名，可以是相对目录也可以是绝对目录，如果上级目录不存在会自动创建，没有默认值        &lt;rollingPolicy>:当发生滚动时，决定RollingFileAppender的行为，涉及文件移动和重命名        &lt;triggeringPolicy>:告知RollingFileAppender合适激活滚动        &lt;prudent>:当为true时不支持FixedWindowRollingPolicy支持TimeBasedRollingPolicy，但是有两个限制:1不支持也不允许文件压缩,2不能设置file属性必须留空    --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fileAppender<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- 如果是true,日志被追加到文件结尾，如果是false,清空现存文件.默认是true --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>append</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>append</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prudent</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prudent</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!-- 每天滚动一次的日志 只保留30天内的日志文件 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>logs/%d&#123;yyyy-MM-dd&#125;/info%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>10MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.encoder.PatternLayoutEncoder<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!-- 对日志进行格式化 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%date %level [%thread] %logger&#123;10&#125;.%class&#123;0&#125;#%method[%file:%line] %n%msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">></span></span>utf-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>errorAppender<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prudent</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prudent</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!--日志名称，如果没有File 属性，那么只会使用FileNamePattern的文件路径规则            如果同时有&lt;File>和&lt;FileNamePattern>，那么当天日志是&lt;File>，明天会自动把今天            的日志改名为今天的日期。即，&lt;File> 的日志都是当天的。        --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>File</span><span class="token punctuation">></span></span>logs/error.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>File</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>append</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>append</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!--             当为true时不支持FixedWindowRollingPolicy支持TimeBasedRollingPolicy，但是有两个限制:1不支持也不允许文件压缩,2不能设置file属性必须留空         --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prudent</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prudent</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>logs/%d&#123;yyyy-MM-dd&#125;/error%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>10MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%date %level [%thread] %logger&#123;10&#125;.%class&#123;0&#125;#%method[%file:%line] %n%msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">></span></span>utf-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!--             配置日志级别过滤器 作用:根据日志级别进行过滤，如果日志级别等于配置级别过滤器会根据onMath和onMismatch接收或拒绝日志             参数:             &lt;level>:设置过滤级别             &lt;onMatch>:用于配置符合过滤条件的操作             &lt;onMismatch>:用于配置不符合过滤条件的操作                                       此处配置为只接收ERROR日志级别信息         --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">></span></span>ERROR<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">></span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">></span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- 定义控制台appender 作用:把日志输出到控制台 class="ch.qos.logback.core.ConsoleAppender" --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>console<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.PatternLayout<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%date %level [%thread] %logger&#123;10&#125;.%class&#123;0&#125;#%method[%file:%line] %n%msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--       logger用来设置某一个包的日志打印级别       &lt;loger> 仅有一个name属性,一个可选的level和一个可选的addtivity属性               name:用来指定受此loger约束的某一个包或者具体的某一个类               level:用来设置打印级别,大小写无关:TRACE, DEBUG, INFO, WARN, ERROR, ALL 和 OFF               addtivity:是否向上级loger传递打印信息。默认是true,会将信息输入到root配置指定的地方,可以包含多个appender-ref，标识这个appender会添加到这个logger   --></span>    <span class="token comment">&lt;!--    &lt;logger name="com.xcbeyond.springboot" level="debug"/>--></span>    <span class="token comment">&lt;!-- 将root的打印级别设置为"error",指定了名字为"console","fileAppender","errorAppender"的appender --></span>    <span class="token comment">&lt;!--         springProfile标签用来处理开发环境和生产环境的不同配置        name: 读取spring.profiles.active的值        profile即根据不同的环境使用不同的日志策略，这里举例开发和生产环境：     --></span>     <span class="token comment">&lt;!-- 开发环境输出到控制台 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span>  <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dev<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>DEBUG<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>STDOUT<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- 生产环境输出到文件 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span>  <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>prod<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INFO<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>FILE_LOG<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>debug<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>console<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fileAppender<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>errorAppender<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>应该是介绍的比较详细了，因为这东西平时很少有人去专门去记一下，我也是弄好一套，然后CV一下就可以了，<strong>注意上面的配置只是用来演示的，并不能直接CV下来用。下面我配置几种常用的配置，可以直接CV下来用的。</strong></p><h2 id="全部日志一个文件"><a href="#全部日志一个文件" class="headerlink" title="全部日志一个文件"></a>全部日志一个文件</h2><div class="note note-info">            <p>控制台打印日志，并输出日志文件。</p>          </div><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--         输出日志到控制台    --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>soutAppender<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.PatternLayout<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%date %level [%thread] %logger&#123;10&#125;.%class&#123;0&#125;#%method[%file:%line] %n%msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--         输出日志到文件     --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fileAppender<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>append</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>append</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prudent</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prudent</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>File</span><span class="token punctuation">></span></span>logs/log.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>File</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>logs/%d&#123;yyyy-MM-dd&#125;/log%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token comment">&lt;!-- 单个日志文件最大体积 --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>10MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.encoder.PatternLayoutEncoder<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!-- 对日志进行格式化 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%date %level [%thread] %logger&#123;10&#125;.%class&#123;0&#125;#%method[%file:%line] %n%msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">></span></span>utf-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>all<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>soutAppender<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fileAppender<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="不同级别不同文件"><a href="#不同级别不同文件" class="headerlink" title="不同级别不同文件"></a>不同级别不同文件</h2><div class="note note-info">            <p>控制台打印太基础我就不说了，加强主要针对log文件，这个配置我们按日志级别输出对应级别的日志。方便我们定位和查找。一般来说，我们只需要info和error级别的日志即可。</p>          </div><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--         输出日志到控制台    --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>soutAppender<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.PatternLayout<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%date %level [%thread] %logger&#123;10&#125;.%class&#123;0&#125;#%method[%file:%line] %n%msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--         输出日志到文件     --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>infoAppender<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- 如果是true,日志被追加到文件结尾，如果是false,清空现存文件.默认是true --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>append</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>append</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prudent</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prudent</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>File</span><span class="token punctuation">></span></span>logs/info.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>File</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>logs/%d&#123;yyyy-MM-dd&#125;/info%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token comment">&lt;!-- 单个日志文件最大体积 --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>10MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.encoder.PatternLayoutEncoder<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!-- 对日志进行格式化 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%date %level [%thread] %logger&#123;10&#125;.%class&#123;0&#125;#%method[%file:%line] %n%msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">></span></span>utf-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- 两个过滤器过滤warn和error基本的日志 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!--过滤 WARN--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">></span></span>WARN<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!--匹配到就禁止--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">></span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!--没有匹配到就允许--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">></span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!--过滤 Error--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">></span></span>ERROR<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!--匹配到就禁止--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">></span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!--没有匹配到就允许--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">></span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>errorAppender<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- 如果是true,日志被追加到文件结尾，如果是false,清空现存文件.默认是true --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>append</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>append</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prudent</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prudent</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>File</span><span class="token punctuation">></span></span>logs/error.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>File</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>logs/%d&#123;yyyy-MM-dd&#125;/error%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token comment">&lt;!-- 单个日志文件最大体积 --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>10MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.encoder.PatternLayoutEncoder<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!-- 对日志进行格式化 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%date %level [%thread] %logger&#123;10&#125;.%class&#123;0&#125;#%method[%file:%line] %n%msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">></span></span>utf-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!--             过滤日志，只包含warn以及warn以上级别的日志也就是error的日志         --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.ThresholdFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">></span></span>WARN<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>all<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>soutAppender<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>infoAppender<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>errorAppender<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>最终结果是会输出两个日志文件，<code>info.log</code>和<code>error.log</code>, info包括info级别以及以下级别的日志，<code>error.log</code>包括<code>warn</code>和<code>error</code>两个级别的日志。</p><h2 id="不同包不同日志文件"><a href="#不同包不同日志文件" class="headerlink" title="不同包不同日志文件"></a>不同包不同日志文件</h2><p>我们一般的系统基本都有几层架构，有controller层，以及service层，logback可以根据不同的包来输出日志，也可以精确到具体的某一个类名。主要使用<code>logger</code>这个标签来完成。<strong>这个没有办法CV，因为不同的项目包名不一样，根据自己的项目需要修改一下</strong>。</p><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--        输出日志到控制台    --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>soutAppender<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.PatternLayout<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%date %level [%thread] %logger&#123;10&#125;.%class&#123;0&#125;#%method[%file:%line] %n%msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--        输出日志到文件     --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>infoAppender<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- 如果是true,日志被追加到文件结尾，如果是false,清空现存文件.默认是true --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>append</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>append</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prudent</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prudent</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>File</span><span class="token punctuation">></span></span>logs/info.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>File</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>logs/%d&#123;yyyy-MM-dd&#125;/info%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token comment">&lt;!-- 单个日志文件最大体积 --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>10MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.encoder.PatternLayoutEncoder<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!-- 对日志进行格式化 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%date %level [%thread] %logger&#123;10&#125;.%class&#123;0&#125;#%method[%file:%line] %n%msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">></span></span>utf-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!--过滤 WARN--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">></span></span>WARN<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!--匹配到就禁止--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">></span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!--没有匹配到就允许--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">></span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!--过滤 Error--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">></span></span>ERROR<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!--匹配到就禁止--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">></span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!--没有匹配到就允许--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">></span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>errorAppender<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- 如果是true,日志被追加到文件结尾，如果是false,清空现存文件.默认是true --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>append</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>append</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prudent</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prudent</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>File</span><span class="token punctuation">></span></span>logs/error.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>File</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>logs/%d&#123;yyyy-MM-dd&#125;/error%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token comment">&lt;!-- 单个日志文件最大体积 --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>10MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.encoder.PatternLayoutEncoder<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!-- 对日志进行格式化 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%date %level [%thread] %logger&#123;10&#125;.%class&#123;0&#125;#%method[%file:%line] %n%msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">></span></span>utf-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.ThresholdFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">></span></span>WARN<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wlfAppender<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- 如果是true,日志被追加到文件结尾，如果是false,清空现存文件.默认是true --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>append</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>append</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prudent</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prudent</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>File</span><span class="token punctuation">></span></span>logs/wlf/wlf.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>File</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">></span></span>logs/wlf/%d&#123;yyyy-MM-dd&#125;/wlf%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">></span></span>30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token comment">&lt;!-- 单个日志文件最大体积 --></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">></span></span>10MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.encoder.PatternLayoutEncoder<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token comment">&lt;!-- 对日志进行格式化 --></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>%date %level [%thread] %logger&#123;10&#125;.%class&#123;0&#125;#%method[%file:%line] %n%msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">></span></span>utf-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--         这个配置表示把com.wlf包下的日志以wlfAppender的配置进行打印日志        level： 代表日志级别，不配置默认为all    --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.wlf<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>debug<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wlfAppender<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logger</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>all<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>soutAppender<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>infoAppender<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>errorAppender<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>这个不怎么常用，只需要知道就行了，一般只使用第二个配置就行了，直接CV就行。至于和springboot中使用，可以整，但是没啥必要。具体的配置还是多看看介绍，多多学习。或者直接CV。😁😁</p><h2 id="尾"><a href="#尾" class="headerlink" title="尾"></a>尾</h2><p>主要内容到这里就介绍完了，logback的配置十分的灵活，但想要灵活的使用，还是需要多多的了解。当然打印日志归打印日志，如果你写代码打日志时不按照标准输出，再牛逼的配置也救不了。打印日志也需要规范一点。开发使用debug，需要留存的日志信息用info，异常信息用error。</p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gy6gxzioj4j32yo1o0gv3.jpg" alt="2022新年快乐"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>log</tag>
      
      <tag>logback</tag>
      
      <tag>slf4j</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>数据校验二三事</title>
    <link href="/2021/12/25/java-06/"/>
    <url>/2021/12/25/java-06/</url>
    
    <content type="html"><![CDATA[<p>做开发的应该都写过类似的校验方法，最简单的判断null，复杂一点的字符串正则校验。单纯从逻辑上说这类代码不复杂，但是有没有一种可能假如需要一次性判断多个，再加上判断失败后的处理逻辑，还有可能需要一些特殊处理，比如正则校验，等等，三个一下，写写也还行，五个以上，如果代码按行收费的话，那能够狠狠的赚了一笔。</p><p>大家脑海里的代码可能是这样</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"by_id"</span><span class="token punctuation">)</span>    <span class="token class-name">Object</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//·····</span>            <span class="token keyword">return</span> <span class="token string">"msg: id为null"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">// ····</span>            <span class="token keyword">return</span> <span class="token string">"id,长度过长"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>这只是一个，实际开发中有些录入非常复杂的表单数据时可能有三四十个，上面我写的处理逻辑也不复杂，真实中可能有些需要使用异常提示，有些需要直接return返回信息，等等，复杂且难以维护。难以维护，到并不是不能维护，钱给的够多，维护，也还是能维护的，当然这个杠不能这样抬。🤣😂😂😂</p><p>介绍一个工具，应该说是一套工具，基于注解和反射。</p><p>看到这两个词，性能有所损耗是很正常的，比如我们开发全员Map，其实代码的运行速度来说，不慢，但是总所周知HASH(哈希)表是一种非常耗内存的数据结构，所以代码在本地跑的时候时不时的omm异常一下也是合符情理的一件事。😁😁，现在这硬件发展的环境，应该不缺内存这东西。</p><h3 id="validation是什么"><a href="#validation是什么" class="headerlink" title="validation是什么"></a>validation是什么</h3><p>框架名字叫javax.validation，它提供了一系列的注解来进行对JavaBean的参数校验。通常用来处理Controller里面方法的参数的校验。就是暴露出去的API，内部的方法也可以用，但没必要，暴露出去的接口获取的数据是不可控的，所以才需要校验，内部的数据是可控的，当然内部方法可控的前提是源头的数据是可控的。</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>springboot中有些博客中写的是这个依赖默认包含在starter-web中了，不清楚从哪个版本开始就不包含在其中了，就说现在的环境是springboot2.5.x系列的，validation默认已经不包含在starter-web中了，需要单独引入这个依赖。</p><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--Controller参数校验--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-validation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>在其他项目中可以引入这个依赖，并自己调整版本即可使用。</p><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.hibernate.validator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>hibernate-validator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>6.0.2.Final<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="注解说明"><a href="#注解说明" class="headerlink" title="注解说明"></a>注解说明</h3><table><thead><tr><th>验证注解</th><th>验证的数据类型</th><th>说明</th></tr></thead><tbody><tr><td>@AssertFalse</td><td>Boolean,boolean</td><td>验证注解的元素值是false</td></tr><tr><td>@AssertTrue</td><td>Boolean,boolean</td><td>验证注解的元素值是true</td></tr><tr><td>@NotNull</td><td>任意类型</td><td>验证注解的元素值不是null</td></tr><tr><td>@Null</td><td>任意类型</td><td>验证注解的元素值是null</td></tr><tr><td>@Min(value&#x3D;值)</td><td>BigDecimal，BigInteger, byte,short, int, long，等任何Number或CharSequence（存储的是数字）子类型</td><td>验证注解的元素值大于等于@Min指定的value值</td></tr><tr><td>@Max（value&#x3D;值）</td><td>和@Min要求一样</td><td>验证注解的元素值小于等于@Max指定的value值</td></tr><tr><td>@DecimalMin(value&#x3D;值)</td><td>和@Min要求一样</td><td>验证注解的元素值大于等于@ DecimalMin指定的value值</td></tr><tr><td>@DecimalMax(value&#x3D;值)</td><td>和@Min要求一样</td><td>验证注解的元素值小于等于@ DecimalMax指定的value值</td></tr><tr><td>@Digits(integer&#x3D;整数位数, fraction&#x3D;小数位数)</td><td>和@Min要求一样</td><td>验证注解的元素值的整数位数和小数位数上限</td></tr><tr><td>@Size(min&#x3D;下限, max&#x3D;上限)</td><td>字符串、Collection、Map、数组等</td><td>验证注解的元素值的在min和max（包含）指定区间之内，如字符长度、集合大小</td></tr><tr><td>@Past</td><td>java.util.Date,java.util.Calendar;Joda Time类库的日期类型</td><td>验证注解的元素值（日期类型）比当前时间早</td></tr><tr><td>@Future</td><td>与@Past要求一样</td><td>验证注解的元素值（日期类型）比当前时间晚</td></tr><tr><td>@NotBlank</td><td>CharSequence子类型</td><td>验证注解的元素值不为空（不为null、去除首位空格后长度为0），不同于@NotEmpty，@NotBlank只应用于字符串且在比较时会去除字符串的首位空格</td></tr><tr><td>@Length(min&#x3D;下限, max&#x3D;上限)</td><td>CharSequence子类型</td><td>验证注解的元素值长度在min和max区间内</td></tr><tr><td>@NotEmpty</td><td>CharSequence子类型、Collection、Map、数组</td><td>验证注解的元素值不为null且不为空（字符串长度不为0、集合大小不为0）</td></tr><tr><td>@Range(min&#x3D;最小值, max&#x3D;最大值)</td><td>BigDecimal,BigInteger,CharSequence, byte, short, int, long等原子类型和包装类型</td><td>验证注解的元素值在最小值和最大值之间</td></tr><tr><td>@Email(regexp&#x3D;正则表达式,flag&#x3D;标志的模式)</td><td>CharSequence子类型（如String）</td><td>验证注解的元素值是Email，也可以通过regexp和flag指定自定义的email格式</td></tr><tr><td>@Pattern(regexp&#x3D;正则表达式,flag&#x3D;标志的模式)</td><td>String，任何CharSequence的子类型</td><td>验证注解的元素值与指定的正则表达式匹配</td></tr><tr><td>@Valid</td><td>任何非原子类型</td><td>指定递归验证关联的对象如用户对象中有个地址对象属性，如果想在验证用户对象时一起验证地址对象的话，在地址对象上加@Valid注解即可级联验证</td></tr></tbody></table><p>这里只列出Hibernate Validator提供的大部分验证约束注解，如需了解更多请参考hibernate validator官方文档了解其他验证约束注解和进行自定义的验证约束注解定义。这块内容基本就是翻译文档，没啥好说的。</p><h3 id="实际使用"><a href="#实际使用" class="headerlink" title="实际使用"></a>实际使用</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 接口是引用类型，可以使用这种方式进行参数校验。</span>    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/save/valid"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token annotation punctuation">@Validated</span> <span class="token class-name">UserDTO</span> userDTO<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        userService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>userDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"成功"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">// 如果接口接收参数是这种原子类型，需要在这个方法所在类上 `@Validated` 注解</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/get/id"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NotBlank</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        userService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>userDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"成功"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>DTO 上的注解</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDTO</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>    <span class="token comment">/*** 用户ID*/</span>    <span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"用户id不能为空"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Long</span> userId<span class="token punctuation">;</span>        <span class="token comment">/** 用户名*/</span>    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"用户名不能为空"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Length</span><span class="token punctuation">(</span>max <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"用户名不能超过20个字符"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Pattern</span><span class="token punctuation">(</span>regexp <span class="token operator">=</span> <span class="token string">"^[\\u4E00-\\u9FA5A-Za-z0-9\\*]*$"</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"用户昵称限制：最多20字符，包含文字、字母和数字"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>        <span class="token comment">/** 手机号*/</span>    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"手机号不能为空"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Pattern</span><span class="token punctuation">(</span>regexp <span class="token operator">=</span> <span class="token string">"^[1][3,4,5,6,7,8,9][0-9]&#123;9&#125;$"</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"手机号格式有误"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> mobile<span class="token punctuation">;</span>    <span class="token comment">/**性别*/</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> sex<span class="token punctuation">;</span>    <span class="token comment">/** 邮箱*/</span>    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"联系邮箱不能为空"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Email</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"邮箱格式不对"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>    <span class="token comment">/** 密码*/</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>    <span class="token comment">/*** 创建时间 */</span>    <span class="token annotation punctuation">@Future</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"时间必须是将来时间"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="全局异常处理"><a href="#全局异常处理" class="headerlink" title="全局异常处理"></a>全局异常处理</h3><p>参数校验失败时会报异常，但是把异常直接显示给用户是非常不友好的，于是需要全局处理一下异常。</p><p>默认异常信息</p><figure><div class="code-wrapper"><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"timestamp"</span><span class="token operator">:</span> <span class="token string">"2022-01-01T04:41:23.164+00:00"</span><span class="token punctuation">,</span>  <span class="token property">"status"</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>  <span class="token property">"error"</span><span class="token operator">:</span> <span class="token string">"Internal Server Error"</span><span class="token punctuation">,</span>  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>  <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"/by_id"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>全局异常拦截器</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestControllerAdvice</span><span class="token comment">// 全局异常拦截并返回JSON数据</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalExceptionHandler</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**    这个拦截异常，异常的接口级别越高就越要放在下面写，    因为这个拦截异常是匹配链的方式，如果匹配到了就不往下匹配了，    如果你第一个就写最高级别的异常，那么下面的异常匹配就匹配不到。    */</span>    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> DUPLICATE_KEY_CODE <span class="token operator">=</span> <span class="token number">1001</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> PARAM_FAIL_CODE <span class="token operator">=</span> <span class="token number">1002</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> VALIDATION_CODE <span class="token operator">=</span> <span class="token number">1003</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 处理自定义异常     */</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">BizException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token comment">// 注解里面写需要拦截的异常即可</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">handleRRException</span><span class="token punctuation">(</span><span class="token class-name">BizException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token comment">// 自己决定返回什么类型的数据</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 方法参数校验     */</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">MethodArgumentNotValidException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">handleMethodArgumentNotValidException</span><span class="token punctuation">(</span><span class="token class-name">MethodArgumentNotValidException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token comment">// 自己决定返回什么类型的数据</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * ValidationException     */</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">ValidationException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">handleValidationException</span><span class="token punctuation">(</span><span class="token class-name">ValidationException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token comment">// 自己决定返回什么类型的数据</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * ConstraintViolationException     */</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">ConstraintViolationException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">handleConstraintViolationException</span><span class="token punctuation">(</span><span class="token class-name">ConstraintViolationException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token comment">// 自己决定返回什么类型的数据</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">NoHandlerFoundException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">handlerNoFoundException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token comment">// 自己决定返回什么类型的数据</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">DuplicateKeyException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">handleDuplicateKeyException</span><span class="token punctuation">(</span><span class="token class-name">DuplicateKeyException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token comment">// 自己决定返回什么类型的数据</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">handleException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token comment">// 自己决定返回什么类型的数据</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="自定义参数注解"><a href="#自定义参数注解" class="headerlink" title="自定义参数注解"></a>自定义参数注解</h3><p>如果默认的注解不够用，你还可以自定义注解，比如一个身份证号的验证</p><h4 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h4><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Documented</span><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>PARAMETER<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>FIELD<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span><span class="token annotation punctuation">@Constraint</span><span class="token punctuation">(</span>validatedBy <span class="token operator">=</span> <span class="token class-name">IdentityCardNumberValidator</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">IdentityCardNumber</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">"身份证号码不合法"</span><span class="token punctuation">;</span>    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">groups</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Payload</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h4 id="自定义Validator"><a href="#自定义Validator" class="headerlink" title="自定义Validator"></a>自定义Validator</h4><p>这里才是才是真正的处理逻辑，注解类似是一个徽章，在AOP处理处理时，是一个特殊的标识。</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java">    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IdentityCardNumberValidator</span> <span class="token keyword">implements</span> <span class="token class-name">ConstraintValidator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IdentityCardNumber</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">IdentityCardNumber</span> identityCardNumber<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isValid</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token class-name">ConstraintValidatorContext</span> constraintValidatorContext<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">IdCardValidatorUtils</span><span class="token punctuation">.</span><span class="token function">isValidate18Idcard</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"身份证号不能为空"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@IdentityCardNumber</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"身份证信息有误,请核对后提交"</span><span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token class-name">String</span> clientCardNo<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="使用groups的校验"><a href="#使用groups的校验" class="headerlink" title="使用groups的校验"></a>使用groups的校验</h3><p>就是分组校验，一个实体类作为不同的接口参数校验时，可能有不同的需求。定义两个接口。</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>validation<span class="token punctuation">.</span>groups<span class="token punctuation">.</span></span><span class="token class-name">Default</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Create</span> <span class="token keyword">extends</span> <span class="token class-name">Default</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>validation<span class="token punctuation">.</span>groups<span class="token punctuation">.</span></span><span class="token class-name">Default</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Update</span> <span class="token keyword">extends</span> <span class="token class-name">Default</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>再在需要校验的地方@Validated声明校验组</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/update/groups"</span><span class="token punctuation">)</span>                 <span class="token comment">// 这里就是核心</span>   <span class="token keyword">public</span> <span class="token class-name">RspDTO</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token annotation punctuation">@Validated</span><span class="token punctuation">(</span><span class="token class-name">Update</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token class-name">UserDTO</span> userDTO<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>       userService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>userDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">return</span> <span class="token class-name">RspDTO</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>DTO 改一下</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDTO</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>    <span class="token comment">/*** 用户ID*/</span>    <span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"用户id不能为空"</span><span class="token punctuation">,</span> groups <span class="token operator">=</span> <span class="token class-name">Update</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Long</span> userId<span class="token punctuation">;</span>    <span class="token comment">/**     * 用户名     */</span>    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"用户名不能为空"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Length</span><span class="token punctuation">(</span>max <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"用户名不能超过20个字符"</span><span class="token punctuation">,</span> groups <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">Create</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Update</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Pattern</span><span class="token punctuation">(</span>regexp <span class="token operator">=</span> <span class="token string">"^[\\u4E00-\\u9FA5A-Za-z0-9\\*]*$"</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"用户昵称限制：最多20字符，包含文字、字母和数字"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>    <span class="token comment">/**     * 手机号     */</span>    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"手机号不能为空"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Pattern</span><span class="token punctuation">(</span>regexp <span class="token operator">=</span> <span class="token string">"^[1][3,4,5,6,7,8,9][0-9]&#123;9&#125;$"</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"手机号格式有误"</span><span class="token punctuation">,</span> groups <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">Create</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Update</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> mobile<span class="token punctuation">;</span>    <span class="token comment">/**     * 性别     */</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> sex<span class="token punctuation">;</span>    <span class="token comment">/**     * 邮箱     */</span>    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"联系邮箱不能为空"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Email</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"邮箱格式不对"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>    <span class="token comment">/**     * 密码     */</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>    <span class="token comment">/*** 创建时间 */</span>    <span class="token annotation punctuation">@Future</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"时间必须是将来时间"</span><span class="token punctuation">,</span> groups <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">Create</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><div class="note note-info">            <p>tips 注意:在声明分组的时候尽量加上 <code>extend javax.validation.groups.Default</code> 否则,在你声明<code>@Validated(Update.class)</code> 的时候,就会出现你在默认没添加<code>groups = {}</code>的时候的校验组<code>@Email(message = &quot;邮箱格式不对&quot;)</code>,会不去校验,因为默认的校验组是<code>groups = {Default.class}</code></p>          </div><h3 id="restful风格用法"><a href="#restful风格用法" class="headerlink" title="restful风格用法"></a>restful风格用法</h3><p>在多个参数校验,或者@RequestParam 形式时候,需要在controller上加注@Validated</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/get"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">RspDTO</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"userId"</span><span class="token punctuation">)</span> <span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"用户id不能为空"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">User</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RspDTO</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nonAbsent</span><span class="token punctuation">(</span><span class="token string">"用户不存在"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RspDTO</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>需要加上</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"user/"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Validated</span>  <span class="token comment">// 这个是重点</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractController</span> <span class="token punctuation">&#123;</span>    ·········<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>说了一大通基础的东西，但是感觉其实挺全面了，各种用法都介绍了，不足就是 但是没有很深入，如异常的日志的记录，等等。</p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gxy53k0f3ej335s1o0nif.jpg" alt="集原美 粉色帽子"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>validation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>晚闻</title>
    <link href="/2021/12/20/gossip-05/"/>
    <url>/2021/12/20/gossip-05/</url>
    
    <content type="html"><![CDATA[<p>正常晚上下班，下了公交车，车站到我租的的出租屋里还有段距离，下了班到也不着急，悠哉游哉的走在路上，视野里不知道从哪个角落里冒出来一只流浪狗，一开始我并没有去注意这个动物，人来人往的大街上流浪狗很多，我只是一个路人而已，无聊的摇头晃脑时不经意撇了一眼，是一只我也不太会形容，个子不高，四肢短小，不知 是因为流浪的缘故，还是夜色笼罩的缘故，我看着是只灰溜溜的小狗，不过眼睛在灰暗中显的很亮，不知道为什么，没由头的念想让我想跟着它走一走，就跟了它一阵子，想试试能不能把它带走，也不知道为什么会生出这种想法，下了班的时间是我可以自由支配的时间，我便跟着它走了一段时间，小狗的戒心比较重，根本不让我靠近，这也是它存活到现在的原因吧，我不是一个很有耐心的人，跟着的时候，我没有别的行动，我唯一做的就是跟在后面尝试如果它回过头来我就蹲下，伸出手来，看看它会不会过来，最后的最后它没有过来，我也转身回去了，我对自己说，这就是没有缘分啊，不仅人与人，人与狗也是。路上我可以从店里买两根火腿肠，这样做也许会增加它过来的几率，可我不想，这种事还是相信缘分吧，买火腿这种行为会不会只是在骗自己。它不过来，这也不是一件坏事，我就一普普通通打工人，就算它过来跟我走了，我可以让它“锦衣玉食”，“干干净净”一段时间，可现实是，我没有汽车，我没有办法带它上高铁，或者大巴，可能这也是借口，是我为我的自私自利找的一个借口，没有办法带回家。在过年回家这一铁律下，它被我抛弃的可能性很高。那时候才是真正的好心办了坏事，它本来就是流浪的，原本就是，一直如此就挺好。</p><p>因为你的一点“善意”。你打破它平静的生活，故事的最后，你还表现出一幅我已经尽力的无辜表情。挺让人笑话的。</p><blockquote><p>原文记于2020年末</p></blockquote><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gxkcc6lgslj32yo1o0x6p.jpg" alt="火影忍者春野樱"></p>]]></content>
    
    
    <categories>
      
      <category>碎碎念</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>初恋</title>
    <link href="/2021/12/20/other-05/"/>
    <url>/2021/12/20/other-05/</url>
    
    <content type="html"><![CDATA[<div class="note note-light">            <p>无论我们最后生疏成什么样子，曾经对你的好都是真的，就算终有一散，也别辜负相遇，希望你不后悔认识我，也是真的快乐过，如果能回到从前，我会选择不认识你，不是我后悔，是我不能面对现在的结局。</p>          </div><div class="note note-light">            <p>相恋867天，分手七年，单身七年，至今无法释怀，更多的可能是不甘吧。</p>          </div><div class="note note-light">            <p>到现在都记得很清楚！<br>读初二，报道的第一天，一眼望去就看中了他，然后给了我一个朋友5块钱，叫他跟我换座位。这样就坐在了她后面位置，就这样一来二去慢慢熟悉了，后来在一起了，初三读完她考上了高中我因为差了几分，最后读了职校，到了2015年因为读职校学会了混社会，最后家里下了通牒，与她商量了后选择了入伍，当时记得还跟她约定好了，五年后回来就娶她，2016年我满18岁的时候她还跟我父母来了部队跟我庆祝生日，我父母对她也很满意，农历2016大年三十，因为部队晚上有跨年晚会，手机就放在了宿舍里，等到回来时，只知道她跟我说出了分手！随后我2017年退伍，回来也打听了她消息，可是不愿意见我！之后谈过几个女朋友，但是都已习惯与她做比较，直到现在都记得她的生日，手机号码，或许她手机号码已换，或许她已结婚，为人母，但是很高兴有这么一段回忆，或许不美好！</p>          </div><div class="note note-light">            <p>我的初恋是一个很善解人意的女孩，只是败在了当初的年少无知，如今回忆起来，追悔莫及！</p>          </div><div class="note note-light">            <p>她是第一个我很正式的介绍给家里的女孩子</p>          </div><div class="note note-light">            <p>初恋 一个现在时刻牵动我情绪的人 即使分开了 也希望她能过的好 年少不懂爱的时期碰到爱的人真的很难把握住 当一个要走一个挽留无果的时候 那时可能真的是心力憔悴 无能为力吧 只能说错过了她以后 貌似是丧失了爱别人的能力 每当自己去做或者得到新的东西的时候 总会幻想她在身边应该会是怎么样 可能到现在也还没有释怀 释怀不掉这段感情 释怀不掉她 总是在回忆与现实中来回拉扯 不过可以确定的是她不会回来了 也没有反方向的钟 也不会有那个一起上课 一起自习 一起吃饭的情景 上课 自习 吃饭可能不会变 变得只是从两人变成两个人 陷入回忆不可自拔 可能真的是想谈一场从始而终的恋爱 导致爱得太满 太用力 半年感情两年祭奠 所以说啊 不会爱的年纪 年少时期真的不要爱的太用力 物极必反<br> 只能说一步一回眸 但不会停留原地</p>          </div><div class="note note-light">            <p>她是我想把所有温暖都给她的人 她也救赎过我</p>          </div><div class="note note-light">            <p>初恋啊，有点甜有点酸有点无奈，让我久久不能忘怀，他说过的话做过的事都刻在我心里并永远存在，和他分开我觉得我再也不会那么开心，此时此刻我都觉得我们应该永远在一起，好想拥有一台时光机啊，回到我们眼里都是彼此的时候。。。</p>          </div><div class="note note-light">            <p>她就站在哪儿 站在我十八岁的心中。</p>          </div><div class="note note-light">            <p>大概就是山海亦可平，唯有她终是意难平吧</p>          </div><h2 id="封"><a href="#封" class="headerlink" title="封"></a>封</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gxk2cqm12uj32yo1o0kjp.jpg" alt="阿尔卑斯山"></p>]]></content>
    
    
    <categories>
      
      <category>Other</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>大学里de一些事</title>
    <link href="/2021/12/14/gossip-04/"/>
    <url>/2021/12/14/gossip-04/</url>
    
    <content type="html"><![CDATA[<p>遥想刚进大学，漫无目的，不知道自己要走哪条路，无一例外，坚持下来就是你走的路。大一初，原本的计算机网络专业，专科就专科呗，当时也没有主见，听了别人的要求，转了一次专业，转到了土木专业，我的性格是属于比较极端的，或者说及其的遵循本心，专业课学得不多，算是为自己不好好学习找了个借口吧，听闻大学里面学生会有意思，理所应当的加了一个学生会，感受了一下，算是有了一点见解。大一由于只是一个大一新生，又由于一些让人生恼的愁绪，我没啥表现，只是本本分分的做一些简单的事。</p><p>大二，当了一个所谓的部长，当时不知道为什么，就想留下来，</p><p>我记得学生会主席说的话我有一点见解，说你们当部长不是因为你们有多优秀，而是只是你们愿意留下来。是啊，愿意留下来的才是真的想留下来的，优秀不优秀，留下来的才是真的。留下来的才是真的。</p><p>接下来的日子，大二一年是我最巅峰的时候，带着大一的新生一起玩闹，几个部长之间的打闹，这段时间算是我大学里最快乐的时光，我的性格如此，如果没有事情让我们产生联系，我们的关系及其容易就止步于此，就算偶尔能撞见，也只是简单的寒暄两句，是没有办法回到从前的。从小到大，无一例外！</p><p>再者大三了，当时上学期还是一起直接在操场上喝啤酒，眼里闪着小星星和大家说着被粉饰过后的爱情故事，听完乐了，我也乐了。上头之后，有人吵，有人闹，有人哭着喊着要吃健胃消食片，我也不说是谁，这个确实挺讨喜。后来啊，因为没有学生会的交集，加上我毕业将至，再后来，因为一场突如其来的疫情，月亮下了山，星星也失了约，我们都弄丢了一些人和事，尽管你现在变得比以前优秀了。</p><p>又是一年寒冬，我在何处天涯，你又在谁的伞下。</p><blockquote><p>原文记于2020年年末。</p></blockquote><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gxdqoo9ln1j32yo1o07wj.jpg" alt="集原美2周年生日快乐"></p>]]></content>
    
    
    <categories>
      
      <category>碎碎念</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>知易行难</title>
    <link href="/2021/12/14/gossip-03/"/>
    <url>/2021/12/14/gossip-03/</url>
    
    <content type="html"><![CDATA[<div class="note note-info">            <p>“无一例外，我永远知道哪条路是对的。但我从来不走，因为太他娘难了”</p><p>– 这句话不是我说的，但事实如此。</p>          </div><p>距离上一次写这东西的时候已经过去有段时间了，从时间上来说，我并不忙，但是我却迟迟不动键盘，我却一直没有产出，在保持输出的时候，同时也是需要保持输入的，否则会有一种拔剑四顾心茫然的感觉，午休的时候，电脑面前一坐，感觉我应该做点什么，于是新建了一个文件夹，👼然后安心的打开了原神。</p><p>现在相较于写demo，更多的时间是在看demo，我代码写的并不少，坚持是一件很难的事，在一次一次的重复造轮子中，我的写代码的热情好像被消耗的非常严重，一段时间就是懒癌上身，不想重构，不想看自己写的代码，看自己的代码有种无力的茫然感，这时候我会期待有个人能帮我重构一下代码，能帮我把这个代码变得耳目一新，以让我重拾对代码的热情，但可惜的是，这种期待只能是期待，只是我给自己找的一个借口，借口的背后就是我真实的惰性。道理都懂，你不想做的事，其实就是你应该做的事。知易行难。</p><p>看开源项目的代码，实际上是很轻松的，但有些人看代码感觉累，感觉累，应该就是代码写少了，需要多多学习，带入原有开发者的思想，在你未阅读一定量的代码之前，请务必虚心当一个学习者。</p><p>努力让自己成为了一个参与者，参与开源项目，是最好的提升自己的方式，学习优秀项目的思路，是提升自己最好的方法，</p><h2 id="雾失楼台"><a href="#雾失楼台" class="headerlink" title="雾失楼台"></a>雾失楼台</h2><div class="note note-info">            <p>那日本人靠不住，我靠谁啊？老蒋？”</p><p>“更靠不住。”</p><p>“一个写日记的人。”</p><p>“正经人谁写日记啊。”</p><p>“是啊。”</p><p>“你写日记吗。”</p><p>“我不写。”</p><p>“你写日记吗？”</p><p>“谁能把心里话写日记里？”</p><p>“写出来的哪能叫心里话？”</p><p>“下贱。”</p><p>“下贱。”</p>          </div><h2 id="封"><a href="#封" class="headerlink" title="封"></a>封</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gxdqc3tq92j31z41404qp.jpg" alt="女孩"></p>]]></content>
    
    
    <categories>
      
      <category>碎碎念</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vue+TS+默认组合式API</title>
    <link href="/2021/11/29/vue-03/"/>
    <url>/2021/11/29/vue-03/</url>
    
    <content type="html"><![CDATA[<p>对于前端的开发，我一直有在关注，Vue的写法有点多，是好事还是坏事，我也搞不懂了，几种写法我也都试了一试，可能是TS的原因，觉得并不是很完美，默认的写法对TS兼容性应该是最好的，兼容的场景还是蛮多的，但是监听自定义事件的时候，没有提示。</p><p><code>&lt;script setup lang=&quot;ts&quot;&gt;</code>的写法监听自定义事件的提示十分友好，但这种写法访问子组件里的属性时也不友好。但是转念想一想，组件之间应该是独立的，况且Vue也提供了父子组件交互的方法，父组件直接操作子组件这种行为并不推荐。这种写法代码的简洁度很高，按常理来说，代码越少越易维护。自己斟酌。</p><p>我是期望前端发展如后端的springboot一样，写法规范统一起来，不管从维护上，还是开发上都能减少一些没有必要的工作量。</p><h2 id="默认组合式API写法"><a href="#默认组合式API写法" class="headerlink" title="默认组合式API写法"></a>默认组合式API写法</h2><h3 id="响应式"><a href="#响应式" class="headerlink" title="响应式"></a>响应式</h3><h4 id="简单的响应式"><a href="#简单的响应式" class="headerlink" title="简单的响应式"></a>简单的响应式</h4><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>&#123;&#123; name&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>&#123;&#123;sum&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ts<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> defineComponent<span class="token punctuation">,</span> toRefs<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> watch<span class="token punctuation">,</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'HelloWorld'</span><span class="token punctuation">,</span>    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 定义</span>        <span class="token keyword">const</span> sum <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'hahahahah'</span><span class="token punctuation">)</span>        <span class="token comment">// 使用第一步</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>            sum<span class="token punctuation">,</span>name        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h4 id="复杂的响应式"><a href="#复杂的响应式" class="headerlink" title="复杂的响应式"></a>复杂的响应式</h4><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- 使用 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>&#123;&#123;user.name&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>&#123;&#123;user.age&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>&#123;&#123;user.sex&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ts<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> defineComponent<span class="token punctuation">,</span> toRefs<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> watch<span class="token punctuation">,</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'HelloWorld'</span><span class="token punctuation">,</span>    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 定义一个变量</span>        <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'小红'</span><span class="token punctuation">,</span>            <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">,</span>            <span class="token literal-property property">sex</span><span class="token operator">:</span> <span class="token string">'男'</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token comment">// 导出才能在模板中使用</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>            user        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h4 id="一些小妙招"><a href="#一些小妙招" class="headerlink" title="一些小妙招"></a>一些小妙招</h4><p>不想在return中写太多的感觉没啥意义的代码，这时候我们就可以这样写</p><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- 使用 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>&#123;&#123; user.name &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>&#123;&#123; user.age &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>&#123;&#123; user.sex &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>&#123;&#123; sum &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sunc(<span class="token punctuation">'</span>233<span class="token punctuation">'</span>)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>按钮<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ts<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> defineComponent<span class="token punctuation">,</span> toRefs<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> watch<span class="token punctuation">,</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'HelloWorld'</span><span class="token punctuation">,</span>    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'小红'</span><span class="token punctuation">,</span>                <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">,</span>                <span class="token literal-property property">sex</span><span class="token operator">:</span> <span class="token string">'男'</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token comment">// 可以写任意变量，就不需要在return中写了</span>            <span class="token literal-property property">sum</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>            <span class="token comment">// 函数也可以在这里面写</span>            <span class="token function">sunc</span><span class="token punctuation">(</span>id<span class="token operator">:</span>string<span class="token punctuation">)</span><span class="token operator">:</span><span class="token keyword">void</span> <span class="token punctuation">&#123;</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'id='</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token comment">// 计算属性也可以在这里写，就不需要在return里面写很多代码了。</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// 解构导出，访问的时候不需要带上data</span>            <span class="token operator">...</span><span class="token function">toRefs</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="监听事件"><a href="#监听事件" class="headerlink" title="监听事件"></a>监听事件</h3><p>关于监听的API还挺多的，这里不过多介绍，只介绍常见的。</p><h4 id="简单的监听"><a href="#简单的监听" class="headerlink" title="简单的监听"></a>简单的监听</h4><figure><div class="code-wrapper"><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>       <span class="token keyword">const</span> fastName <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'3222'</span><span class="token punctuation">)</span>       <span class="token function">watch</span><span class="token punctuation">(</span>fastName<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span>oldVal</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>           console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newVal <span class="token operator">+</span><span class="token string">'---'</span><span class="token operator">+</span>oldVal<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>       <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>           fastName       <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h4 id="侦听一个Getter函数"><a href="#侦听一个Getter函数" class="headerlink" title="侦听一个Getter函数"></a>侦听一个Getter函数</h4><figure><div class="code-wrapper"><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 使用reactive定义的不能直接data.user.name来监听。</span>    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'小红'</span><span class="token punctuation">,</span>            <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">,</span>            <span class="token literal-property property">sex</span><span class="token operator">:</span> <span class="token string">'男'</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token comment">// 可以写任意变量，就不需要在return中写了</span>        <span class="token literal-property property">sum</span><span class="token operator">:</span> <span class="token number">200</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token comment">// 使用这种方式就是可以监听得到。</span>    <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> data<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newVal <span class="token operator">+</span> <span class="token string">'---'</span> <span class="token operator">+</span> oldVal<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 解构导出，访问的时候不需要带上data</span>        <span class="token operator">...</span><span class="token function">toRefs</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h4 id="监听多个源"><a href="#监听多个源" class="headerlink" title="监听多个源"></a>监听多个源</h4><figure><div class="code-wrapper"><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> fooRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> barRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">"bar"</span><span class="token punctuation">)</span>    <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">[</span>fooRef<span class="token punctuation">,</span> barRef<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>foo<span class="token punctuation">,</span> bar<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>prevFoo<span class="token punctuation">,</span> prevBar<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'newVal = '</span> <span class="token operator">+</span> foo<span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> bar<span class="token operator">+</span><span class="token string">',,,oldVal'</span> <span class="token operator">+</span> prevFoo<span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> prevBar<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="定义Props"><a href="#定义Props" class="headerlink" title="定义Props"></a>定义Props</h3><h4 id="简单的定义"><a href="#简单的定义" class="headerlink" title="简单的定义"></a>简单的定义</h4><p>父组件传值时会有类型校验。</p><figure><div class="code-wrapper"><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'HelloWorld'</span><span class="token punctuation">,</span>  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span>ctx</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h4 id="高端的定义"><a href="#高端的定义" class="headerlink" title="高端的定义"></a>高端的定义</h4><figure><div class="code-wrapper"><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">interface</span> <span class="token class-name">Book</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">title</span><span class="token operator">:</span> string  <span class="token literal-property property">author</span><span class="token operator">:</span> string  <span class="token literal-property property">year</span><span class="token operator">:</span> number<span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'HelloWorld'</span><span class="token punctuation">,</span>  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 普通变量</span>    <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>      <span class="token comment">// 默认值</span>      <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token string">'这是默认值'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token comment">// 校验</span>      <span class="token function-variable function">validator</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">msg</span><span class="token operator">:</span> String</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> msg<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">3</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token comment">// 对象变量</span>    <span class="token literal-property property">book</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 要使用PropType来定义变量</span>      <span class="token literal-property property">type</span><span class="token operator">:</span> Object <span class="token keyword">as</span> PropType<span class="token operator">&lt;</span>Book<span class="token operator">></span><span class="token punctuation">,</span>      <span class="token comment">// 请务必使用箭头函数</span>      <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'这是一个错误'</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token function-variable function">validator</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">book</span><span class="token operator">:</span> Book</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">!</span><span class="token operator">!</span>book<span class="token punctuation">.</span>title    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="自定义事件"><a href="#自定义事件" class="headerlink" title="自定义事件"></a>自定义事件</h3><p>props和自定义事件都属于组件化常用的，自定义事件的历史包袱过重，在setup的写法中得到了解决，这个组合式API中没啥好的办法</p><figure><div class="code-wrapper"><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 这里传入第二个参数</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> aaaa <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token function">changeTaa</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 抛出事件，事件名为del</span>        ctx<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'del'</span><span class="token punctuation">,</span> <span class="token number">233</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>      <span class="token operator">...</span><span class="token function">toRefs</span><span class="token punctuation">(</span>aaaa<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 监听部分 <span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span>HelloWorld ref<span class="token operator">=</span><span class="token string">"model"</span> @del<span class="token operator">=</span><span class="token string">"testEmit"</span><span class="token operator">/</span><span class="token operator">></span><span class="token comment">// 当在子组件中抛出事件此方法就会被触发，我们还可以用这个方法返回值来给子组件传递数据。工欲善其事必先利其器，半吊子很难的啦。</span><span class="token function">testEmit</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">id</span><span class="token operator">:</span>string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'自定义事件触发了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'id='</span><span class="token operator">+</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>到这，常用的组合式API的写法其实就已经差不多了。</p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gwwg1k0x9cj32yo1o04qq.jpg" alt="集原美Sky train"></p>]]></content>
    
    
    <categories>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBoot2.5.x整合Quartz并持久化</title>
    <link href="/2021/11/22/java-05/"/>
    <url>/2021/11/22/java-05/</url>
    
    <content type="html"><![CDATA[<p>风风火火，恍恍惚惚，springboot2.6.0正式版也发布了，同时也宣布了2.4x版本停止维护。2.5.x系列也是目前自己写Demo在用的，为什么要记录下来呢， 主要我把项目升级到2.6之后项目跑不起来了，原因我知道，但是我不知道怎么解决，看了看机翻的更新文档，有处可能是影响我项目跑不起来的原因，就是限制了依赖的循环导入，现在依赖循环导入，项目是会直接跑不起来。我的问题是项目里获取不到DataSource数据源，我用了各种姿势，都获取不到，靓仔在线疑惑。既然不能无缝升级，那我就记下来一个正常的版本。</p><p>定时任务是很常用的一个功能，比如简单的生日提醒，每天定点查询用户的生日信息。然后发出一系列的提示操作。不了解你就感觉很难，但是现在spring给我们带来了很多的便利，看一看，在头脑风暴一下，也不难。编程一途，殊途同归。</p><p>主要工作中好多同步代码感觉都可以使用定时任务来处理，然而实际上用的是一个一个的Main方法，吐槽吧，人家那代码又不是不能跑，不仅能跑，还能赚钱。没啥好吐槽的，就是维护时想骂娘，骂娘就骂娘，还十分容易出错。</p><h2 id="核心配置类"><a href="#核心配置类" class="headerlink" title="核心配置类"></a>核心配置类</h2><p>用了这个配置类，腰不酸了，腿不痛了，一次能爬五层楼。觉也睡的香了。好吧，前面纯属扯淡，写了这个yml中就不需要配置了，大致看一下每行的注释，测试学习中以先跑起来为主，然后再慢慢研究即可。</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>wangijun<span class="token punctuation">.</span>springbootdemo<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span><span class="token comment">/** * quartz配置类 */</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QuartzConfig</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 此种注入方式，在springboot2.6中获取不到，     */</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">;</span>    <span class="token comment">/**     * Describe: 定时任务工厂     * Param: DataSource     * Return: ScheduleFactoryBean     * */</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">SchedulerFactoryBean</span> <span class="token function">schedulerFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Properties</span> prop <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// QlScheduler这个值可以自定义</span>        prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"org.quartz.scheduler.instanceName"</span><span class="token punctuation">,</span> <span class="token string">"QlScheduler"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 设置为AUTO时使用，默认的实现org.quartz.scheduler.SimpleInstanceGenerator是基于主机名称和时间戳生成。</span>        prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"org.quartz.scheduler.instanceId"</span><span class="token punctuation">,</span> <span class="token string">"AUTO"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 线程池相关配置</span>        prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"org.quartz.threadPool.class"</span><span class="token punctuation">,</span> <span class="token string">"org.quartz.simpl.SimpleThreadPool"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"org.quartz.threadPool.threadCount"</span><span class="token punctuation">,</span> <span class="token string">"20"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"org.quartz.threadPool.threadPriority"</span><span class="token punctuation">,</span> <span class="token string">"5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// JobStoreTX在每次执行任务后都使用commit或者rollback来提交更改。</span>        prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"org.quartz.jobStore.class"</span><span class="token punctuation">,</span> <span class="token string">"org.quartz.impl.jdbcjobstore.JobStoreTX"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 集群配置：如果有多个调度器实体的话则必须设置为true，如果项目部署了多个，就设置为true</span>        prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"org.quartz.jobStore.isClustered"</span><span class="token punctuation">,</span> <span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 集群配置：检查集群下的其他调度器实体的时间间隔</span>        prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"org.quartz.jobStore.clusterCheckinInterval"</span><span class="token punctuation">,</span> <span class="token string">"15000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 设置一个频度(毫秒)，用于实例报告给集群中的其他实例</span>        prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"org.quartz.jobStore.maxMisfiresToHandleAtATime"</span><span class="token punctuation">,</span> <span class="token string">"5000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 触发器触发失败后再次触犯的时间间隔</span>        prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"org.quartz.jobStore.misfireThreshold"</span><span class="token punctuation">,</span> <span class="token string">"12000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 数据库表前缀 重点这个和建表SQL是对应的关系，如果改了需要改动建表语句</span>        prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"org.quartz.jobStore.tablePrefix"</span><span class="token punctuation">,</span> <span class="token string">"schedule_"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 从 LOCKS 表查询一行并对这行记录加锁的 SQL 语句</span>        prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"org.quartz.jobStore.selectWithLockSQL"</span><span class="token punctuation">,</span> <span class="token string">"SELECT * FROM &#123;0&#125;LOCKS UPDLOCK WHERE LOCK_NAME = ?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">SchedulerFactoryBean</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SchedulerFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 数据源</span>        factory<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 上面的配置</span>        factory<span class="token punctuation">.</span><span class="token function">setQuartzProperties</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 可自定义</span>        factory<span class="token punctuation">.</span><span class="token function">setSchedulerName</span><span class="token punctuation">(</span><span class="token string">"QlScheduler"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 项目启动后30秒后启动开始执行定时任务</span>        factory<span class="token punctuation">.</span><span class="token function">setStartupDelay</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setApplicationContextSchedulerContextKey</span><span class="token punctuation">(</span><span class="token string">"applicationContextKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setOverwriteExistingJobs</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 自动启动</span>        factory<span class="token punctuation">.</span><span class="token function">setAutoStartup</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> factory<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><div class="note note-info">            <p>此种配置的Quartz是持久化到数据库的，就是项目重启定时任务的状态并不会丢失。</p>          </div><h2 id="用于Web管理Bean"><a href="#用于Web管理Bean" class="headerlink" title="用于Web管理Bean"></a>用于Web管理Bean</h2><p>可以自定义，要点看代码注释。</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>wangijun<span class="token punctuation">.</span>springbootdemo<span class="token punctuation">.</span>pojo</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span><span class="token comment">/**    * 定时任务    */</span><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"schedule_job"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduleJob</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 必须序列化</span>    <span class="token comment">// 必须要有</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> JOB_PARAM_KEY <span class="token operator">=</span> <span class="token string">"JOB_PARAM_KEY"</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 任务id     */</span>    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>ASSIGN_ID<span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>    <span class="token comment">/**     * spring bean名称     */</span>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"bean_name"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> beanName<span class="token punctuation">;</span>    <span class="token comment">/**     * 参数     */</span>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"params"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> params<span class="token punctuation">;</span>    <span class="token comment">/**     * cron表达式     */</span>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"cron_expression"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> cronExpression<span class="token punctuation">;</span>    <span class="token comment">/**     * 任务状态  0：正常  1：暂停     */</span>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"`status`"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Byte</span> status<span class="token punctuation">;</span>    <span class="token comment">/**     * 备注     */</span>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"remark"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> remark<span class="token punctuation">;</span>    <span class="token comment">/**     * 创建时间     */</span>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"create_time"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> createTime<span class="token punctuation">;</span>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"job_name"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> jobName<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span> <span class="token comment">// 必须要有</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="定时任务执行日志Bean"><a href="#定时任务执行日志Bean" class="headerlink" title="定时任务执行日志Bean"></a>定时任务执行日志Bean</h2><p>主要就是记录一下日志，可根据自己需求，自行扩展。</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>wangijun<span class="token punctuation">.</span>qluiserver<span class="token punctuation">.</span>pojo</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span><span class="token comment">/**    * 定时任务日志    */</span><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"schedule_log"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduleLog</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 任务日志id     */</span>    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>INPUT<span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>    <span class="token comment">/**     * 任务id     */</span>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"job_id"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> jobId<span class="token punctuation">;</span>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"job_name"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> jobName<span class="token punctuation">;</span>    <span class="token comment">/**     * 参数     */</span>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"params"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> params<span class="token punctuation">;</span>    <span class="token comment">/**     * 任务状态    0：成功    1：失败     */</span>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"`status`"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> status<span class="token punctuation">;</span>    <span class="token comment">/**     * 失败信息     */</span>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"error"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> error<span class="token punctuation">;</span>    <span class="token comment">/**     * 耗时(单位：毫秒)     */</span>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"times"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> times<span class="token punctuation">;</span>    <span class="token comment">/**     * 创建时间     */</span>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"create_time"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> createTime<span class="token punctuation">;</span>    <span class="token comment">/**     * spring bean名称     */</span>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"bean_name"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> beanName<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="执行定时任务的上下文"><a href="#执行定时任务的上下文" class="headerlink" title="执行定时任务的上下文"></a>执行定时任务的上下文</h2><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>wangijun<span class="token punctuation">.</span>springbootdemo<span class="token punctuation">.</span>schedule</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span><span class="token comment">/** * Describe: 定时任务执行上下文 * Author: 就免仪式 * CreateTime: 2019/10/23 * */</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduleContext</span> <span class="token keyword">extends</span> <span class="token class-name">QuartzJobBean</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * Describe: 执行任务并记录日志     * Param: JobExecutionContext     * Return: 无返回值     * */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">executeInternal</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Object</span> o <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getMergedJobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">ScheduleJob</span><span class="token punctuation">.</span>JOB_PARAM_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ScheduleJob</span> jobBean <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ScheduleJob</span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>        <span class="token class-name">ScheduleLogService</span> scheduleJobLogService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ScheduleLogService</span><span class="token punctuation">)</span> <span class="token class-name">SpringUtil</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"scheduleLogService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ScheduleLog</span> logBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScheduleLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>        logBean<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">IdWorker</span><span class="token punctuation">.</span><span class="token function">getIdStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logBean<span class="token punctuation">.</span><span class="token function">setJobId</span><span class="token punctuation">(</span>jobBean<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logBean<span class="token punctuation">.</span><span class="token function">setJobName</span><span class="token punctuation">(</span>jobBean<span class="token punctuation">.</span><span class="token function">getJobName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logBean<span class="token punctuation">.</span><span class="token function">setBeanName</span><span class="token punctuation">(</span>jobBean<span class="token punctuation">.</span><span class="token function">getBeanName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logBean<span class="token punctuation">.</span><span class="token function">setParams</span><span class="token punctuation">(</span>jobBean<span class="token punctuation">.</span><span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        logBean<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> beginTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Object</span> target <span class="token operator">=</span> <span class="token class-name">SpringUtil</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>jobBean<span class="token punctuation">.</span><span class="token function">getBeanName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Method</span> method <span class="token operator">=</span> target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"run"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> jobBean<span class="token punctuation">.</span><span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">long</span> executeTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> beginTime<span class="token punctuation">;</span>            logBean<span class="token punctuation">.</span><span class="token function">setTimes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> executeTime<span class="token punctuation">)</span><span class="token punctuation">;</span>            logBean<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"定时器 === >> "</span> <span class="token operator">+</span> jobBean<span class="token punctuation">.</span><span class="token function">getJobName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"执行成功,耗时 === >> "</span> <span class="token operator">+</span> executeTime<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">long</span> executeTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> beginTime<span class="token punctuation">;</span>            logBean<span class="token punctuation">.</span><span class="token function">setTimes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>executeTime<span class="token punctuation">)</span><span class="token punctuation">;</span>            logBean<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            logBean<span class="token punctuation">.</span><span class="token function">setError</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getCause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            e<span class="token punctuation">.</span><span class="token function">getCause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            scheduleJobLogService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>logBean<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="定时任务处理器"><a href="#定时任务处理器" class="headerlink" title="定时任务处理器"></a>定时任务处理器</h2><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>wangijun<span class="token punctuation">.</span>springbootdemo<span class="token punctuation">.</span>schedule</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span><span class="token comment">/** * Describe: 定时任务处理器 * Author: 就免仪式 * CreateTime: 2019/10/23 * */</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduleHandler</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 定时任务标识 Key,     * */</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> SCHEDULE_NAME <span class="token operator">=</span> <span class="token string">"Ql_"</span> <span class="token punctuation">;</span>    <span class="token comment">/**     * 触发器 KEY     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">TriggerKey</span> <span class="token function">getTriggerKey</span><span class="token punctuation">(</span><span class="token class-name">Long</span> jobId<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">TriggerKey</span><span class="token punctuation">.</span><span class="token function">triggerKey</span><span class="token punctuation">(</span>SCHEDULE_NAME <span class="token operator">+</span> jobId<span class="token punctuation">)</span> <span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 定时器 Key     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">JobKey</span> getJobKey <span class="token punctuation">(</span><span class="token class-name">Long</span> jobId<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">JobKey</span><span class="token punctuation">.</span><span class="token function">jobKey</span><span class="token punctuation">(</span>SCHEDULE_NAME<span class="token operator">+</span>jobId<span class="token punctuation">)</span> <span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 表达式触发器     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CronTrigger</span> getCronTrigger <span class="token punctuation">(</span><span class="token class-name">Scheduler</span> scheduler<span class="token punctuation">,</span> <span class="token class-name">Long</span> jobId<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">CronTrigger</span><span class="token punctuation">)</span>scheduler<span class="token punctuation">.</span><span class="token function">getTrigger</span><span class="token punctuation">(</span><span class="token function">getTriggerKey</span><span class="token punctuation">(</span>jobId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SchedulerException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Describe: 创建定时任务     * Param: Scheduler ScheduleJobBean     * Return: null     * */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> createJob <span class="token punctuation">(</span><span class="token class-name">Scheduler</span> scheduler<span class="token punctuation">,</span> <span class="token class-name">ScheduleJob</span> scheduleJob<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// 构建定时器</span>            <span class="token class-name">JobDetail</span> jobDetail <span class="token operator">=</span> <span class="token class-name">JobBuilder</span><span class="token punctuation">.</span><span class="token function">newJob</span><span class="token punctuation">(</span><span class="token class-name">ScheduleContext</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token function">getJobKey</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>scheduleJob<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>            <span class="token class-name">CronScheduleBuilder</span> scheduleBuilder <span class="token operator">=</span> <span class="token class-name">CronScheduleBuilder</span>                    <span class="token punctuation">.</span><span class="token function">cronSchedule</span><span class="token punctuation">(</span>scheduleJob<span class="token punctuation">.</span><span class="token function">getCronExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">withMisfireHandlingInstructionDoNothing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>            <span class="token class-name">CronTrigger</span> trigger <span class="token operator">=</span> <span class="token class-name">TriggerBuilder</span><span class="token punctuation">.</span><span class="token function">newTrigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span><span class="token function">getTriggerKey</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>scheduleJob<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span>scheduleBuilder<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            jobDetail<span class="token punctuation">.</span><span class="token function">getJobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ScheduleJob</span><span class="token punctuation">.</span>JOB_PARAM_KEY<span class="token punctuation">,</span>scheduleJob<span class="token punctuation">)</span><span class="token punctuation">;</span>            scheduler<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>jobDetail<span class="token punctuation">,</span>trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 如果该定时器处于暂停状态</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>scheduleJob<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token function">pauseJob</span><span class="token punctuation">(</span>scheduler<span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>scheduleJob<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SchedulerException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"createJob Fail"</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span> <span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Describe: 更新定时任务     * Param: Scheduler ScheduleJobBean     * Return: null     * */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">updateJob</span><span class="token punctuation">(</span><span class="token class-name">Scheduler</span> scheduler<span class="token punctuation">,</span> <span class="token class-name">ScheduleJob</span> scheduleJob<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">TriggerKey</span> triggerKey <span class="token operator">=</span> <span class="token function">getTriggerKey</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>scheduleJob<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">CronScheduleBuilder</span> scheduleBuilder <span class="token operator">=</span> <span class="token class-name">CronScheduleBuilder</span><span class="token punctuation">.</span><span class="token function">cronSchedule</span><span class="token punctuation">(</span>scheduleJob<span class="token punctuation">.</span><span class="token function">getCronExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withMisfireHandlingInstructionDoNothing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">CronTrigger</span> trigger <span class="token operator">=</span> <span class="token function">getCronTrigger</span><span class="token punctuation">(</span>scheduler<span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>scheduleJob<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">assert</span> trigger <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            trigger <span class="token operator">=</span> trigger<span class="token punctuation">.</span><span class="token function">getTriggerBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withIdentity</span><span class="token punctuation">(</span>triggerKey<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withSchedule</span><span class="token punctuation">(</span>scheduleBuilder<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            trigger<span class="token punctuation">.</span><span class="token function">getJobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ScheduleJob</span><span class="token punctuation">.</span>JOB_PARAM_KEY<span class="token punctuation">,</span> scheduleJob<span class="token punctuation">)</span><span class="token punctuation">;</span>            scheduler<span class="token punctuation">.</span><span class="token function">rescheduleJob</span><span class="token punctuation">(</span>triggerKey<span class="token punctuation">,</span> trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>scheduleJob<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token function">pauseJob</span><span class="token punctuation">(</span>scheduler<span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>scheduleJob<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SchedulerException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"updateJob Fail"</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Describe: 停止定时任务     * Param: Scheduler ScheduleJobBean     * Return: null     * */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> pauseJob <span class="token punctuation">(</span><span class="token class-name">Scheduler</span> scheduler<span class="token punctuation">,</span> <span class="token class-name">Long</span> jobId<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            scheduler<span class="token punctuation">.</span><span class="token function">pauseJob</span><span class="token punctuation">(</span><span class="token function">getJobKey</span><span class="token punctuation">(</span>jobId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SchedulerException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"pauseJob Fail"</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Describe: 恢复定时任务     * Param: Scheduler ScheduleJobBean     * Return: null     * */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> resumeJob <span class="token punctuation">(</span><span class="token class-name">Scheduler</span> scheduler<span class="token punctuation">,</span> <span class="token class-name">Long</span> jobId<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            scheduler<span class="token punctuation">.</span><span class="token function">resumeJob</span><span class="token punctuation">(</span><span class="token function">getJobKey</span><span class="token punctuation">(</span>jobId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SchedulerException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"resumeJob Fail"</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Describe: 删除定时任务     * Param: Scheduler ScheduleJobBean     * Return: null     * */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> deleteJob <span class="token punctuation">(</span><span class="token class-name">Scheduler</span> scheduler<span class="token punctuation">,</span> <span class="token class-name">Long</span> jobId<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            scheduler<span class="token punctuation">.</span><span class="token function">deleteJob</span><span class="token punctuation">(</span><span class="token function">getJobKey</span><span class="token punctuation">(</span>jobId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SchedulerException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"deleteJob Fail"</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * Describe: 执行定时任务     * Param: Scheduler ScheduleJobBean     * Return: null     * */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> run <span class="token punctuation">(</span><span class="token class-name">Scheduler</span> scheduler<span class="token punctuation">,</span> <span class="token class-name">ScheduleJob</span> scheduleJob<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">JobDataMap</span> dataMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JobDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>            dataMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ScheduleJob</span><span class="token punctuation">.</span>JOB_PARAM_KEY<span class="token punctuation">,</span>scheduleJob<span class="token punctuation">)</span><span class="token punctuation">;</span>            scheduler<span class="token punctuation">.</span><span class="token function">triggerJob</span><span class="token punctuation">(</span><span class="token function">getJobKey</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>scheduleJob<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>dataMap<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SchedulerException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"run Fail"</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span> <span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="定时任务启动处理类"><a href="#定时任务启动处理类" class="headerlink" title="定时任务启动处理类"></a>定时任务启动处理类</h2><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>wangijun<span class="token punctuation">.</span>springbootdemo<span class="token punctuation">.</span>schedule</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span><span class="token comment">/** * Describe: 定时任务启动处理类 * Author: 就眠仪式 * CreateTime: 2019/10/23 * */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduleStarted</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">Scheduler</span> scheduler <span class="token punctuation">;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token keyword">private</span> <span class="token class-name">ScheduleJobService</span> scheduleJobService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@PostConstruct</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> init <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ScheduleJob</span><span class="token punctuation">></span></span> scheduleJobList <span class="token operator">=</span> scheduleJobService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ScheduleJob</span> scheduleJob <span class="token operator">:</span> scheduleJobList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">CronTrigger</span> cronTrigger <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wangijun<span class="token punctuation">.</span>springbootdemo<span class="token punctuation">.</span>schedule<span class="token punctuation">.</span></span>ScheduleHandler</span><span class="token punctuation">.</span><span class="token function">getCronTrigger</span><span class="token punctuation">(</span>scheduler<span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>scheduleJob<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>cronTrigger <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wangijun<span class="token punctuation">.</span>springbootdemo<span class="token punctuation">.</span>schedule<span class="token punctuation">.</span></span>ScheduleHandler</span><span class="token punctuation">.</span><span class="token function">createJob</span><span class="token punctuation">(</span>scheduler<span class="token punctuation">,</span>scheduleJob<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wangijun<span class="token punctuation">.</span>springbootdemo<span class="token punctuation">.</span>schedule<span class="token punctuation">.</span></span>ScheduleHandler</span><span class="token punctuation">.</span><span class="token function">updateJob</span><span class="token punctuation">(</span>scheduler<span class="token punctuation">,</span>scheduleJob<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="Web接口"><a href="#Web接口" class="headerlink" title="Web接口"></a>Web接口</h2><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>wangijun<span class="token punctuation">.</span>springbootdemo</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduleController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token class-name">ScheduleJobService</span> jobService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token class-name">ScheduleLogService</span> logService<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token class-name">Scheduler</span> scheduler<span class="token punctuation">;</span>            <span class="token comment">/**     * 根据任务ID运行一个任务     *     * @param id 任务ID     * @return 运行状态     */</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"task_run"</span><span class="token punctuation">)</span>    <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">taskRun</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ScheduleJob</span> job <span class="token operator">=</span> jobService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>jobId<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ScheduleHandler</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>scheduler<span class="token punctuation">,</span> job<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 保存任务     *     * @param job 任务实体     * @return 保存结果     */</span>    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"task_save"</span><span class="token punctuation">)</span>    <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">taskSave</span><span class="token punctuation">(</span><span class="token class-name">ScheduleJob</span> job<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        job<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">IdWorker</span><span class="token punctuation">.</span><span class="token function">getIdStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        job<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        jobService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ScheduleHandler</span><span class="token punctuation">.</span><span class="token function">createJob</span><span class="token punctuation">(</span>scheduler<span class="token punctuation">,</span> job<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 更新任务     *     * @param job 任务数据     * @return 更新结果     */</span>    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"task_update"</span><span class="token punctuation">)</span>    <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">taskUpdate</span><span class="token punctuation">(</span><span class="token class-name">ScheduleJob</span> job<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        jobService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ScheduleHandler</span><span class="token punctuation">.</span><span class="token function">updateJob</span><span class="token punctuation">(</span>scheduler<span class="token punctuation">,</span> job<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 停止定时任务     *     * @param id 任务Id     * @return 执行结果     */</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"task_pause"</span><span class="token punctuation">)</span>    <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">taskPause</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ScheduleJob</span> scheduleJob <span class="token operator">=</span> jobService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>jobId<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ScheduleHandler</span><span class="token punctuation">.</span><span class="token function">pauseJob</span><span class="token punctuation">(</span>scheduler<span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>jobId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        scheduleJob<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        jobService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>scheduleJob<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 恢复定时任务     *     * @param id 任务Id     * @return 执行结果     */</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"task_resume"</span><span class="token punctuation">)</span>    <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">taskResume</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ScheduleJob</span> scheduleJob <span class="token operator">=</span> jobService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>jobId<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ScheduleHandler</span><span class="token punctuation">.</span><span class="token function">resumeJob</span><span class="token punctuation">(</span>scheduler<span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>jobId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        scheduleJob<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        jobService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>scheduleJob<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 删除一个任务     *     * @param jobId 任务ID     * @return 删除结果     */</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"task_del"</span><span class="token punctuation">)</span>    <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">taskDel</span><span class="token punctuation">(</span><span class="token class-name">String</span> jobId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ScheduleHandler</span><span class="token punctuation">.</span><span class="token function">deleteJob</span><span class="token punctuation">(</span>scheduler<span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>jobId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        jobService<span class="token punctuation">.</span><span class="token function">removeById</span><span class="token punctuation">(</span>jobId<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="定时任务类"><a href="#定时任务类" class="headerlink" title="定时任务类"></a>定时任务类</h2><h3 id="新增接口接口BaseTaskService-java"><a href="#新增接口接口BaseTaskService-java" class="headerlink" title="新增接口接口BaseTaskService.java"></a>新增接口接口BaseTaskService.java</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>wangijun<span class="token punctuation">.</span>springbootdemo<span class="token punctuation">.</span>task<span class="token punctuation">.</span>base</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BaseTaskService</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 任 务 实 现     * */</span>    <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span> params<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="通用定时任务"><a href="#通用定时任务" class="headerlink" title="通用定时任务"></a>通用定时任务</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>wangijun<span class="token punctuation">.</span>springbootdemo<span class="token punctuation">.</span>task</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span><span class="token comment">/** * Describe: 示例任务 * Author: 就免仪式 * CreateTime: 2019/10/23 * */</span><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"commonTask"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommonTaskImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BaseTaskService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">SimpleDateFormat</span> FORMAT <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>    <span class="token comment">/**     * 任务实现     * */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span> params<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Params === >> "</span> <span class="token operator">+</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"当前时间::::"</span> <span class="token operator">+</span> FORMAT<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="异常的定时任务"><a href="#异常的定时任务" class="headerlink" title="异常的定时任务"></a>异常的定时任务</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>wangijun<span class="token punctuation">.</span>springbootdemo<span class="token punctuation">.</span>task</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span><span class="token comment">/** * Describe: 示例任务 * Author: 就免仪式 * CreateTime: 2019/10/23 * 异常任务 * */</span><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"exceptionTask"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExceptionTaskImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BaseTaskService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">SimpleDateFormat</span> FORMAT <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>    <span class="token comment">/**     * 任务实现     * */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span> params<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"当前时间::::"</span> <span class="token operator">+</span> FORMAT<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string">"发生异常"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="后话"><a href="#后话" class="headerlink" title="后话"></a>后话</h2><p>建表语句以及测试项目源码，mock.http文件中里面有测试数据，IDEA可以很方便的测试。</p><p><a href="https://gitee.com/wlf213/springboot-quartz">源码</a></p><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gwp89wm2nwj33n61o0x6q.jpg" alt="新璃月空港"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>quartz</tag>
      
      <tag>springboot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vue3+TS+SetUp</title>
    <link href="/2021/11/19/vue-02/"/>
    <url>/2021/11/19/vue-02/</url>
    
    <content type="html"><![CDATA[<p>对Vue也算比较熟悉，熟悉的原因很简单，三大前端框架，只有Vue的官方文档中文最全。刚进入工作时用过Vue2,还是内嵌到HTML里面的形式，low是low了点，好处就是当时用(学)起来有没有什么负担，工作里的实践，闲暇中阅读文档，周末大致看看视频，到也不难理解，主要官方的中文文档很详细了，只要你耐得住性子去看，去学。</p><p>Vue3出来也挺长时间了，在Vue３的文档还没有中文翻译的时候我就去看了，当时对Vue这东西理解尚浅，加上一些琐事，没时间去学，学不动了，真的学不动了。不怎么忙的时间里，我于是静下心来了解了一下。</p><p>说升级，对于使用者来说，无外乎废弃了一些API，写法上多了些选择，至于性能提升，代码优化，这些东西我们并不太需要知道。Vue之所以保留旧版的写法，完全是为了照顾旧版本，让使用者就算打算升级也可以更平滑的升级。这对于前端框架来说非常难得，此处点名@angular, 完全不管旧版本的死活。</p><p>尤大官方也说，不建议使用旧版的语法，推荐使用组合式API，那就试试去理解学习组合式API。对于会Vue2的来说理解最重要的，升级的底层核心我们触碰不到，也不需要触碰到，理解Vue2的痛点，以及缺陷，再去理解Vue3新语法解决了什么问题，这个是目前主要需要做的事。</p><p>Vue3简单的说就是把Vue2中分的零零碎碎的代码放在了一起，首先我们回想Vue2中有哪几块代码，data (响应式的属性) methods (基本的代码逻辑)计算属性，还有一个监听属性，生命周期先不考虑，尤大认为这种写法逻辑太过分散，一个数据可能需要要经过三到四个不同的地方,这时候我们就需要在不同的块中找代码，这个一个块里上百行代码是非常常见的。需要跳来跳去的看代码，容易造成关注点混乱。</p><p>组合式写法就是为了解决这种情况，而且组合式的方向对了，没写过React,据说是很像，简单的一点组合式代码提示会更友好，明眼人一看，起码给IDE的计算负担减低不少。不管是JS还是TS。那么学习组合式需要注意什么呢，不要把它想的很难,什么简直都需要重学，实际上就是换了一种写法，定义data变成了ref以及reactive,加上一些奇奇怪怪的语法糖，定义methods,直接定义函数就行了，监听属性，计算属性，都有对应的写法，生命周期随便再看看。Vue3内嵌Html的用法就这些。组件化时加了两个东西一个props以及自定义事件( emit), 这两个东西没怎么变，至少基于JS来说。对于TS这两个变化略多，可以说一种写法一种定义或者声明方式，主要还是这两个东西历史包袱过重。</p><p>Vue3据我目前所了解的，算上旧版本的写法，这种写法不配拥有姓名，所以只能称之为旧版本写法，算上旧版本的写法有四种了。很多啊，我没有兴趣去研究那么多，基于目前来看，<code>&lt;script setup &gt;</code>这种写法应该是最优雅的，尤大官方微博也说了，Vue3 + TS+ setup + Volar &#x3D; 真香。下面主要代码介绍这种写法。</p><p>这种写法不能使用HTML来写，只能使用单文件方式来写，主要看写法</p><h3 id="组件HelloWord"><a href="#组件HelloWord" class="headerlink" title="组件HelloWord"></a>组件HelloWord</h3><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hello<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>&#123;&#123; msg &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>visible<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>是否显示 &#123;&#123; visible &#125;&#125; sumcom = &#123;&#123; sumcom &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>点击抛出事件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ts<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> watch<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> toRefs <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span><span class="token comment">// props,只声明类型时的写法</span><span class="token keyword">const</span> props <span class="token operator">=</span> defineProps<span class="token operator">&lt;</span><span class="token punctuation">&#123;</span>  <span class="token literal-property property">msg</span><span class="token operator">:</span> string  <span class="token literal-property property">visible</span><span class="token operator">:</span> boolean<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// props有默认值时的写法</span><span class="token comment">/* interface Props &#123;  msg?: string  labels?: string[]&#125;const props = withDefaults(defineProps&lt;Props>(), &#123;  msg: 'hello',  labels: () => ['one', 'two']&#125;) */</span><span class="token comment">// end props有默认值时的写法</span><span class="token comment">// 自定义事件,这种写法代码提示十分友好，且在使用组件时的代码提示也十分友好</span><span class="token keyword">const</span> emit <span class="token operator">=</span> defineEmits<span class="token operator">&lt;</span><span class="token punctuation">&#123;</span>  <span class="token punctuation">(</span>e<span class="token operator">:</span> <span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>  <span class="token punctuation">(</span>e<span class="token operator">:</span> <span class="token string">'update'</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 定义一个普普通通方法</span><span class="token keyword">const</span> <span class="token function-variable function">test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 抛出自定义事件，这里的代码提示十分友好，</span>  <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'update'</span><span class="token punctuation">,</span> <span class="token string">'从前从前'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// 响应式</span><span class="token keyword">const</span> sum <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token comment">// 计算属性</span><span class="token keyword">const</span> sumcom <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token parameter">number</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> sum<span class="token punctuation">.</span>value <span class="token operator">*</span> <span class="token number">4</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// 监听</span><span class="token function">watch</span><span class="token punctuation">(</span>sum<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newVal <span class="token operator">+</span> <span class="token string">"----"</span> <span class="token operator">+</span> oldVal<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token function">defineExpose</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token comment">// 导出组件内的东西，给组件外部访问，父组件需要访问子组件内数据时，需要导出，也可以导出函数，</span>  sum<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- Add "scoped" attribute to limit CSS to this component only --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="组件APP"><a href="#组件APP" class="headerlink" title="组件APP"></a>组件APP</h3><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Vue logo<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./assets/logo.png<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HelloWorld</span> <span class="token attr-name">msg</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>欢迎来到你的VUe+TS项目<span class="token punctuation">"</span></span> <span class="token attr-name">:visible</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>flag<span class="token punctuation">"</span></span> <span class="token attr-name">@update</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upd<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>model<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ts<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@vue/reactivity'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> onMounted <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@vue/runtime-core'</span><span class="token punctuation">;</span><span class="token keyword">import</span> HelloWorld <span class="token keyword">from</span> <span class="token string">'./components/HelloWorld.vue'</span><span class="token punctuation">;</span><span class="token keyword">const</span> flag <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token keyword">const</span> upd <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token parameter"><span class="token keyword">void</span></span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>  flag<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token operator">!</span>flag<span class="token punctuation">.</span>value<span class="token punctuation">&#125;</span><span class="token comment">// 暂时只能这样，实际上不报错，但是TS语法会报错，只能这样定义了。</span><span class="token keyword">interface</span> <span class="token class-name">expHello</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">sum</span><span class="token operator">:</span> number<span class="token punctuation">&#125;</span><span class="token comment">// 对应子组件</span><span class="token keyword">const</span> model <span class="token operator">=</span> ref<span class="token operator">&lt;</span>InstanceType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> HelloWorld<span class="token operator">></span> <span class="token operator">&amp;</span> expHello<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 访问子组件里的属性</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>value<span class="token operator">?.</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><span class="token selector">#app</span> <span class="token punctuation">&#123;</span>  <span class="token property">font-family</span><span class="token punctuation">:</span> Avenir<span class="token punctuation">,</span> Helvetica<span class="token punctuation">,</span> Arial<span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>  <span class="token property">-webkit-font-smoothing</span><span class="token punctuation">:</span> antialiased<span class="token punctuation">;</span>  <span class="token property">-moz-osx-font-smoothing</span><span class="token punctuation">:</span> grayscale<span class="token punctuation">;</span>  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>  <span class="token property">color</span><span class="token punctuation">:</span> #2c3e50<span class="token punctuation">;</span>  <span class="token property">margin-top</span><span class="token punctuation">:</span> 60px<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gwo8dswfcpj34mo334e86.jpg" alt="绿色的心"></p>]]></content>
    
    
    <categories>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescipt</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>郭德纲写给儿子郭麒麟的信</title>
    <link href="/2021/11/08/other-04/"/>
    <url>/2021/11/08/other-04/</url>
    
    <content type="html"><![CDATA[<p>甲午年，正月初九，我儿子十八了，正所谓成人长大，学名奇临，取奇妙降临之意，后下海，艺名麒麟，乃仿周大师之遗韵。</p><p>人生一世，极不容易，登天难，求人更难，黄连苦，无钱更苦，江湖险，人心更险，春冰薄，人情更薄。过去有句话，既落江湖内，便是薄命人。我本不愿儿从艺，奈何人自有志无法横拦，但有几句话要说清楚。艺人分几类，种种相隔，一是普通艺人，有一技之长，凭能耐吃饭，一是名演员，知名度高，但不代表艺术高。此类还要两说，一是角儿，何为角儿，舞台上的顶梁柱，剧团班社的灵魂，贴出你的名字要保证卖的出票，全团老少指着你吃饭，角儿是有责任的艺人。</p><p>郭麒麟刚十八，我不希望儿子大红，人红麻烦多，一大三大，名气大后，开销大压力大是非大，红起来容易，难的是接住自己。年三十吃顿饺子容易，之后呢？得天天吃饺子才行啊。可你有那么多面和馅儿吗？所以，要多下功夫，并且要保持一个好的心态，很多人不成功的原因，主要是太尊重自己了。</p><p>一个人刚出道，不狂，没出息，但如果一直狂是肯定没有出息的。你眼中的你和别人眼中的你不是一回事，无限赞美自己只是一种胆怯。我一直认为恐惧到头就是愤怒，发挥无敌想象，给自己描绘了一个童话世界，白衣如雪来去如风，刀光剑影闪过之后，你满脸冷酷独立于珠峰顶端，傲视苍生无比英武，此时我要问的是：孩子，你怎么下去？</p><p>不让古人，是谓有志，不让今人，是谓无良。记住了，小俗便雅，大雅则俗。</p><p>有人夸你，别信，有人骂你，别听。</p><p>周围人随意捧骂，不可与之交，因其无至性也。记住，言语多反复，以防欺诈，忘恩思小过，定会反戈。开口说大义，临大难必变节。逢人称兄弟，即深交也平常。</p><p>此外凡事要慎重。江湖子弟，拿得起来放得下，身边人很重要。一根稻草，扔到街上就是垃圾，捆上白菜就是白菜价，捆上大闸蟹就是大闸蟹价。包括脚下这个平台也极重要。同样是一个人，步行一小时你能走多远？骑车呢？开车呢？坐飞机呢？平台会决定你的速度。且记且记。</p><p>此外钱财要珍惜。但不可看得太重。财乃天地至公之物，假手于人罢了，雨打残花风卷流云，轮番更转而已。穷转富，富转穷，哪有百世富家翁。</p><p>至于交友，吃点亏也无妨，人没所谓，穷通寿夭为命所系，岂不知造物之报施。全视人之自取，芸芸众生富贵贫寒，不是谁都可以傲世乾坤的，其中有命有运。要知因果懂善恶,我儿且记, 但行好事 ，莫问前程。</p><h2 id="封"><a href="#封" class="headerlink" title="封"></a>封</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gw7jy4zpuwj32yo1o0u0x.jpg" alt="刻晴cos原神"></p>]]></content>
    
    
    <categories>
      
      <category>Other</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>springboot事务三两言</title>
    <link href="/2021/11/01/java-04/"/>
    <url>/2021/11/01/java-04/</url>
    
    <content type="html"><![CDATA[<div class="note note-info">            <p>经历是会潜移默化改变人的，连自己都不知道，还以为自己内心永远单纯。</p>          </div><p>聊事务，先明白什么是事务，举个烂大街的例子，银行转账，转出方减钱，转入方加钱。这种情况下是不允许其中一个环节单独失败的，但是这种情况又必须执行两次以上的数据库操作语句，保证语句执行结果的一致性功能就是事务功能。</p><p>现在的关系型数据库大多都支持事务控制，事务的四大特性，我还真记不太清，原子性，隔离性，一致性，还有一个特性是什么来着，我查查，查到了，还有一个持久性。持久性没啥好说的，我就记不住。原子性，一致性，这个都好理解，就是都成功或者都失败。隔离性，这个就需要注意一点。具体情况具体处理。理论知识就不赘述了。</p><p>接下来进入下一话题，《母猪的产后护理》，对不起，拿错书了，</p><p>介绍一下spring提供的事务控制，分为编程式和声明式，先说我们用的多的声明式事务控制，且不建议使用编程式的事务控制，springboot2.5.x系列默认就开启了注解式事务控制，只需要在类上或方法上加上<code>@Transactional</code>注解就可以了，加在类上，表示此类中的所有方法都添加了默认的事务支持，如果 类上和方法上同时加了注解，以方法上的注解为准。只要方法抛出了RuntimeException，事务就进行回滚的操作，但如果你把异常try catch了，且没有在catch块里抛出RuntimeException，这种情况下出现异常事务是不会进行回滚的。</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceA</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Transactional</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// 这种情况下出现异常是不会进行事务回滚的。</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token function">updateById</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>                <span class="token comment">// 会进行事务回滚的写法</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token function">updateById</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"测试"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="详解-Transactional注解"><a href="#详解-Transactional注解" class="headerlink" title="详解@Transactional注解"></a>详解@Transactional注解</h2><h3 id="rollbackFor参数"><a href="#rollbackFor参数" class="headerlink" title="rollbackFor参数"></a>rollbackFor参数</h3><p>这个参数是表明捕获什么异常进行回滚数据的。默认只有捕获到RuntimeException和Error才会进行回滚，（基于springboot2.5.x，不同版本可能有差异，请自己查看代码。）不会回滚的是什么异常呢，就是那种需要声明的异常，springboot事务控制是不会捕获到，并回滚数据的，至于为啥，很简单啊，因为声明的异常，大多都是自己手动处理的，继续往上抛或者Try Catch一下，如果不手动处理，程序无法编译。比如IO异常，这些是不会被事务控制捕捉到的。</p><h3 id="propagation参数"><a href="#propagation参数" class="headerlink" title="propagation参数"></a>propagation参数</h3><p>propagation 代表事务的传播行为，默认值为<code>Propagation.REQUIRED</code>，其他的属性信息如下：</p><ul><li><p><code>Propagation.REQUIRED</code>：如果当前存在事务，则加入该事务，如果当前不存在事务，则创建一个新的事务。( 也就是说如果A方法和B方法都添加了注解，在默认传播模式下，A方法内部调用B方法，会把两个方法的事务合并为一个事务 ）</p></li><li><p><code>Propagation.SUPPORTS</code>：如果当前存在事务，则加入该事务；如果当前不存在事务，则以非事务的方式继续运行。</p></li><li><p><code>Propagation.MANDATORY</code>：如果当前存在事务，则加入该事务；如果当前不存在事务，则抛出异常。</p></li><li><p><code>Propagation.REQUIRES_NEW</code>：重新创建一个新的事务，如果当前存在事务，暂停当前的事务。( 当类A中的 a 方法用默认Propagation.REQUIRED模式，类B中的 b方法加上采用 Propagation.REQUIRES_NEW模式，然后在 a 方法中调用 b方法操作数据库，然而 a方法抛出异常后，b方法并没有进行回滚，因为Propagation.REQUIRES_NEW会暂停 a方法的事务 )</p></li></ul><p>-<code>Propagation.NOT_SUPPORTED</code>：以非事务的方式运行，如果当前存在事务，暂停当前的事务。</p><ul><li><p><code>Propagation.NEVER</code>：以非事务的方式运行，如果当前存在事务，则抛出异常。</p></li><li><p><code>Propagation.NESTED</code> ：和 Propagation.REQUIRED 效果一样。</p></li></ul><p>更多参数可以百度了解。</p><h2 id="实际的问题"><a href="#实际的问题" class="headerlink" title="实际的问题"></a>实际的问题</h2><p>本人处理一些银行账务动账信息时，比如一个记账操作时，我需要把需要记账的数据的状态先改成在处理的状态，且需要提交事务，且需要确定下一个事务开启时需要记账的数据状态已经是修改过后的状态，防止重复操作同一笔数据，那么问题就来了，在使用spring声明事务控制时，如何进行这样的操作。</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceA</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Transactional</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// 检查数据状态是否处于正常状态，如果在处理中就不进行操作</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">==</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>          log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"此数据正在修改中，无法操作"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// 先更新一下状态</span>        <span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 此时需要提交</span>        <span class="token comment">// 下面进行一些耗时的操作，</span>        <span class="token comment">//操作结束后,还需进行一些需要事务控制的操作</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>这种情况就默认的事务控制一个方法内只能有一个事务，所以中间那步的提交操作以我的解决方式，既然一个方法只能有一个事务，那我把逻辑单独提一个方法不就行了，说干就干，这是修改后的代码。</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceA</span><span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Transactional</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTest2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// 先更新一下状态</span>        <span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Transactional</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// 检查数据状态是否处于正常状态，如果在处理中就不进行操作</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">==</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>          log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"此数据正在修改中，无法操作"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// 先更新一下状态</span>        <span class="token comment">// setStatus("2");</span>        <span class="token comment">// 调用方法</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setTest2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 此时需要提交</span>        <span class="token comment">// 下面进行一些耗时的操作，</span>        <span class="token comment">//操作结束后,还需进行一些需要事务控制的操作</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>这个时候信心满满的操作发现setTest2方法调用过后，发现还是只有一个事务，且setTest2的更新操作还是没有分开提交，原因是，JDK的动态代理。在SpringIoC容器中返回的调用的对象是代理对象而不是真实的对象，只有被动态代理直接调用的才会产生事务。这里的this是自身是真实对象而不是代理对象，问题到这里已经很明朗了，这样啊，既然this调用的话事务不能起作用，spring最擅长的不就是注入，我注入一个，然后代码如下。</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceA</span><span class="token punctuation">&#123;</span>  <span class="token comment">// 这是我注入的，实际就是从容器里面取出自己的代理类</span>    <span class="token annotation punctuation">@Resource</span>    <span class="token class-name">ServiceA</span> serviceA<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Transactional</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTest2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// 先更新一下状态</span>        <span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Transactional</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// 检查数据状态是否处于正常状态，如果在处理中就不进行操作</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">==</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>          log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"此数据正在修改中，无法操作"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// 先更新一下状态</span>        <span class="token comment">// setStatus("2");</span>        <span class="token comment">// 调用方法</span>        <span class="token comment">// this.setTest2();</span>        <span class="token comment">// 使用注入的对象调用方法，就能触发事务了，</span>        serviceA<span class="token punctuation">.</span><span class="token function">setTest2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 此时需要提交</span>        <span class="token comment">// 下面进行一些耗时的操作，</span>        <span class="token comment">//操作结束后,还需进行一些需要事务控制的操作</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>到这步，心里想着应该就可以了，但实际上还是不行，这个时候我们就要看这个了<a href="#propagation%E5%8F%82%E6%95%B0">注解</a>，默认的规则是</p><div class="note note-info">            <p>如果当前存在事务，则加入该事务，如果当前不存在事务，则创建一个新的事务。</p>          </div><p>很显然这个不是我想要的，因为我就是需要两个事务分别提交，你还给我加入同一个事务里，闹呢，一个一个看，配置事务的隔离性配置为<code>Propagation.REQUIRES_NEW</code>。</p><div class="note note-info">            <p><code>REQUIRES_NEW</code>，重新创建一个新的事务，如果当前存在事务，暂停当前的事务。且新增的事务处理完成后在处理当前的事务</p>          </div><p>代码如下</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceA</span><span class="token punctuation">&#123;</span>   <span class="token annotation punctuation">@Resource</span>    <span class="token class-name">ServiceA</span> serviceA<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span>REQUIRES_NEW<span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTest2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// 先更新一下状态</span>        <span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Transactional</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// 检查数据状态是否处于正常状态，如果在处理中就不进行操作</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>status <span class="token operator">==</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>          log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"此数据正在修改中，无法操作"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// 先更新一下状态</span>        <span class="token comment">// setStatus("2");</span>        <span class="token comment">// 调用方法</span>        <span class="token comment">// this.setTest2();</span>        <span class="token comment">// 使用注入的对象调用方法，就能触发事务了，</span>        serviceA<span class="token punctuation">.</span><span class="token function">setTest2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 此时需要提交</span>        <span class="token comment">// 下面进行一些耗时的操作，</span>        <span class="token comment">//操作结束后,还需进行一些需要事务控制的操作</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>注意看控制台，应该会出现两个事务，这个时候我的需求就算是完成了。给你带来方便的事务总会多多少少给你带来些许的不便，这些不便的地方叫做规则，因为你用了别人开发的技术，你就需要研究和遵守别人的定下的规则。一开始可能会让你束手束脚的，但是一旦你掌握了规则，你的编码能力会得到大大的提升。</p><h2 id="手动控制事务"><a href="#手动控制事务" class="headerlink" title="手动控制事务"></a>手动控制事务</h2><p>不建议使用，在一些特殊的场景里可以使用，如多线程的情况下，直接看代码</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 需要注入的对象</span><span class="token annotation punctuation">@Autowired</span><span class="token keyword">private</span> <span class="token class-name">DataSourceTransactionManager</span> dataSourceTransactionManager<span class="token punctuation">;</span><span class="token annotation punctuation">@Autowired</span><span class="token keyword">private</span> <span class="token class-name">TransactionDefinition</span> transactionDefinition<span class="token punctuation">;</span><span class="token comment">// 开启事务</span><span class="token class-name">TransactionStatus</span> transactionStatus<span class="token operator">=</span>dataSourceTransactionManager<span class="token punctuation">.</span><span class="token function">getTransaction</span><span class="token punctuation">(</span>transactionDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 提交事务</span>dataSourceTransactionManager<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span>transactionStatus<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 回滚事务</span>dataSourceTransactionManager<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span>transactionStatus<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>具体使用方法根据自己的业务来编写代码就可以了</p><h2 id="封"><a href="#封" class="headerlink" title="封"></a>封</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gw5ui05viuj33341wo1kz.jpg" alt="女孩子 风景 外廊 冬景色 夕阳 晚霞"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>spring</tag>
      
      <tag>事务控制</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>springboot打包二三事</title>
    <link href="/2021/10/20/java-03/"/>
    <url>/2021/10/20/java-03/</url>
    
    <content type="html"><![CDATA[<div class="note note-info">            <p>爱情是两个强者之间的风花雪月，而不是弱者之间的苦大仇深。</p>          </div><p>简单的打包，无需多言吧，idea里面直接点点点就行。可惜凡事大都不能按照我们预期的那样。总有一些奇奇怪怪的需求，会让你头痛一会，但是遇到问题也不用慌，实际我们遇到的大多问题，网上一搜一大票解决方法，然后自己根据自己的经验从里面找到自己想要的结果就行。</p><p>springboot打包默认的情况下打完包后会进行一次测试，所谓测试就是启停一下项目，自己测试打包玩的时候，感觉并无大碍，最多只是拖慢一点打包速度。但实际上打包的线上配置很难和打包环境做到一致，就是说你用线上的配置打包项目，项目大多数情况下都是跑不起来的，那么这个默认的测试步骤就没啥用，一般我们都是关闭的。</p><h2 id="关闭打包的测试配置"><a href="#关闭打包的测试配置" class="headerlink" title="关闭打包的测试配置"></a>关闭打包的测试配置</h2><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- 跳过测试 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>skipTests</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>skipTests</span><span class="token punctuation">></span></span>    ...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>继续聊，Java项目的依赖管理工具，如Maven，又或者Gradle，给我们带来了方便的同时也有了一点点的小限制，实际上并不能称作为限制，只是需求太诡异吧，比如本程序员就遇到过，项目新旧碰撞，有一个依赖及其古老，多老不清楚，Maven中央仓库里已经找不到这个版本了，又不敢用别的依赖替换，那怎么办，项目怎么跑起来呢，大部分IDE工具玩的熟的人，知道怎么弄，手动添加classpath路径，不同IDE有不同的操作方法，不细说。知道这步的，项目开发调试运行没有问题了，但是，我既然都说了，问题肯定还没解决。开发的差不多了，打包发布，一上线，咋报错了呢，一般缺少依赖时，如果你启动过程中没有用到这个依赖，它不会报错，当你执行方法过程中某个类中用到了这个依赖，它才会报错。为啥报错呢，首先我们看异常，我也记不太清，依赖缺失的异常叫什么ClassNotFund什么之类的异常，单词记得不清楚，中式英语２级水平的我翻译就是找不到类异常。这时，对于SpringBoot打的包熟悉的人已经开始查看包里是否有问题，简单看一下，定位到问题了，我们手动添加的依赖，并不能被SpringBoot打包打进去，那怎么办呢。到也不难，既然maven中的依赖能打包进去，我们把依赖在Maven中配一下就行了呗。</p><h2 id="Maven在pom中加载本地依赖方法"><a href="#Maven在pom中加载本地依赖方法" class="headerlink" title="Maven在pom中加载本地依赖方法"></a>Maven在pom中加载本地依赖方法</h2><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.oracle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span> <span class="token comment">&lt;!-- 这个随便填，一般用倒写域名的方式吧--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>ojdbc10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- 这个同样随便填，上面加这个内容要保证全球唯一，所以一般都用域名来写--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- 随便写 --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>system<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span><span class="token comment">&lt;!-- 不懂，请搜索Maven依赖scope标签做什么的--></span>    <span class="token comment">&lt;!-- 核心：$&#123;project.basedir&#125;指项目根路径， /lib/ojdbc10.jar，一般我是在项目根庐江下新建一个lib文件夹，里面放jar包即可。--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>systemPath</span><span class="token punctuation">></span></span>$&#123;project.basedir&#125;/lib/ojdbc10.jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>systemPath</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- 将SystemScope配置的依赖打包到构建包中 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includeSystemScope</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includeSystemScope</span><span class="token punctuation">></span></span>        ...    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>    ...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>继续说吧，这两种以及涵盖了百分之八十以上情况，继续说打包，springboot的打包，很方便，一个整体的Jar包，一行命令就能直接运行启动，很不错。 在一些场景下，就是在你不方便访问线上测试的环境下，一个五六十兆的jar上传将及其麻烦，尤其是在线上测试的时候，实际上每次就更新几个文件，线上部署却依然需要上传很大的依赖，这种情况下，依赖和Jar包分开打包就显得十分有必要了。</p><h2 id="SpringBoot项目Jar包依赖分离打包"><a href="#SpringBoot项目Jar包依赖分离打包" class="headerlink" title="SpringBoot项目Jar包依赖分离打包"></a>SpringBoot项目Jar包依赖分离打包</h2><p>这个需要几个步骤，首先我们按正常的方式默认打包一下，把正常的打包的Jar包中的lib文件夹粘贴出来，然后配置pom文件</p><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>    ...        <span class="token comment">&lt;!--这里对应项目的主入口--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mainClass</span><span class="token punctuation">></span></span>com.jy.frame.BootApplication<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mainClass</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span><span class="token punctuation">></span></span>ZIP<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>nothing<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>nothing<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>    ...    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">></span></span>repackage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--end--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>配置完成后重新打包得到的就是没有依赖的Jar包了，把Jar和上面拷出来的lib文件夹放在同一目录，运行的命令需要加上lib目录</p><figure><div class="code-wrapper"><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">java -jar -Dloader.path&#x3D;.&#x2F;lib 打出来的Jar包名.jar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><h2 id="封"><a href="#封" class="headerlink" title="封"></a>封</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gvlxsfazirj62yo1o01l002.jpg" alt="短发女孩"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>maven</tag>
      
      <tag>package</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>关于技术</title>
    <link href="/2021/10/13/gossip-02/"/>
    <url>/2021/10/13/gossip-02/</url>
    
    <content type="html"><![CDATA[<div class="note note-info">            <p>理性的思维并不比感性的思维要高级，我们灵魂的画像上也绝不应该只存在某一种色彩。</p>          </div><p>自认为对技术有着无限的热爱，赚钱只是顺带，解决问题对我来说，比赚钱更有意思，赚钱能力，只是证明一下，自己不是废材就够了，</p><p>宏图大志也没有，苟且偷生到也不屑。想自在，为自己而活，可是啊，人就不能完全的为自己而活啊，否则那就是自私。转念一想自在两个字说难也难，说简单也简单。简单的方式，赚点钱给父母养老，然后咱们那就五台山山上见；难的方式，花样就多了，房子，车子，票子，女子，我是一个子都没有啊😅😅</p><p>知乎上看到一个问题，当你发现你引以为豪的技术其实只是工具而已，你会感到悲哀吗</p><p>我需要感到悲哀嘛，技术本身就是工具，只是解决问题的一种更高级的做法，人类从石器时代，到青铜时代，再到现在的钢铁时代，技术和工具是相辅相成的。工具是技术，技术是工具，这并不重要，重要的是能不能巧妙的解决问题。</p><p>有次搞个Java的Springboot项目，往前端进行Json格式转换的时候，发现属性的大写首字母变小写了，这极大的不方便前后一致性，太艹蛋了。属性名JSON化时竟然会有变化，感觉Java的很多框架开发者有点死脑筋，命名规范这玩意就是个规范，你做框架底层没必要越厨代庖，强制采用这些规范。做底层的东西就要把自由度留给使用人员，别人才好在此基础上扩展。虽然可以通过一些注解什么的解决问题，但浪费很多时间。整体上来说，无论是Java的一些框架还是语法本身都为了规范牺牲了太多的自由度，很多时候都是做些没有什么技术含量的东西。</p><p>智能IDE，智能编程语言的飞速发展，让我感觉现在这个编程的门槛真的是低到没话说，但是啊，编程的规范，工具和语言可以帮你做到，但是编程的灵魂，思想，就不是一时半会能够形成的。并不能说你精通编码，就能写出任何东西。一个简单的权限框架，如果你不知道或者不理解一些简单的如RBAC权限模型，只会用if和else来写，你感觉这可能嘛，就算能，写出来的代码也是一个天坑，每加一个权限你就要多写一个if,这是噩梦一样的代码。不管你砌砖你砌的的多好，只会砌砖是建不出摩天大楼的。</p><p>说回编程语言，我对编程语言很是感兴趣，我喜欢研究不同类型的语言，动态语言，静态语言，弱类型，强类型。Java，Javascript等等，对于JS这个语言很奇怪，我有点搞不太明白，动态语言花样太多了，一个this的指向问题，就能让人头痛很久，还有闭包，JS的作用域可以说是诡异到让人难以接受。回调函数，我到现在都不是很懂回调函数的操作原理，怎么能把值传进函数的参数里面，这对于我学Java入门的我来说，这种操作这太不可思议了。我还得学习。判断自己对JS的掌握程度，可以去看Jquery的源码，Jquery实际上算不上框架，更多只是一个JS的语法糖工具，如果能看懂里面一些花里胡哨的操作，那么你的JS水平实际上已经很可以了，对于JS这门语言，又爱又恨。后来又了解了TS，对于前端我是很疑惑的，因为现在没有一个标准，前端开发有JS党，而现在一些框架又转而拥抱TS，Ts类型语言需要IDE的支持才能发挥出静态类型的优势，而VSCode，虽说是使用TS开发的，但是语法提示并不是那么友好，起码给我的感觉不是那么友好。框架虽多，但要记住，原生JS的才是你的立身之本啊。框架可能会过时，原生JS也有可会过时，但相较框架来说概率极低。</p><p>Kotlin，算是一个智能语言，这语言对于自然语言十分友好，带来的副作用就是，编译成机器语言时有点慢。智能，符合编程语言的设计哲学，怎么说呢，谁用这个语言，写出来的代码基本都是十分符合编程规范的代码，面向对象语言的设计规则是被它给玩明白了。Kotlin和Java一样是jvm语言，和Ts对应JS一样，Ts里面是适应JS的，Kotlin里也是能写Java的。这是一种包容的哲学吧。</p><p>Java，springboot3.0最低的JDK版本为17.0，一些固守Java8 的企业和公司，你发任你发呗。技术是需要创新的，Java不是没有发展，而是发展了一直没人用，不停的吐槽Jdk8的槽点，然后造一些轮子，实际上一些痛点，以及轮子，Java新特性中已经有了，比如大家常用的Lombok插件，JDK17中已经不需要这个插件了，看过每个版本的新特性介绍，忘了，我不喜欢用Lombok所以我对这个特性我记得比较清楚。其他的性能，多线程，GC等等优化，这个我不是太懂，也不需要懂，程序跑的动，跑得快，跑的稳就行。</p><p>实际上每种语言类型里你学一种就行了，因为同类型的语言差不多，编程语言本质就三个东西，变量，循环和条件控制。我经常调侃人，一个编程语言我会定义变量，会if,会for,就已经掌握核心技巧了，至于方法和函数，这两个实际上是一个东西，这个应该很简单，不管写法怎么变，核心在那，管你怎么变。参数值，返回值，访问域控制，这些东西不会变吧。</p><p>AOP，面向切面编程，这个编程思想上的不一样了，一般都用来弥补面向对象上的一些不足之处，在不改变源码的情况下，做一些增强操作。如果不考虑多人开发，这个玩法就多了去了，你甚至可以根据方法名或函数名来进行增强操作。考虑多人开发，那就老老实实的加注解吧。</p><h2 id="封"><a href="#封" class="headerlink" title="封"></a>封</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gvdvmcqdh6j631a1uonpd02.jpg" alt="女子,夜景"></p>]]></content>
    
    
    <categories>
      
      <category>碎碎念</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
      <tag>技术</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>想到什么就说些什么</title>
    <link href="/2021/10/10/other-03/"/>
    <url>/2021/10/10/other-03/</url>
    
    <content type="html"><![CDATA[<p>声音，气味，触觉，它们是可以承载记忆的，一些歌，一些香水的味道，一个不经意的动作。苦难会放大人的感官。类似于心理学中的吊桥效应，但远远比吊桥效应来的更真实，研究心理学的人大多偏执且傲慢，我不喜欢看这玩意，这东西学多了，就没人味了，同销冠，被越来越多人理解的偏见，就不是偏见了，比如大家一提到温州人，第一反应大多都是，靠，有钱人。</p><p>我上初中的时候就住校了，我是一个农村娃娃，当时刚上初中，班上的女同学她们都好厉害的，我玩不过她们，我的性格不是很好，可以说有点臭了，没人可以说教我，不喜欢女老师，除非是我自己想做，否则我只会和你对着干。以现在的我往回看那时的我，多酷啊，简直酷到没朋友。哈哈哈，男人至死是少年。</p><p>我听到一些上面说的苦难时期听的歌，脑海中会控制不住浮现当时的画面，初二上学期，寒冬，手里钱又不多，在校园里飘荡，晚自习教室也没空调，我记得最清楚的就是我们教学楼和宿舍之间有个巷子，那里面的风，怎么说呢，就是每次路过都会说一句，艹，好冷！宿舍里面也没有热水，只能靠一个暖水瓶到食堂里面打点热水，五毛钱一瓶，对当时的我来说，好贵！！有时水放时间长了，不热了，泡面泡不开，就多泡几遍，就是泡一遍把水倒掉，然后继续泡。哈哈当时经典点的娱乐活动就是在外面买点熟食，回到宿舍，在阳台把桌子一摆，喝点啤酒，打打纸牌，下下象棋，这些活动一般都是放假的前一晚。回想起来，到也丰富了回忆。</p><p>大家对花露水的味道应该很熟悉，以前有个人觉得花露水的味道很好闻，我当时表情记不清了，宝藏啊，就是这种感觉吧。乃至于我到现在闻到花露水的气味，便能想到她坐在被窝里的画面，我问她屋子里什么味，她眼睛里好像有小星星一样闪闪发光看着我说，这是花露水的气味啊，你不觉得很好闻嘛。我点点头。</p><p>我不耐寒，简单来说就是怕冷，去年的这个时候，当时的那份工作每天上班下班我需要走十几分钟的路才能到家，路上我习惯听听歌，打开网抑云，《修炼爱情》，《怎么了》，以至于现在我听到这两首歌，我就能想到那个时候，可能是寒冷放大了我当时的感官，形成了永久记忆吧。</p><p>公交站台，红绿灯，电梯，路边摊，路上的流浪狗，出租屋，这些零零散散的东西构成了我当时生活的全部，然后一种由心而生的落寞感控制不住的向我袭来，我现在想到，我到了这个时候还是一样。</p><div class="note note-info">            <p>我们听歌的时候，其实暴露的大都不过是小情绪而已，所谓小情绪，就是并不会对生活造成实质性影响的，反正轨迹不会变。是吧，是我们是什么样的人决定了我们听什么样的歌，而不是听什么样的歌决定我们是什么样的人^_^，不要沉溺于小情绪之中，乖啊。</p><p>这一路时光温柔也好，坎坷崎岖也罢，总得向前。</p>          </div><h2 id="封"><a href="#封" class="headerlink" title="封"></a>封</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gopbvuf16wj32yo1o0e84.jpg" alt="程潇"></p>]]></content>
    
    
    <categories>
      
      <category>Other</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>那时我还不明白</title>
    <link href="/2021/09/23/other-02/"/>
    <url>/2021/09/23/other-02/</url>
    
    <content type="html"><![CDATA[<p>中秋节，团圆夜，三天假期，我也是回了一趟老家，上次回家是端午节，农历五月初五到八月十五，三个月没有回家了，上班，下班，周末，没有暑假的夏天过的飞快。</p><p>下了车，到家门口，在回家的路上通过家里安装的网络摄像头，在手机上我便看到了家里多了两只小狗，果不其然，刚踏进院子，汪汪汪，狗子便一颠一颠的跑出来，奶奶听见狗叫，嗯?狗叫? ?也很自然的出来了，回家的感觉，别的感觉说出不来，就是一种安心的感觉，家里平时只有爷爷奶奶在家，人不多，少了点生气，屋子里的角角落落，到是生了不少蜘蛛网，问题不大，生物除虫，两个字环保，我到也不忍心打扰它们的安宁。家里一只猫，也养了好长时间了。估计也过了一大半的猫生了。猫生不易，且喵且珍惜。</p><p>回家习惯般的把书包往楼梯扶手一挂，方便上楼时带着，不经意看了一眼上面的灰尘，我确实很长时间没回家了。</p><p>人们习惯说下次再见，下次再见，总以为未来很长，殊不知人与人之间是见一面少一面的，你不知道的哪次见面，也许是一个风和日丽的午后，你站在月台上送他上车，目送他离去。你自己也没有想到，至此，你就再也没有见过他了。</p><p>和奶奶聊天，邻里邻外，我奶奶的年纪聊天聊的多是这个走了，那个走了，说罢，奶奶很自然的来一句，人活这一辈子，没意思。我也不懂，奶奶说的人中，有一个我有印象，去年过年的时候，还来我家做客，觥筹交错的光影里我还记得他的样子，世事无常，不知道作何感想，或需要有何感想。</p><p>世俗眼中，不管男女，三四十岁的年纪没有家室，是有问题的，我也难免落俗。以前的成家立业的习俗放在现代好像不合适了，在社会方方面面的潜移默化中，或是电视剧，或是电影中，你没有业，是不配拥有爱情的。国内的绝大部分电视剧中男主或女主必须要有一个有钱的，不然导演不会拍。</p><p>可现实是，事业尚未有起色，家乡难以割舍又难以融入，谈婚论嫁己至眼前。</p><h2 id="封"><a href="#封" class="headerlink" title="封"></a>封</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gntu80rs7nj30xc0gxn7b.jpg" alt="粉红"></p>]]></content>
    
    
    <categories>
      
      <category>Other</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vue3加TS使用Class写法</title>
    <link href="/2021/09/01/vue-01/"/>
    <url>/2021/09/01/vue-01/</url>
    
    <content type="html"><![CDATA[<div class="note note-info">            <p>这种写法提案貌似被取消了，GitHub上也停留在rc1版本了，已经一年左右没有提交代码了，确实用Class写Vue确实有点奇怪，现在有更优的选择，如<code>&lt;script setup&gt;</code>写法,博客里面对Vuex，以及Vue-Router的封装还可以用，Class的写法不提倡使用了。</p>          </div><p>总在盼望，总在失望，日子还不都这样。代码也需要雅俗共赏，博客亦如此。</p><p>鄙人不善前端，但是又会一点，近日后端写的乏味，便拎起前端端详端详，一日不见如隔三秋的Vue，让我感觉到生疏，Vue3的语法奇奇怪怪，官网上的写法，我是并不能很理解，或者说就是不易于后端程序员理解，加上Ts这个JS的类型系统语言，让我深深的感觉到，眉眼不如初，让我怎敢相认。</p><p>但是光说不练，是很难体会到其中的玄妙的，我便开始了时隔好多月的Vue3重逢之旅。</p><p>打开VsCode,打开终端，输入vue create vue3_demo。一顿框选，主要记得要选择Vue3以及TS的支持。之后，看着进度条，不停在变动，嘴角疯狂上扬，邪魅一笑，还是内味。</p><p>进度条加载完毕，VsCode,文件-&gt; 将文件夹添加到工作区，打开终端，yarn run serve，回车，嘴角继续疯狂上扬，</p><p>绿色的美好提示<code>Compiled successfully</code>，项目成功启动，复制url, 浏览器打开，回来了，他们都回来了。</p><p>娴熟的打开<code>Home.vue</code>让我看看,这几月没见，变成什么样了。</p><figure><div class="code-wrapper"><pre class="line-numbers language-typescipt" data-language="typescipt"><code class="language-typescipt">import &#123; Vue &#125; from &#39;vue-class-component&#39;export default class Home extends Vue &#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div></figure><p>看到了这两行代码，让我陷入了深思，嗯，这啥玩意，最佳实践嘛，本着实践的态度，试试基本的文档中的新语法，不过有一说一我甚至不知道，新语法的代码我甚至不知道往哪里写，这tm不是欺负老实人嘛。程序员嘛，喜欢学习，搜索<code>vue-class-component</code>，原来是以类的方式写代码啊，Over，Java入门的我写起TS到也不觉得生疏，语法虽有区别，但理念都是一样的。声明变量时需要声明属性，定义方法时需要规定入参格式和返回值格式。况且Ts更多的时候只是一种约束，并不是一种规则。这句话很重要，还记得SpringBoot的一个经典理论，约束大于规则。编程的哲学是通用的。</p><p>大致知道了怎么写之后，容我新起一行，坑就如约而至，父子组件传值的时候，我不知道props在什么地方写，还有监听属性等等。这些问题待我一一解答</p><h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><p>Vue3加Ts必须，VueRouter和Vuex，一般来说项目中都会用到，就都加上。</p><p>我建议不启用代码质量检查和ESlint，原因，Vue3和ts能很好的兼容，在<code>vue-class-component</code>的加持下，实际项目中可能百分之九十九的代码都是使用TS编写，Ts天生就有静态检查，再使用EsLint，在开发中反倒是有点徒增功耗。</p><p>在Vue的可视化项目创建平台中，勾选这几项就行。如图所示，我并没有打算写保姆教程。<br><img src="https://snimg.jamyido.top/large/005NNTS5ly1gu201nkgakj30ny04xgmh.jpg" alt="创建项目"></p><p>路由模式，主要分为两种一种是带<code>#</code>的还有一种就是不带的，看个人喜好，我不讨厌这个<code>#</code>。默认就是带的。css预处理器编译，一般都是选用node-sass。就选这个就行了。</p><h3 id="第三方库和CSS组件"><a href="#第三方库和CSS组件" class="headerlink" title="第三方库和CSS组件"></a>第三方库和CSS组件</h3><p>第三方组件：<a href="https://element-plus.gitee.io/#/zh-CN">element-plus</a>这个组件库在写后台管理系统的时候比较好用，更多的时候是提供一个组件，并不能用来写样式。而且我是打算写一个差不多的前台内容系统，考虑到暗黑模式的兼容，我并不能直接开箱即用里面的组件。</p><p>CSS框架：<a href="https://windicss.org/">Windi CSS</a>，被称作为下一代的CSS框架，天然支持暗黑模式，弥补上面组件库样式的不足，而且写起来很舒服。</p><p>Jquery：<a href="https://jquery.com/">JQ</a>这个会引起一点争议，不要提到Jquery就是什么过时啦，都是上个世纪的东西了。Jq一直在更新，Jq适配了Ts, Jq的兼容性很好，JQuery和Vue能一起使用。虽说感觉会很low，但是能抓到老鼠的猫就是好猫，主要原因还是，鄙人不善前端！！。</p><p>为了实现一个多行文本输入高度自适应，嗯，就是很尴尬的那种。挺难的，Element实现方式的源码我看了，有点看不懂，直接用Jquery能实现，但是不完美，就是为了追求我认为的完美，挺难的。</p><p>Axios：用来通信，性能优异，好处多多。</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>packegt.json</p><figure><div class="code-wrapper"><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ql_blog"</span><span class="token punctuation">,</span>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.1.0"</span><span class="token punctuation">,</span>  <span class="token property">"private"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"serve"</span><span class="token operator">:</span> <span class="token string">"vue-cli-service serve"</span><span class="token punctuation">,</span>    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"vue-cli-service build"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"@element-plus/icons"</span><span class="token operator">:</span> <span class="token string">"^0.0.11"</span><span class="token punctuation">,</span>    <span class="token property">"@types/jquery"</span><span class="token operator">:</span> <span class="token string">"^3.5.6"</span><span class="token punctuation">,</span>    <span class="token property">"axios"</span><span class="token operator">:</span> <span class="token string">"^0.21.1"</span><span class="token punctuation">,</span>    <span class="token property">"core-js"</span><span class="token operator">:</span> <span class="token string">"^3.6.5"</span><span class="token punctuation">,</span>    <span class="token property">"element-plus"</span><span class="token operator">:</span> <span class="token string">"^1.1.0-beta.8"</span><span class="token punctuation">,</span>    <span class="token property">"jquery"</span><span class="token operator">:</span> <span class="token string">"^3.6.0"</span><span class="token punctuation">,</span>    <span class="token property">"vue"</span><span class="token operator">:</span> <span class="token string">"^3.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"vue-class-component"</span><span class="token operator">:</span> <span class="token string">"^8.0.0-0"</span><span class="token punctuation">,</span>    <span class="token property">"vue-router"</span><span class="token operator">:</span> <span class="token string">"^4.0.0-0"</span><span class="token punctuation">,</span>    <span class="token property">"vuex"</span><span class="token operator">:</span> <span class="token string">"^4.0.0-0"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"@vue/cli-plugin-babel"</span><span class="token operator">:</span> <span class="token string">"~4.5.0"</span><span class="token punctuation">,</span>    <span class="token property">"@vue/cli-plugin-router"</span><span class="token operator">:</span> <span class="token string">"~4.5.0"</span><span class="token punctuation">,</span>    <span class="token property">"@vue/cli-plugin-typescript"</span><span class="token operator">:</span> <span class="token string">"~4.5.0"</span><span class="token punctuation">,</span>    <span class="token property">"@vue/cli-plugin-vuex"</span><span class="token operator">:</span> <span class="token string">"~4.5.0"</span><span class="token punctuation">,</span>    <span class="token property">"@vue/cli-service"</span><span class="token operator">:</span> <span class="token string">"~4.5.0"</span><span class="token punctuation">,</span>    <span class="token property">"@vue/compiler-sfc"</span><span class="token operator">:</span> <span class="token string">"^3.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"node-sass"</span><span class="token operator">:</span> <span class="token string">"^4.12.0"</span><span class="token punctuation">,</span>    <span class="token property">"sass-loader"</span><span class="token operator">:</span> <span class="token string">"^8.0.2"</span><span class="token punctuation">,</span>    <span class="token property">"typescript"</span><span class="token operator">:</span> <span class="token string">"~4.1.5"</span><span class="token punctuation">,</span>    <span class="token property">"vue-cli-plugin-windicss"</span><span class="token operator">:</span> <span class="token string">"~1.0.4"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"browserslist"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token string">"> 1%"</span><span class="token punctuation">,</span>    <span class="token string">"last 2 versions"</span><span class="token punctuation">,</span>    <span class="token string">"not dead"</span>  <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="引入Jquery"><a href="#引入Jquery" class="headerlink" title="引入Jquery"></a>引入Jquery</h3><p>项目根目录中有的话添加里面的内容即可，没有的话直接新建即可。</p><p>vue.config.js</p><figure><div class="code-wrapper"><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token comment">// 这里只列一部分，具体配置参考文档</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 开发服务器代理</span>  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token string-property property">'^/api'</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">'http://localhost:8001'</span><span class="token punctuation">,</span>        <span class="token literal-property property">ws</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token literal-property property">changeOrigin</span><span class="token operator">:</span> <span class="token boolean">true</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">configureWebpack</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token comment">// 引入Jquery</span>      <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token literal-property property">$</span><span class="token operator">:</span> <span class="token string">'jquery'</span><span class="token punctuation">,</span>        <span class="token literal-property property">jQuery</span><span class="token operator">:</span> <span class="token string">'jquery'</span><span class="token punctuation">,</span>        <span class="token string-property property">'windows.jQuery'</span><span class="token operator">:</span> <span class="token string">'jquery'</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="axios简单的封装"><a href="#axios简单的封装" class="headerlink" title="axios简单的封装"></a>axios简单的封装</h3><figure><div class="code-wrapper"><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> axios<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> AxiosInstance<span class="token punctuation">,</span> AxiosRequestConfig<span class="token punctuation">,</span> AxiosResponse <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span><span class="token keyword">import</span> qs <span class="token keyword">from</span> <span class="token string">'qs'</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ElMessage <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'element-plus'</span><span class="token keyword">let</span> axiosInstance<span class="token operator">:</span> AxiosInstance <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  baseURL<span class="token operator">:</span> <span class="token string">'/api'</span><span class="token punctuation">,</span>  <span class="token comment">// 延迟</span>  timeout<span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// axios实例拦截请求</span>axiosInstance<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>  <span class="token punctuation">(</span>config<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">removePending</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span> <span class="token comment">// 在请求开始前，对之前的请求做检查取消操作</span>    <span class="token function">addPending</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span> <span class="token comment">// 将当前请求添加到 pending 中</span>    config<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>sa_token <span class="token operator">=</span> <span class="token string">'ken'</span>    <span class="token keyword">return</span> config<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">(</span>error<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求错误拦截'</span> <span class="token operator">+</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// axios实例拦截响应</span>axiosInstance<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>  <span class="token punctuation">(</span>response<span class="token operator">:</span> AxiosResponse<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token function">removePending</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>    <span class="token keyword">return</span> response<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token comment">// 请求失败</span>  <span class="token punctuation">(</span>error<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>axios<span class="token punctuation">.</span><span class="token function">isCancel</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'repeated request: '</span> <span class="token operator">+</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// handle error code</span>      <span class="token comment">// 错误抛到业务代码</span>      error<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>      error<span class="token punctuation">.</span>data<span class="token punctuation">.</span>msg <span class="token operator">=</span> <span class="token string">'请求超时或服务器异常，请检查网络或联系管理员！'</span>      ElMessage<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 声明一个 Map 用于存储每个请求的标识 和 取消函数</span><span class="token keyword">const</span> pending <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">/** * 添加请求 * @param &#123;Object&#125; config  */</span><span class="token keyword">const</span> <span class="token function-variable function">addPending</span> <span class="token operator">=</span> <span class="token punctuation">(</span>config<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token punctuation">[</span>    config<span class="token punctuation">.</span>method<span class="token punctuation">,</span>    config<span class="token punctuation">.</span>url<span class="token punctuation">,</span>    qs<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>    qs<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>data<span class="token punctuation">)</span>  <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span>  config<span class="token punctuation">.</span>cancelToken <span class="token operator">=</span> config<span class="token punctuation">.</span>cancelToken <span class="token operator">||</span> <span class="token keyword">new</span> <span class="token class-name">axios</span><span class="token punctuation">.</span><span class="token function">CancelToken</span><span class="token punctuation">(</span>cancel <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pending<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 如果 pending 中不存在当前请求，则添加进去</span>      pending<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> cancel<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">/** * 移除请求 * @param &#123;Object&#125; config  */</span><span class="token keyword">const</span> <span class="token function-variable function">removePending</span> <span class="token operator">=</span> <span class="token punctuation">(</span>config<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token punctuation">[</span>    config<span class="token punctuation">.</span>method<span class="token punctuation">,</span>    config<span class="token punctuation">.</span>url<span class="token punctuation">,</span>    qs<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>    qs<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>data<span class="token punctuation">)</span>  <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>pending<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 如果在 pending 中存在当前请求标识，需要取消当前请求，并且移除</span>    <span class="token keyword">const</span> cancel <span class="token operator">=</span> pending<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>    <span class="token function">cancel</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>    pending<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * 清空 pending 中的请求（在路由跳转时调用） */</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">clearPending</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>url<span class="token punctuation">,</span> cancel<span class="token punctuation">]</span> <span class="token keyword">of</span> pending<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">cancel</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  pending<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> axiosInstance<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="路由的简单配置（Vue-router）"><a href="#路由的简单配置（Vue-router）" class="headerlink" title="路由的简单配置（Vue-router）"></a>路由的简单配置（Vue-router）</h3><figure><div class="code-wrapper"><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createRouter<span class="token punctuation">,</span> createWebHashHistory<span class="token punctuation">,</span> RouteRecordRaw <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue-router'</span><span class="token keyword">const</span> routes<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>RouteRecordRaw<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token punctuation">&#123;</span>    path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>    redirect<span class="token operator">:</span> <span class="token string">'/home'</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span>    path<span class="token operator">:</span> <span class="token string">'/home/:type'</span><span class="token punctuation">,</span>    name<span class="token operator">:</span> <span class="token string">'Home'</span><span class="token punctuation">,</span>    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/Home.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    alias<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'/home'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    props<span class="token operator">:</span> <span class="token boolean">true</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span>    path<span class="token operator">:</span> <span class="token string">'/about'</span><span class="token punctuation">,</span>    name<span class="token operator">:</span> <span class="token string">'About'</span><span class="token punctuation">,</span>    <span class="token comment">// route level code-splitting</span>    <span class="token comment">// this generates a separate chunk (about.[hash].js) for this route</span>    <span class="token comment">// which is lazy-loaded when the route is visited.</span>    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/About.vue'</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  history<span class="token operator">:</span> <span class="token function">createWebHashHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  routes<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// 全局前置拦截</span>router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'全局前置拦截'</span><span class="token punctuation">)</span>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span>  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">default</span> router<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="全局的状态管理（Vuex）"><a href="#全局的状态管理（Vuex）" class="headerlink" title="全局的状态管理（Vuex）"></a>全局的状态管理（Vuex）</h3><figure><div class="code-wrapper"><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createStore<span class="token punctuation">,</span> Store <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'@vue/runtime-core'</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">interface</span> <span class="token class-name">Photo</span> <span class="token punctuation">&#123;</span>    src<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// declare your own store states</span>  <span class="token keyword">interface</span> <span class="token class-name">State</span> <span class="token punctuation">&#123;</span>    dark<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span>    count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>    user<span class="token operator">:</span> <span class="token punctuation">&#123;</span>      name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>      age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>      photoList<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Photo<span class="token operator">></span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// provide typings for `this.$store`</span>  <span class="token keyword">interface</span> <span class="token class-name">ComponentCustomProperties</span> <span class="token punctuation">&#123;</span>    $store<span class="token operator">:</span> Store<span class="token operator">&lt;</span>State<span class="token operator">></span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  state<span class="token operator">:</span> <span class="token punctuation">&#123;</span>    dark<span class="token operator">:</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'dackModel'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'dackModel'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    count<span class="token operator">:</span> <span class="token number">112</span><span class="token punctuation">,</span>    user<span class="token operator">:</span> <span class="token punctuation">&#123;</span>      name<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>      age<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>      photoList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>        src<span class="token operator">:</span> <span class="token string">'test'</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  getters<span class="token operator">:</span> <span class="token punctuation">&#123;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  mutations<span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token function">switchDarkMode</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      state<span class="token punctuation">.</span>dark <span class="token operator">=</span> <span class="token operator">!</span>state<span class="token punctuation">.</span>dark      <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>dark<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'dark'</span><span class="token punctuation">)</span>        localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'dackModel'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">'dark'</span><span class="token punctuation">)</span>        localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'dackModel'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  actions<span class="token operator">:</span> <span class="token punctuation">&#123;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  modules<span class="token operator">:</span> <span class="token punctuation">&#123;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="项目的main-ts"><a href="#项目的main-ts" class="headerlink" title="项目的main.ts"></a>项目的main.ts</h3><figure><div class="code-wrapper"><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createApp <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span><span class="token keyword">import</span> ElementPlus <span class="token keyword">from</span> <span class="token string">'element-plus'</span><span class="token keyword">import</span> <span class="token string">'element-plus/dist/index.css'</span><span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span><span class="token keyword">import</span> <span class="token string">'windi.css'</span><span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span><span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElementPlus<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="封"><a href="#封" class="headerlink" title="封"></a>封</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gpo8t35xs5j33341r8qv5.jpg" alt="少女马尾辫 夜晚 电脑 听音乐"></p>]]></content>
    
    
    <categories>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>typescipt</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>yarn和npm操作指南</title>
    <link href="/2021/08/30/vue-04/"/>
    <url>/2021/08/30/vue-04/</url>
    
    <content type="html"><![CDATA[<p>NPM老牌工具，Yarn后起之秀。作为一个后端程序员，可以理解成Maven和Gradle。Node.js为JS这个原本只能在浏览器中运行的语言，提供了一个运行环境，你可以理解成Java的JDK，使原本被浏览器限制的JS放飞自我了。</p><p>NPM和Yarn都是项目管理工具。核心是管理依赖的功能，为项目的运行提供一些支持。</p><h2 id="查看npm，yarn全局安装的包"><a href="#查看npm，yarn全局安装的包" class="headerlink" title="查看npm，yarn全局安装的包"></a>查看npm，yarn全局安装的包</h2><p>npm</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> list -g --depth <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><p>yarn</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">yarn</span> global list<span class="token comment"># 或者</span><span class="token function">yarn</span> global list --depth<span class="token operator">=</span><span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="nrm相关命令"><a href="#nrm相关命令" class="headerlink" title="nrm相关命令"></a>nrm相关命令</h2><p>nrm(npm registry manager )是npm的镜像源管理工具，有时候国外资源太慢，那么我们可以用这个来切换镜像源。<br><strong>安装nrm</strong></p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> -g nrm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><h3 id="列出可用源"><a href="#列出可用源" class="headerlink" title="列出可用源"></a>列出可用源</h3><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nrm <span class="token function">ls</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><h3 id="切换源"><a href="#切换源" class="headerlink" title="切换源"></a>切换源</h3><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nrm use taobao<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><h2 id="npm-x2F-yarn查看当前使用源与设置其它源"><a href="#npm-x2F-yarn查看当前使用源与设置其它源" class="headerlink" title="npm&#x2F;yarn查看当前使用源与设置其它源"></a>npm&#x2F;yarn查看当前使用源与设置其它源</h2><h3 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h3><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 查看npm当前镜像源</span><span class="token function">npm</span> config get registry  <span class="token comment"># 设置npm当前镜像源</span><span class="token function">npm</span> config <span class="token builtin class-name">set</span> registry https://registry.npmjs.org<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="yarn"><a href="#yarn" class="headerlink" title="yarn"></a>yarn</h3><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 查看yarn当前镜像源</span><span class="token function">yarn</span> config get registry<span class="token comment"># 设置yarn当前镜像源</span><span class="token function">yarn</span> config <span class="token builtin class-name">set</span> registry https://registry.yarnpkg.com <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h2><p>这个我是真的不是很想写，因为这东西官网上很详细，而且一点进去就能看到，有些东西，在官网上藏得比较深，又或者语言不同的问题。yarn有个敷衍的中文官网，npm连敷衍都不敷衍，大家优先用哪个知道了么🤣🤣🤣</p><h3 id="yarn常用"><a href="#yarn常用" class="headerlink" title="yarn常用"></a>yarn常用</h3><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 全局添加依赖，添加全局依赖建议yarn和npm两者选其一，</span><span class="token comment"># 如果同时都添加了全局依赖，我也不知道哪个优先。</span><span class="token comment"># 所以二者选其一即可</span><span class="token function">yarn</span> global <span class="token function">add</span> <span class="token operator">&lt;</span>package<span class="token punctuation">..</span>.<span class="token operator">></span><span class="token comment"># 正常项目中的添加依赖（默认添加到运行依赖中）</span><span class="token function">yarn</span> <span class="token function">add</span> <span class="token operator">&lt;</span>package<span class="token punctuation">..</span>.<span class="token operator">></span><span class="token comment"># 使用--dev或-D将在您的 开发依赖中，和运行依赖的区别就是打包时开发依赖不打包进去</span><span class="token function">yarn</span> <span class="token function">add</span> <span class="token operator">&lt;</span>package<span class="token punctuation">..</span>.<span class="token operator">></span> <span class="token punctuation">[</span>--dev/-D<span class="token punctuation">]</span><span class="token comment"># 删除依赖，同时删除开发依赖和运行依赖</span><span class="token function">yarn</span> remove <span class="token operator">&lt;</span>package<span class="token punctuation">..</span>.<span class="token operator">></span><span class="token comment"># 安装本地node_modules文件夹中package.json中列出的所有依赖项。(这百度翻译翻译的可以啊)</span><span class="token function">yarn</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="npm常用"><a href="#npm常用" class="headerlink" title="npm常用"></a>npm常用</h3><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 对应 yarn install</span><span class="token function">npm</span> <span class="token function">install</span><span class="token comment"># 对应 yarn add &lt;package...></span><span class="token function">npm</span> <span class="token function">install</span> <span class="token punctuation">[</span>package<span class="token punctuation">]</span> --save<span class="token comment"># 对应 yarn add &lt;package...> [--dev/-D]</span><span class="token function">npm</span> <span class="token function">install</span> <span class="token punctuation">[</span>package<span class="token punctuation">]</span> --save-dev<span class="token comment"># 对应 yarn global add &lt;package...></span><span class="token function">npm</span> <span class="token function">install</span> <span class="token punctuation">[</span>package<span class="token punctuation">]</span> --global<span class="token comment"># 对应 yarn remove &lt;package...></span><span class="token function">npm</span> uninstall <span class="token punctuation">[</span>package<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>简单的介绍了一下，详细的可以去官网上自行查看，这里只列举了一些常用的。</p><h2 id="快速删除node-modules文件"><a href="#快速删除node-modules文件" class="headerlink" title="快速删除node_modules文件"></a>快速删除node_modules文件</h2><h3 id="使用rimraf模块的命令"><a href="#使用rimraf模块的命令" class="headerlink" title="使用rimraf模块的命令"></a>使用rimraf模块的命令</h3><p>全局安装rimraf模块，然后通过其命令来快速删除node_modules目录：</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> rimraf -g<span class="token comment"># 进入项目文件夹中</span>rimraf node_modules<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="使用命令来删除目录"><a href="#使用命令来删除目录" class="headerlink" title="使用命令来删除目录"></a>使用命令来删除目录</h3><h4 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h4><p>首先在cmd窗口中进入到node_modules文件夹所在的路径，接着执行命令：</p><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rmdir</span> /s/q node_modules<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><h4 id="linux下"><a href="#linux下" class="headerlink" title="linux下"></a>linux下</h4><figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> -f /node_modules<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><h2 id="封"><a href="#封" class="headerlink" title="封"></a>封</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gt3p80og1jj338q1o0b2a.jpg" alt="美少女"></p>]]></content>
    
    
    <categories>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>yarn</tag>
      
      <tag>npm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Excel导入导出。</title>
    <link href="/2021/08/16/java-02/"/>
    <url>/2021/08/16/java-02/</url>
    
    <content type="html"><![CDATA[<div class="note note-info">            <p>介绍一下Excel的导入导出，用到的开源项目MyExcel，这是个十分好用的轮子，开发者的代码功底十分了得，</p><p>说起这个’了得‘，有意思的是了得和了不得，是一个意思。代码功底十分了得，代码功底十分了不得，表达的是一个意思。中国的文字，确实有点难为老外。</p><p>这个项目的文档已经详细到一种让人感觉到啰嗦的地步，功能也十分健壮，涵盖了各种使用场景。话不多说。进入正文</p>          </div><h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><blockquote><p>版本号建议一致，项目中如果有之前的POI的依赖可能会导致版本冲突，解决依赖冲突的方法，请自行百度。</p></blockquote><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--excel导入导出--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.github.liaochong<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>myexcel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.11.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--使用模板导出时过程中如果报包含Ognl关键字的异常，导入此依赖--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>ognl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>ognl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.2.21<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="Excel导入"><a href="#Excel导入" class="headerlink" title="Excel导入"></a>Excel导入</h2><p>导入分为一般导入、sax导入，二者的区别在于sax导入更关注内存，内存使用更少，且sax方式导入功能增强，建议使用sax方式导入（可读取公式值）</p><h3 id="一般导入（不支持csv文件导入，支持图片读取）"><a href="#一般导入（不支持csv文件导入，支持图片读取）" class="headerlink" title="一般导入（不支持csv文件导入，支持图片读取）"></a>一般导入（不支持csv文件导入，支持图片读取）</h3><p>一般导入又分为两种方式，两种方式的区别：</p><ul><li>全部读取：速度快，相对一行一行读取要占内存一点</li><li>一行一行读取：省内存，在高并发下不易引发OOM</li></ul><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">URL</span> htmlToExcelEampleURL <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token string">"/templates/read_example.xlsx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>htmlToExcelEampleURL<span class="token punctuation">.</span><span class="token function">toURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 方式一：全部读取后处理</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ArtCrowd</span><span class="token punctuation">></span></span> result <span class="token operator">=</span> <span class="token class-name">DefaultExcelReader</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">ArtCrowd</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">sheet</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 0代表第一个，如果为0，可省略该操作，也可sheet("名称")读取</span>        <span class="token punctuation">.</span><span class="token function">rowFilter</span><span class="token punctuation">(</span>row <span class="token operator">-></span> row<span class="token punctuation">.</span><span class="token function">getRowNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 如无需过滤，可省略该操作，0代表第一行</span>        <span class="token punctuation">.</span><span class="token function">beanFilter</span><span class="token punctuation">(</span><span class="token class-name">ArtCrowd</span><span class="token operator">::</span><span class="token function">isDance</span><span class="token punctuation">)</span> <span class="token comment">// bean过滤</span>        <span class="token punctuation">.</span><span class="token function">startSheet</span><span class="token punctuation">(</span>sheet<span class="token operator">-></span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sheet<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 在开始读取sheet前执行指定操作</span>        <span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">toFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 可接收inputStream</span><span class="token comment">// 方式二：读取一行处理一行，可自行决定终止条件</span><span class="token comment">// readThen有两种重写接口，返回Boolean型接口允许在返回False情况下直接终止读取</span><span class="token class-name">DefaultExcelReader</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">ArtCrowd</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">sheet</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 0代表第一个，如果为0，可省略该操作，也可sheet("名称")读取</span>        <span class="token punctuation">.</span><span class="token function">rowFilter</span><span class="token punctuation">(</span>row <span class="token operator">-></span> row<span class="token punctuation">.</span><span class="token function">getRowNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 如无需过滤，可省略该操作，0代表第一行</span>        <span class="token punctuation">.</span><span class="token function">beanFilter</span><span class="token punctuation">(</span><span class="token class-name">ArtCrowd</span><span class="token operator">::</span><span class="token function">isDance</span><span class="token punctuation">)</span> <span class="token comment">// bean过滤</span>        <span class="token punctuation">.</span><span class="token function">readThen</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">toFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>artCrowd <span class="token operator">-></span> <span class="token punctuation">&#123;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>artCrowd<span class="token punctuation">.</span>getName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 可接收inputStream</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArtCrowd</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// index代表列索引，从0开始</span>    <span class="token annotation punctuation">@ExcelColumn</span><span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ExcelColumn</span><span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> age<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ExcelColumn</span><span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>format<span class="token operator">=</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Date</span> birthday<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><div class="note note-info">            <p>可不使用@ExcelColumn注解，如不使用，则使用字段默认顺序读取，意思是。excel中从左到右，对应bean中从上到下。</p>          </div><h2 id="Excel默认导出"><a href="#Excel默认导出" class="headerlink" title="Excel默认导出"></a>Excel默认导出</h2><p>默认导出采用普通方式导出List&lt; Bean &gt;，适合小数据量场景，如数据量很大-10万+，建议使用DefaultStreamExcelBuilder，避免内存占用过多。<br><strong>导出需使用到如下注解</strong></p><ul><li>@ExcelModel(includeAllField,excludeParent,workbookType,sheetName,useFieldNameAsTitle,defaultValue)（可选，用于全局设定， 一般情况下只需要使用sheetName）</li><li>@IgnoreColumn（可选，用于排出不需要导出的字段）</li><li>@ExcelColumn(title,order,format,groups,defaultValue,style)</li></ul><blockquote><p>默认导出默认计算宽度、斑马线背景色，若无需上述样式，请调用 noStyle() 方法</p></blockquote><p>对应注解详情请见：<a href="#%E6%B3%A8%E8%A7%A3">注解</a></p><p><code>附件导出示例：</code></p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/default/excel/example"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">defaultBuild</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ArtCrowd</span><span class="token punctuation">></span></span> dataList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Workbook</span> workbook <span class="token operator">=</span> <span class="token class-name">DefaultExcelBuilder</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">ArtCrowd</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">AttachmentExportUtil</span><span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span>workbook<span class="token punctuation">,</span> <span class="token string">"艺术生信息"</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p><code>附件加密导出示例：</code></p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/default/excel/example"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">defaultBuild</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ArtCrowd</span><span class="token punctuation">></span></span> dataList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Workbook</span> workbook <span class="token operator">=</span> <span class="token class-name">DefaultExcelBuilder</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">ArtCrowd</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">AttachmentExportUtil</span><span class="token punctuation">.</span><span class="token function">encryptExport</span><span class="token punctuation">(</span>workbook<span class="token punctuation">,</span> <span class="token string">"艺术生信息"</span><span class="token punctuation">,</span> response<span class="token punctuation">,</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p><code>文件导出示例：</code></p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ArtCrowd</span><span class="token punctuation">></span></span> dataList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Workbook</span> workbook <span class="token operator">=</span> <span class="token class-name">DefaultExcelBuilder</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">ArtCrowd</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>         <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">FileExportUtil</span><span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span>workbook<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"/User/demo.xlsx"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p><code>文件加密导出示例：</code></p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ArtCrowd</span><span class="token punctuation">></span></span> dataList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Workbook</span> workbook <span class="token operator">=</span> <span class="token class-name">DefaultExcelBuilder</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">ArtCrowd</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>         <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">FileExportUtil</span><span class="token punctuation">.</span><span class="token function">encryptExport</span><span class="token punctuation">(</span>workbook<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"/User/demo.xlsx"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p><code>单纯数据获取：</code></p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ArtCrowd</span><span class="token punctuation">></span></span> <span class="token function">getDataList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ArtCrowd</span><span class="token punctuation">></span></span> dataList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ArtCrowd</span> artCrowd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArtCrowd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         artCrowd<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"李四"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         artCrowd<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         artCrowd<span class="token punctuation">.</span><span class="token function">setGender</span><span class="token punctuation">(</span><span class="token string">"Woman"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         artCrowd<span class="token punctuation">.</span><span class="token function">setPaintingLevel</span><span class="token punctuation">(</span><span class="token string">"一级证书"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         artCrowd<span class="token punctuation">.</span><span class="token function">setDance</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         artCrowd<span class="token punctuation">.</span><span class="token function">setAssessmentTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         artCrowd<span class="token punctuation">.</span><span class="token function">setHobby</span><span class="token punctuation">(</span><span class="token string">"钓鱼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dataList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>artCrowd<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> dataList<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@ExcelModel</span><span class="token punctuation">(</span>sheetName <span class="token operator">=</span> <span class="token string">"艺术生"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArtCrowd</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@ExcelColumn</span><span class="token punctuation">(</span>order <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> title <span class="token operator">=</span> <span class="token string">"姓名"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ExcelColumn</span><span class="token punctuation">(</span>order <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> title <span class="token operator">=</span> <span class="token string">"年龄"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ExcelColumn</span><span class="token punctuation">(</span>order <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> title <span class="token operator">=</span> <span class="token string">"性别"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> gender<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ExcelColumn</span><span class="token punctuation">(</span>order <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>title <span class="token operator">=</span> <span class="token string">"绘画等级"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> paintingLevel<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ExcelColumn</span><span class="token punctuation">(</span>order <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> title <span class="token operator">=</span> <span class="token string">"是否会跳舞"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> dance<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ExcelColumn</span><span class="token punctuation">(</span>order <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> title <span class="token operator">=</span> <span class="token string">"考核时间"</span><span class="token punctuation">,</span> format <span class="token operator">=</span> <span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> assessmentTime<span class="token punctuation">;</span>    <span class="token annotation punctuation">@IgnoreColumn</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> hobby<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="Excel模板构建"><a href="#Excel模板构建" class="headerlink" title="Excel模板构建"></a>Excel模板构建</h2><blockquote><p>所有Excel构建器均不可单例化，务必注意！！！<br>模板构建，核心原理是根据模板引擎渲染出符合需求布局的Html Table元素，构建器迭代table元素中的单元格渲染出Excel单元格。</p></blockquote><h3 id="导出模板引擎选定"><a href="#导出模板引擎选定" class="headerlink" title="导出模板引擎选定"></a>导出模板引擎选定</h3><blockquote><p>以下模板引擎默认均未被引入，使用者可根据自身需要选择在pom.xml中声明引入。<br>以下模板引擎版本为最低版本号。</p></blockquote><p>使用时根据实际需要自行选择就行了，或者你会哪个引擎就用哪个引擎就Ok。</p><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.ibeetl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>beetl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.7.23<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.freemarker<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>freemarker<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.3.23<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.codehaus.groovy<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>groovy-templates<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.4.13<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.1.6.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.velocity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>velocity<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.jfinal<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>enjoy<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>4.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="Workbook生成"><a href="#Workbook生成" class="headerlink" title="Workbook生成"></a>Workbook生成</h3><p>已存在Html文件时，使用这种方式，Html文件不局限于放在项目的classpath（如：resources）下，也无需模板引擎</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// get html file</span><span class="token class-name">File</span> htmlFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"/Users/liaochong/Downloads/example.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// read the html file and use default excel style to create excel</span><span class="token class-name">Workbook</span> workbook <span class="token operator">=</span> <span class="token class-name">HtmlToExcelFactory</span><span class="token punctuation">.</span><span class="token function">readHtml</span><span class="token punctuation">(</span>htmlFile<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">useDefaultStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// this is a example,you can write the workbook to any valid outputstream</span><span class="token class-name">FileExportUtil</span><span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span>workbook<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"/Users/liaochong/Downloads/excel.xlsx"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>使用内置的Freemarker等模板引擎Excel构建器，模板文件应当存放在classpath下，具体请参照项目中的example</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/*** use non-default-style excel builder* 模板文件放置在resources下** @param response response*/</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/freemarker/example"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> dataMap <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">ExcelBuilder</span> excelBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FreemarkerExcelBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token class-name">Workbook</span> workbook <span class="token operator">=</span> excelBuilder                   <span class="token comment">// fileTemplate(dirPath,fileName)</span>                   <span class="token punctuation">.</span><span class="token function">classpathTemplate</span><span class="token punctuation">(</span><span class="token string">"/templates/freemarkerToExcelExample.ftl"</span><span class="token punctuation">)</span>                   <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>dataMap<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">AttachmentExportUtil</span><span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span>workbook<span class="token punctuation">,</span> <span class="token string">"freemarker_excel"</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">/*** use default-style excel builder* 模板文件放置在resources下** @param response response*/</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/freemarker/defaultStyle/example"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buildWithDefaultStyle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> dataMap <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">ExcelBuilder</span> excelBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FreemarkerExcelBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token class-name">Workbook</span> workbook <span class="token operator">=</span> excelBuilder                  <span class="token comment">// fileTemplate(dirPath,fileName)</span>                  <span class="token punctuation">.</span><span class="token function">classpathTemplate</span><span class="token punctuation">(</span><span class="token string">"/templates/freemarkerToExcelExample.ftl"</span><span class="token punctuation">)</span>                  <span class="token punctuation">.</span><span class="token function">useDefaultStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                  <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>dataMap<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token class-name">AttachmentExportUtil</span><span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span>workbook<span class="token punctuation">,</span> <span class="token string">"freemarker_excel"</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">getDataMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> dataMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    dataMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"sheetName"</span><span class="token punctuation">,</span> <span class="token string">"freemarker_excel_example"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> titles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    titles<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Category"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    titles<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Product Name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    titles<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Count"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    dataMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"titles"</span><span class="token punctuation">,</span> titles<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">></span></span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Product</span> product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            product<span class="token punctuation">.</span><span class="token function">setCategory</span><span class="token punctuation">(</span><span class="token string">"蔬菜"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            product<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"小白菜"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            product<span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            product<span class="token punctuation">.</span><span class="token function">setCategory</span><span class="token punctuation">(</span><span class="token string">"电子产品"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            product<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"ipad"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            product<span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    dataMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> dataMap<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="模板示例"><a href="#模板示例" class="headerlink" title="模板示例"></a>模板示例</h3><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>caption</span><span class="token punctuation">></span></span>$&#123;sheetName&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>caption</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">background-color</span><span class="token punctuation">:</span> #6495ED</span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">colspan</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span><span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>产品介绍<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>#list</span> <span class="token attr-name">titles</span> <span class="token attr-name">as</span> <span class="token attr-name">title</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>$&#123;title&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>#list</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>#list</span> <span class="token attr-name">data</span> <span class="token attr-name">as</span> <span class="token attr-name">item</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>$&#123;item.category&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>$&#123;item.name&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>$&#123;item.count&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">url</span><span class="token punctuation">></span></span>百度地址<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>#list</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p>模板中的样式请看这里<a href="#%E6%A0%B7%E5%BC%8F%E6%94%AF%E6%8C%81">样式支持</a></p><h2 id="csv文件导出"><a href="#csv文件导出" class="headerlink" title="csv文件导出"></a>csv文件导出</h2><h3 id="一般方式导出"><a href="#一般方式导出" class="headerlink" title="一般方式导出"></a>一般方式导出</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">Csv</span> csv <span class="token operator">=</span> <span class="token class-name">CsvBuilder</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">People</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token function">getDataList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">AttachmentExportUtil</span><span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span>csv<span class="token punctuation">.</span><span class="token function">getFilePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"test.csv"</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// csv.write(Paths.get("/User/append.csv"));</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="Map导出"><a href="#Map导出" class="headerlink" title="Map导出"></a>Map导出</h3><blockquote><p>Map类型为Map&lt;String,Object&gt;</p></blockquote><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">Csv</span> csv <span class="token operator">=</span> <span class="token class-name">CsvBuilder</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token function">getMapList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">AttachmentExportUtil</span><span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span>csv<span class="token punctuation">.</span><span class="token function">getFilePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"test.csv"</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// csv.write(Paths.get("/User/append.csv"));</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="追加方式导出"><a href="#追加方式导出" class="headerlink" title="追加方式导出"></a>追加方式导出</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">CsvBuilder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CsvPeople</span><span class="token punctuation">></span></span> csvBuilder <span class="token operator">=</span> <span class="token class-name">CsvBuilder</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">People</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        csvBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Csv</span> csv <span class="token operator">=</span> csvBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">AttachmentExportUtil</span><span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span>csv<span class="token punctuation">.</span><span class="token function">getFilePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"test.csv"</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// csv.write(Paths.get("/User/append.csv"));</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="二次文件追加"><a href="#二次文件追加" class="headerlink" title="二次文件追加"></a>二次文件追加</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">CsvBuilder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CsvPeople</span><span class="token punctuation">></span></span> csvBuilder <span class="token operator">=</span> <span class="token class-name">CsvBuilder</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">People</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">noTitles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        csvBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Csv</span> csv <span class="token operator">=</span> csvBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 该种方式会在原append.csv文件继续追加数据，而不是覆盖</span>    csv<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/User/append.csv"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><p><code>Bean定义</code></p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">People</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@ExcelColumn</span><span class="token punctuation">(</span>order <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> title <span class="token operator">=</span> <span class="token string">"姓名"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ExcelColumn</span><span class="token punctuation">(</span>order <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> title <span class="token operator">=</span> <span class="token string">"年龄"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ExcelColumn</span><span class="token punctuation">(</span>order <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> title <span class="token operator">=</span> <span class="token string">"性别"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> gender<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><blockquote><p>与excel导出注解相比，支持属性减少，width、style属性将不被支持，注解请移步: <a href="#%E6%B3%A8%E8%A7%A3">注解</a></p></blockquote><h2 id="多sheet导入"><a href="#多sheet导入" class="headerlink" title="多sheet导入"></a>多sheet导入</h2><p>多sheet导入，指的是SaxExcelReader多sheet导入，不包含DefaultExcelReader。</p><h3 id="按sheet索引多sheet导入"><a href="#按sheet索引多sheet导入" class="headerlink" title="按sheet索引多sheet导入"></a>按sheet索引多sheet导入</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SaxExcelReader</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">People</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sheets</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>excelFile<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><h3 id="按sheet名称多sheet导入"><a href="#按sheet名称多sheet导入" class="headerlink" title="按sheet名称多sheet导入"></a>按sheet名称多sheet导入</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SaxExcelReader</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">People</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sheets</span><span class="token punctuation">(</span><span class="token string">"sheet名称1"</span><span class="token punctuation">,</span><span class="token string">"sheet名称2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>excelFile<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><h2 id="多sheet导出"><a href="#多sheet导出" class="headerlink" title="多sheet导出"></a>多sheet导出</h2><h3 id="DefaultExcelBuilder、DefaultStreamExcelBuilder"><a href="#DefaultExcelBuilder、DefaultStreamExcelBuilder" class="headerlink" title="DefaultExcelBuilder、DefaultStreamExcelBuilder"></a>DefaultExcelBuilder、DefaultStreamExcelBuilder</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Workbook</span> workbook1<span class="token operator">=</span><span class="token class-name">DefaultExcelBuilder</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// of(class,workbook)</span><span class="token class-name">Workbook</span> workbook2<span class="token operator">=</span><span class="token class-name">DefaultExcelBuilder</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">B</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">,</span> workbook1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="模板导出"><a href="#模板导出" class="headerlink" title="模板导出"></a>模板导出</h3><p>模板导出情况下，每一个table就是一个sheet。</p><blockquote><p>如需多table导出在同一sheet中，使用sheetStrategy(SheetStrategy.ONE_SHEET)</p></blockquote><h2 id="自定义样式"><a href="#自定义样式" class="headerlink" title="自定义样式"></a>自定义样式</h2><blockquote><p>本模块仅针对DefaultExcelBuilder、DefaultStreamExcelBuilder，模板构建天然支持。</p></blockquote><h3 id="标题（title）样式自定义"><a href="#标题（title）样式自定义" class="headerlink" title="标题（title）样式自定义"></a>标题（title）样式自定义</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ExcelColumn</span><span class="token punctuation">(</span>style<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"title->color:red"</span><span class="token punctuation">,</span><span class="token string">"cell->color:green"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token class-name">Integer</span> age<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div></figure><h3 id="内容行样式自定义"><a href="#内容行样式自定义" class="headerlink" title="内容行样式自定义"></a>内容行样式自定义</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ExcelColumn</span><span class="token punctuation">(</span>style<span class="token operator">=</span><span class="token string">"cell->color:green"</span><span class="token punctuation">)</span><span class="token class-name">Integer</span> age<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div></figure><h3 id="方法调用设定样式"><a href="#方法调用设定样式" class="headerlink" title="方法调用设定样式"></a>方法调用设定样式</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DefaultExcelBuilder</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">ArtCrowd</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>                   <span class="token punctuation">.</span><span class="token function">style</span><span class="token punctuation">(</span><span class="token string">"title->color:red"</span><span class="token punctuation">,</span><span class="token string">"background-color:green;"</span><span class="token punctuation">)</span>                   <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div></figure><p>使用 -&gt; 分隔符：</p><ul><li>title标明该样式针对标题；</li><li>cell标明该样式针对内容行；</li><li>odd标明该样式针对奇数内容行；</li><li>even标明该样式针对偶数内容行；</li></ul><p>具体样式支持，请移步<a href="#%E6%A0%B7%E5%BC%8F%E6%94%AF%E6%8C%81">样式支持</a></p><h2 id="单元格内换行"><a href="#单元格内换行" class="headerlink" title="单元格内换行"></a>单元格内换行</h2><h3 id="DefaultExcelBuilder-x2F-DefaultSteamExcelBuilder"><a href="#DefaultExcelBuilder-x2F-DefaultSteamExcelBuilder" class="headerlink" title="DefaultExcelBuilder&#x2F;DefaultSteamExcelBuilder"></a>DefaultExcelBuilder&#x2F;DefaultSteamExcelBuilder</h3><p>默认上述构建器会自动换行，@ExcelModel(wrapText&#x3D;true)</p><h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><p>如需在模板的单元格内换行，请使用<code>&lt;br/&gt;</code>或p标签。</p><h2 id="图片导出"><a href="#图片导出" class="headerlink" title="图片导出"></a>图片导出</h2><h3 id="DefaultExcelBuilder、DefaultStreamExcelBuilder图片导出"><a href="#DefaultExcelBuilder、DefaultStreamExcelBuilder图片导出" class="headerlink" title="DefaultExcelBuilder、DefaultStreamExcelBuilder图片导出"></a>DefaultExcelBuilder、DefaultStreamExcelBuilder图片导出</h3><p>图片导出属性定义：</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ExcelColumn</span><span class="token punctuation">(</span>fileType <span class="token operator">=</span> <span class="token class-name">FileType</span><span class="token punctuation">.</span>IMAGE<span class="token punctuation">)</span><span class="token class-name">File</span> image<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div></figure><p>属性类型必须是File，后续会增加其他类型支持。</p><h3 id="模板图片导出"><a href="#模板图片导出" class="headerlink" title="模板图片导出"></a>模板图片导出</h3><p>td单元格内含图片即可</p><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>图片绝对路径<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="图片导入"><a href="#图片导入" class="headerlink" title="图片导入"></a>图片导入</h2><p>图片导入仅DefaultExcelReader支持，属性类型为InputStream，实际赋值类型为ByteArrayInputStream。</p><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">People</span> <span class="token punctuation">&#123;</span>   <span class="token annotation punctuation">@ExcelColumn</span><span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>   <span class="token class-name">InputStream</span> picture<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="单元格设置"><a href="#单元格设置" class="headerlink" title="单元格设置"></a>单元格设置</h2><p>默认情况下，程序会自动判别单元格内容类型，目前自动识别类型有以下三种：</p><ul><li>String</li><li>Double</li><li>Boolean</li></ul><p>如果String的内容全为数字时，导出时有可能会被使用科学计数法展示。解决这种情况强制使用String的方式构建即可。</p><h3 id="设置为字符串类型数据可做如下操作"><a href="#设置为字符串类型数据可做如下操作" class="headerlink" title="设置为字符串类型数据可做如下操作"></a>设置为字符串类型数据可做如下操作</h3><p>在td上增加属性string设置该单元格类型为字符串</p><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">string</span><span class="token punctuation">></span></span>19<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="设置为数值类型数据可做如下操作"><a href="#设置为数值类型数据可做如下操作" class="headerlink" title="设置为数值类型数据可做如下操作"></a>设置为数值类型数据可做如下操作</h3><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">double</span><span class="token punctuation">></span></span>19<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="设置为布尔类型数据可做如下操作"><a href="#设置为布尔类型数据可做如下操作" class="headerlink" title="设置为布尔类型数据可做如下操作"></a>设置为布尔类型数据可做如下操作</h3><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">boolean</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="添加水印"><a href="#添加水印" class="headerlink" title="添加水印"></a>添加水印</h2><blockquote><p>不支持.xls文件添加水印，支持XSSF、SXSSF模式下添加水印，如数据量过大，可能会造成内存溢出，请注意⚠️</p></blockquote><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>liaochong<span class="token punctuation">.</span>myexcel<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">WatermarkUtil</span></span><span class="token punctuation">;</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ArtCrowd</span><span class="token punctuation">></span></span> dataList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDataList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Workbook</span> workbook <span class="token operator">=</span> <span class="token class-name">DefaultExcelBuilder</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">ArtCrowd</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 使用水印工具添加水印</span><span class="token class-name">WatermarkUtil</span><span class="token punctuation">.</span><span class="token function">addWatermark</span><span class="token punctuation">(</span>workbook<span class="token punctuation">,</span><span class="token string">"艺术生水印"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">AttachmentExportUtil</span><span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span>workbook<span class="token punctuation">,</span> <span class="token string">"艺术生信息"</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="模板相关"><a href="#模板相关" class="headerlink" title="模板相关"></a>模板相关</h2><h3 id="在html中设置excel的sheet名称"><a href="#在html中设置excel的sheet名称" class="headerlink" title="在html中设置excel的sheet名称"></a>在html中设置excel的sheet名称</h3><blockquote><p>设置sheet name：在表格里添加<code>&lt;caption&gt;</code>sheet名称</caption></p></blockquote><figure><div class="code-wrapper"><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>caption</span><span class="token punctuation">></span></span>sheet名称<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>caption</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="样式支持"><a href="#样式支持" class="headerlink" title="样式支持"></a>样式支持</h2><div class="note note-info">            <h3 id="宽度（widht）"><a href="#宽度（widht）" class="headerlink" title="宽度（widht）"></a>宽度（widht）</h3><table><thead><tr><th>CSS</th><th>Value</th><th>Example</th></tr></thead><tbody><tr><td>width</td><td>数值，如15px</td><td>style&#x3D;”width: 15px”</td></tr></tbody></table>          </div><div class="note note-info">            <h3 id="高度（height）"><a href="#高度（height）" class="headerlink" title="高度（height）"></a>高度（height）</h3><table><thead><tr><th>CSS</th><th>Value</th><th>Example</th></tr></thead><tbody><tr><td>height</td><td>数值，如15px，特别注意⚠️：如模板使用，该样式只能放置在 tr 上</td><td>style&#x3D;”height: 15px”</td></tr></tbody></table>          </div><div class="note note-info">            <h3 id="背景色（background）"><a href="#背景色（background）" class="headerlink" title="背景色（background）"></a>背景色（background）</h3><table><thead><tr><th>CSS</th><th>Value</th><th>Example</th></tr></thead><tbody><tr><td>background-color</td><td>十六进制：#FFFFFF、RGB：rgb(0,255,255)、常用背景色名称：green，推荐使用十六进制</td><td>style&#x3D;”background-color:#ABFF00”</td></tr></tbody></table>          </div><div class="note note-info">            <h3 id="边框（border）"><a href="#边框（border）" class="headerlink" title="边框（border）"></a>边框（border）</h3><table><thead><tr><th>CSS</th><th>Value</th><th>Example</th></tr></thead><tbody><tr><td>border-style</td><td>thin、dashed、medium、dotted、thick、double、hair、medium_dashed、dash_dot</td><td>style&#x3D;”border-style:thin”</td></tr><tr><td>border-top-style</td><td>thin、dashed、medium、dotted、thick、double、hair、medium_dashed、dash_dot</td><td>style&#x3D;”border-top-style:thin”</td></tr><tr><td>border-right-style</td><td>thin、dashed、medium、dotted、thick、double、hair、medium_dashed、dash_dot</td><td>style&#x3D;”border-right-style:thin”</td></tr><tr><td>border-bottom-style</td><td>thin、dashed、medium、dotted、thick、double、hair、medium_dashed、dash_dot</td><td>style&#x3D;”border-bottom-style:thin”</td></tr><tr><td>border-left-style</td><td>thin、dashed、medium、dotted、thick、double、hair、medium_dashed、dash_dot</td><td>style&#x3D;”border-left-style:thin”</td></tr></tbody></table>          </div><div class="note note-info">            <h3 id="字体（font）"><a href="#字体（font）" class="headerlink" title="字体（font）"></a>字体（font）</h3><table><thead><tr><th>CSS</th><th>Value</th><th>Example</th></tr></thead><tbody><tr><td>color</td><td>green</td><td>style&#x3D;”color:green;”</td></tr><tr><td>font-size</td><td>数值：14px（只会截取数值，非数值部分会被删除）</td><td>style&#x3D;”font-size:14px”</td></tr><tr><td>font-family</td><td>Times New Roman（不支持备选字体）</td><td>style&#x3D;”font-family:Times New Roman”</td></tr><tr><td>font-style</td><td>italic</td><td>style&#x3D;”font-style:italic”</td></tr><tr><td>font-weight</td><td>bold</td><td>style&#x3D;”font-weight:bold”</td></tr><tr><td>text-decoration</td><td>text-decoration</td><td>style&#x3D;”text-decoration: underline”</td></tr></tbody></table>          </div><div class="note note-info">            <h3 id="对齐方式（align）"><a href="#对齐方式（align）" class="headerlink" title="对齐方式（align）"></a>对齐方式（align）</h3><table><thead><tr><th>CSS</th><th>Value</th><th>Example</th></tr></thead><tbody><tr><td>text-align</td><td>general,left,center,right,fill,justify,center_selection,distributed</td><td>style&#x3D;”text-align:center”</td></tr><tr><td>vertical-align</td><td>top,center,bottom,justify,distributed</td><td>style&#x3D;”vertical-align:center”</td></tr></tbody></table>          </div><div class="note note-info">            <h3 id="隐藏（visibility）"><a href="#隐藏（visibility）" class="headerlink" title="隐藏（visibility）"></a>隐藏（visibility）</h3><table><thead><tr><th>CSS</th><th>Value</th><th>Example</th></tr></thead><tbody><tr><td>visibility</td><td>hidden：隐藏，目前仅设置在tr上生效</td><td>&lt; tr style&#x3D;”visibility: hidden” &gt;</td></tr></tbody></table>          </div><div class="note note-info">            <h3 id="自动换行（word-break）"><a href="#自动换行（word-break）" class="headerlink" title="自动换行（word-break）"></a>自动换行（word-break）</h3><table><thead><tr><th>CSS</th><th>Value</th><th>Example</th></tr></thead><tbody><tr><td>word-break</td><td>break-all：自动换行</td><td>&lt; tr style&#x3D;”word-break: break-all” &gt;、&lt; td style&#x3D;”word-break: break-all” &gt;</td></tr></tbody></table>          </div><h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><p>注解说明</p><ul><li>注解</li></ul><blockquote><p>@ExcelModel</p></blockquote><ul><li>位置</li></ul><blockquote><p>Class</p></blockquote><ul><li><p>方法</p><ul><li>includeAllField：是否导出该类的所有字段，默认为true</li><li>excludeParent：是否排除父类字段，默认为false</li><li>workbookType：设置工作簿类型，默认WorkbookType.SXLSX，不建议修改</li><li>sheetName：设置导出的工作簿sheet名称</li><li>useFieldNameAsTitle：设置是否直接使用字段名称作为导出标题，默认false</li><li>defaultValue：设置全局导出时，字段为Null时的默认值，如字段也包含defaultValue，则进行覆盖</li><li>wrapText：是否开启自动换行，默认开启</li></ul></li><li><p>dateFormat：设置全局LocalDate格式，默认为yyyy-MM-dd</p></li><li><p>dateTimeFormat：设置全局Date\LocalDateTime格式，默认为yyyy-MM-dd HH:mm:ss</p></li><li><p>ignoreStaticFields：是否忽略静态字段导出，默认忽略</p></li><li><p>titleSeparator：标题分离器，用于多级标题，默认为“-&gt;”</p></li><li><p>|设置导出Excel的公共属性 @ExcelColumn|Field|</p></li><li><p>title：导出时使用，该字段对应导出列标题</p></li><li><p>order：导出时使用，该字段对应的导出展示顺序，初始为0，建议按列顺序设置，如字段顺序就是列顺序，可不设置</p></li><li><p>format：导入导出时使用，当字段类型为时间类型、金钱类型时生效，用于设置该时间类型字段格式化，如<code>yyyy-MM-dd HH:mm:ss</code></p></li><li><p>groups：导出时使用，当前字段所属分组，构建时根据传入的分组选择导出的字段</p></li><li><p>index：导入时使用，用于标志该字段对应的Excel列，从0开始，不允许重复</p></li><li><p>defaultValue：导出时使用，设置导出时字段为Null时的默认值</p></li><li><p>width：导出时使用，用于自定义单元格宽度，配合AutoWidthStrategy.CUSTOM_WIDTH使用</p></li><li><p>style：自定义样式</p></li><li><p>设置导入、导出字段属性 @IgnoreColumn,排除该字段的导出</p></li></ul><h2 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h2><p><a href="https://github.com/liaochong/myexcel">myexcel</a></p><h2 id="封"><a href="#封" class="headerlink" title="封"></a>封</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1grgj7do4e0j32yo1o04qp.jpg" alt="伴我同行"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>excel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>java8的stream的使用方法</title>
    <link href="/2021/08/12/java-01/"/>
    <url>/2021/08/12/java-01/</url>
    
    <content type="html"><![CDATA[<h2 id="Stream的由来"><a href="#Stream的由来" class="headerlink" title="Stream的由来"></a>Stream的由来</h2><div class="note note-info">            <p>我们正常处理集合里的数据时，第一想到的是不是就是for循环，别问，问就是for循环大法。确实，面向对象的编程思维，让我们第一时间想到的就是一个一个循环然后进行一些过滤，查找，分类操作。在Java没有这个流之前，大家伙都这么做的。</p><p>为什么Java8要推出流这个东西呢，肯定是这种方法有优越性。之前的循环大法从最终的结果来看和流操作的结果是一样的，都可以完成功能。流的操作来源于Lambda表达式，如果没有Lambda表达式也不会有这个东西。使用流可以提升代码的简洁度，这个提升是质的飞跃，以前十几行代码甚至更多，现在可能只需要一行代码就能完成，这是就有不同的意见了，说这种代码难以维护，我感觉完成同样的功能，代码越少是越容易维护的，一个三百行代码的方法和一个三十行的方法，维护成本不是一个量级的。</p>          </div><h2 id="Stream流的用法"><a href="#Stream流的用法" class="headerlink" title="Stream流的用法"></a>Stream流的用法</h2><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LocalDateTimeDemoTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token function">getUserList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 过滤</span><span class="token comment">// 年龄大于10的</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> collect <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>user <span class="token operator">-></span> user<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 名字最后是2的</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> collect1 <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>user <span class="token operator">-></span> user<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 组合过滤</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> collect2 <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>user <span class="token operator">-></span> user<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>user <span class="token operator">-></span> user<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 查找名为王0的，如果有重名的取第一个,如果为空则初始化一个(这种写法主要是让程序更加健壮，避免的空指针)。</span><span class="token class-name">User</span> user1 <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>user <span class="token operator">-></span> user<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"王0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 这种也是获取第一个,这个的效率比上面的高，一般查找唯一数据，用这个比较快。</span><span class="token class-name">User</span> user2 <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>user <span class="token operator">-></span> user<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"王0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findAny</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 按年龄从小到大排序</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> collect7 <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token class-name">Comparator</span><span class="token punctuation">.</span><span class="token function">comparing</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getAge</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 按年龄从大到小排序</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> collect8 <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token class-name">Comparator</span><span class="token punctuation">.</span><span class="token function">comparing</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getAge</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reversed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 分组</span><span class="token comment">// 以班级分组, 返回一个map,key为部门ID，value为分组的集合</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span><span class="token punctuation">></span></span> collect3 <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getGradeId</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 多级分组 这个就比较好玩了，Map里面嵌套Map，哈哈和上面一样，先以班级分组，然后再按年龄分组</span><span class="token comment">// 外层的Map的Key为班级ID，里面的Map的Key为年龄。</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span><span class="token punctuation">></span><span class="token punctuation">></span></span> collect4 <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getGradeId</span><span class="token punctuation">,</span> <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getAge</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 分组加汇总，以班级为单位总薪酬</span><span class="token comment">// Map的Key 为班级ID，Value为分过组后的总和，注意这里喔，</span><span class="token comment">// 直接用double来进行总和计算，一般来说肯定会发生精度丢失。所以这种这种double运算，一般来说是不可以直接sum的</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Double</span><span class="token punctuation">></span></span> collect5 <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getGradeId</span><span class="token punctuation">,</span> <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">summingDouble</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getSalary</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="归总"><a href="#归总" class="headerlink" title="归总"></a>归总</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java">    <span class="token comment">// 归总，</span>    <span class="token comment">// 何为归总，就是结果集是一个。</span>    <span class="token comment">//求所有人年龄总和（好像没啥意义，）</span>    <span class="token keyword">int</span> sum <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getAge</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 也可以先过滤班级编号为3的同学再进行年龄求和</span>    <span class="token keyword">int</span> sum1 <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>user <span class="token operator">-></span> user<span class="token punctuation">.</span><span class="token function">getGradeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getAge</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 找到年龄最小的同学</span>    <span class="token class-name">User</span> user <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token class-name">Comparator</span><span class="token punctuation">.</span><span class="token function">comparing</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getAge</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 找到年龄最大的同学并输出最小年龄是多少（强行凑代码，哈哈）</span>    <span class="token keyword">int</span> age <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token class-name">Comparator</span><span class="token punctuation">.</span><span class="token function">comparing</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getAge</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 获取按班级分组后年龄总和最小值是多少（乍一听感觉很绕，实际有啥绕的,自己写了一下，确实有点绕，淦。）</span>    <span class="token comment">// 实际意义待斟酌啊。。</span>    <span class="token class-name">Integer</span> integer <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getGradeId</span><span class="token punctuation">,</span>     <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">summingInt</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getAge</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token class-name">Comparator</span><span class="token punctuation">.</span><span class="token function">comparing</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">valueOf</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 演示一下BigDecimal的运算吧，差点忘了,</span>    <span class="token comment">// 啥也不干直接就是算金额总和</span>    <span class="token class-name">BigDecimal</span> bigDecimal <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getMoney</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">BigDecimal</span><span class="token operator">::</span><span class="token function">add</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 先进行简单的过滤，再进行计算</span>    <span class="token class-name">BigDecimal</span> bigDecimal1 <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>user3 <span class="token operator">-></span> user3<span class="token punctuation">.</span><span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getMoney</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">BigDecimal</span><span class="token operator">::</span><span class="token function">add</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 计算所有同学的年龄</span>    <span class="token keyword">int</span> sum2 <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getAge</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 计算Double型的Salary,这里肯定会发生精度丢失，具体怎么处理，大家可以百度一下，提示要想不丢精度，肯定是要用BigDecimal的</span>    <span class="token keyword">double</span> sum3 <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mapToDouble</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getSalary</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 计算年轻平均数</span>    <span class="token class-name">Double</span> collect6 <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">averagingDouble</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getAge</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 看看姓王同学有几个.</span>    <span class="token keyword">long</span> count <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>user3 <span class="token operator">-></span> user3<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"王"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// anyMatch表示，判断的条件里，任意一个元素成功，返回true</span>    <span class="token comment">// 这里就是如果同学中有一个小于六岁的则返回true</span>    <span class="token keyword">boolean</span> b <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anyMatch</span><span class="token punctuation">(</span>i <span class="token operator">-></span> i<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// allMatch表示，判断条件里的元素，所有的都是，返回true</span>    <span class="token comment">// 判断同学里面是不是所有人的年龄都小于六十岁，如果都小于六十岁则返回true</span>    <span class="token keyword">boolean</span> b1 <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">allMatch</span><span class="token punctuation">(</span>i <span class="token operator">-></span> i<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// noneMatch跟allMatch相反，判断条件里的元素，所有的都不是，返回true</span>    <span class="token comment">// 判断同学的年龄是不是都不大于六十岁，如果有一个大于六十岁  返回false</span>    <span class="token keyword">boolean</span> b2 <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">noneMatch</span><span class="token punctuation">(</span>i <span class="token operator">-></span> i<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="用来测试的数据"><a href="#用来测试的数据" class="headerlink" title="用来测试的数据"></a>用来测试的数据</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java">    <span class="token comment">// 模拟数据组，真是数据远远比这复杂，但是你只需要用关键数据即可。</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> <span class="token function">getUserList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"王0"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">12.3</span><span class="token punctuation">,</span><span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">1600</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"王1"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">11.7</span><span class="token punctuation">,</span><span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">1300</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"王2"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">16.3</span><span class="token punctuation">,</span><span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"王3"</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">19.3</span><span class="token punctuation">,</span><span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">1800</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">"王4"</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">11.3</span><span class="token punctuation">,</span><span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">2344</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">"王5"</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">15.3</span><span class="token punctuation">,</span><span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">1120</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">"王6"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">19.3</span><span class="token punctuation">,</span><span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">9980</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token string">"王7"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">111.3</span><span class="token punctuation">,</span><span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">1112</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> list<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="模拟数据实体类"><a href="#模拟数据实体类" class="headerlink" title="模拟数据实体类"></a>模拟数据实体类</h3><figure><div class="code-wrapper"><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 主键Id     */</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>    <span class="token comment">/**     * 用户名     */</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>    <span class="token comment">/**     * 班级ID     */</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> gradeId<span class="token punctuation">;</span>    <span class="token comment">/**     * 年龄     */</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>    <span class="token comment">/**     * 薪酬     */</span>    <span class="token keyword">private</span> <span class="token keyword">double</span> salary<span class="token punctuation">;</span>    <span class="token comment">/**     * 强行增加一个金额，用来演示BigDecimal运算     */</span>    <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> money<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> userName<span class="token punctuation">,</span> <span class="token keyword">int</span> gradeId<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">,</span> <span class="token keyword">double</span> salary<span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span> money<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>userName <span class="token operator">=</span> userName<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>gradeId <span class="token operator">=</span> gradeId<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>salary <span class="token operator">=</span> salary<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>money <span class="token operator">=</span> money<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">/**  * 省略get,set方法 */</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="尾"><a href="#尾" class="headerlink" title="尾"></a>尾</h2><div class="note note-info">            <p>其实这些方法，不用死记硬背，需要的时候查询一下就行了，当用的多了自然而然的就记住了。死记硬背，当时是背下来了，不常用到的话，也会很快的遗忘。</p><p>实际上在查询数据这方面，sql是全球第一的。不要小看任何一款数据库软件。数据库软件，可以说是人类智慧的结晶，是一群智商顶尖的人，并将数据结构和算法用到极致才开发出来的东西。一个几百兆的体积的数据库软件可以毫不费力的管理大于自身几百倍体积的数据。这种能力是真正编程的美丽。</p><p>我在整理这个流的操作时，如果我们把集合看成数据库里的一行行数据，Java这个对集合的流固然强大，可和SQL一比，也能理解，毕竟闻道有先后，术业有专攻。</p>          </div><h2 id="封"><a href="#封" class="headerlink" title="封"></a>封</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gl42sgpf56j32yo1o0kjl.jpg" alt="塞尔菲娅"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>stream</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>温柔的哲思</title>
    <link href="/2021/08/11/gossip-01/"/>
    <url>/2021/08/11/gossip-01/</url>
    
    <content type="html"><![CDATA[<div class="note note-info">            <p>打算严格区分开来碎碎念和技术性的博客，不要正儿八经技术博客里面混杂着其他奇奇怪怪的文字，技术 嘛，纯粹一点，不是什么坏事啦，碎碎念，也纯碎一点咯。</p>          </div><h2 id="主"><a href="#主" class="headerlink" title="主"></a>主</h2><div class="note note-info">            <p>毕竟也没什么好毕竟的，大学期间的一些琐碎。</p><p>初上大学，当时我的成绩并不理想，用并不理想是为了自己给自己留一点面子。报考专业的时候，受到不知道哪位家长的撺掇，一边稀里糊涂，一遍明明白白的报了土木相关的专业，事实证明我不感兴趣加人人都学的的东西我真的很难学得进去，于是我课上的不多，挂科也很严重，不过考虑我是专科，我有堕落的资本，辅导员也不至于跟一个专科生过不去，大学里面看重的又不仅仅是成绩。当然其他的方面和我的成绩也是平分秋色😅😅，不好多说，反正从小到大，家长越是期待什么我就越会搞砸，我总是说自己什么叛逆，其实不是叛逆，只是我的抗压能力实在不强，身上一有压力，我就做不好事情了。也在练习啦，泰山崩于前面不改色我能做到，可心的砰砰的跳，我控制不住。</p><p>在大学之前，有耳闻大学中的各种学生组织貌似挺有趣的，大学里我加了一个学生会，做一个简简单单的现充（现实生活充实的人），不差的人品，加上正常的外形，加上非常能叭叭，所以我的女人缘不算差，我在大学里我甚至连班上的同学的名字都没记全，但是我却记住了部门中的每个人。一起经历了两届运动会，参与组织了大大小小的活动，一起为部门庆生，部门合并改名后但原班人马及集合点还在的窃喜，一起聚餐，一起在操场上玩耍，这是我在大学里最宝贵的回忆了。</p><p>大一我是部员，大二我是部长，大三我便就没有过多的参与学生会了，因为我要毕业了，我必须要花点时间思考我毕业了做什么，是本专业还是学习自己想学的，前两年的参加部门活动，最后一年的思考，有了这些事情我并没有在宿舍里面待很长时间，大学的宿舍是滋生颓废的温床，最后的最后迷茫过，但也最终走上了正途.</p><p>说到这里，我应该需要感谢生命中的一个人，要不是她的出现又消失，我可能也不会静下心来坚定自己的选择。过程或喜或悲已经不重要了，说得过去的结局，最后。谢谢！</p>          </div><h2 id="封"><a href="#封" class="headerlink" title="封"></a>封</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gn29xi0hq6j328f1cknpe.jpg" alt="鬼刀"></p>]]></content>
    
    
    <categories>
      
      <category>碎碎念</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>新的开始</title>
    <link href="/2021/08/10/other-01/"/>
    <url>/2021/08/10/other-01/</url>
    
    <content type="html"><![CDATA[<h2 id="主"><a href="#主" class="headerlink" title="主"></a>主</h2><div class="note note-info">            <p>流水账一样的博客并不会给人留下爱学习以及爱记录的印象，反而是减分项，请务必认真对待自己的每一篇博客，如果你想被人阅读的话。</p><p>记于：2021-08-10晚11点整</p>          </div><div class="note note-primary">            <p>生活需要定期整理，博客也需要定期整理，宁缺勿滥，断舍离一直是我的人生箴言。</p><p>以写博客例，我实际上我也花了时间写博客，写了一些流水账一样的博客，有意义嘛，肯定有意义，但是没有太大的意义，但是这些流水账一样的博客它也会占用了我的时间，我的精力，人的精力是有限的，我可能就没有精力写出自己喜欢的博客。</p><p>想起以前的一个道理，如果你敷衍了生活中很多的小事，这个时候我们的关注点可能就不是每件小事的结果上，关注点在而是我们没有时间去做大事了。</p>          </div><h2 id="封"><a href="#封" class="headerlink" title="封"></a>封</h2><p><img src="https://snimg.jamyido.top/large/005NNTS5ly1gtc325zazej32yo1o0b29.jpg" alt="英雄联盟LOL星籁歌姬 KDA ALL OUT 同人 萨勒芬妮"></p>]]></content>
    
    
    <categories>
      
      <category>Other</category>
      
    </categories>
    
    
    <tags>
      
      <tag>杂文</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
